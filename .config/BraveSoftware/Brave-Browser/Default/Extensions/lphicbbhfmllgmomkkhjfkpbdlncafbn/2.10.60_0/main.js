(window.webpackJsonp=window.webpackJsonp||[]).push([[5,2],{0:function(e,t,r){e.exports=r("EtE5")},"5Zoz":function(e,t,r){r.d(t,"a",(function(){return s}));var i=r("mrSG"),n=r("fXoL"),a=r("dkLR"),o=r("xOb2"),s=function(){function e(){o.a.syncGet(e.LOCALE_KEY).then((function(t){t||o.a.set(e.LOCALE_KEY,a.a.DEFAULT_LANGUAGE+"_"+a.a.DEFAULT_COUNTRY)}))}return e.prototype.load=function(t,r){return Object(i.b)(this,void 0,void 0,(function(){var n,a;return Object(i.c)(this,(function(i){switch(i.label){case 0:return t&&r?(this.language=t,this.country=r,[3,3]):[3,1];case 1:return[4,o.a.syncGet(e.LOCALE_KEY)];case 2:n=i.sent()||e.LOCALE_SEPARATOR_SYMBOL,a=n.split(e.LOCALE_SEPARATOR_SYMBOL),this.language=a[0],this.country=a[1],i.label=3;case 3:return[2]}}))}))},Object.defineProperty(e.prototype,"locale",{get:function(){return this.language+"_"+this.country},enumerable:!1,configurable:!0}),e.LOCALE_KEY="locale",e.LOCALE_SEPARATOR_SYMBOL="_",e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=n.Ac({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},A1rn:function(e,t,r){var i=r("mrSG"),n=function(){function e(){}return e._getParentsSelectors=function(){return["header","#header",".header","#header-main",".header-main","#head",".head","#menu",".menu","footer","#footer",".footer","#footerNav",".footerNav"]},e._getTopExactSites=function(){return["letyshops.com","letyshops.ru","mail.ru","gmail.com","lenta.ru","drom.ru","rambler.ru","rbc.ru","iz.ru","mk.ru","hh.ru","gazeta.ru","vesti.ru","ngs.ru","2gis.ru","pikabu.ru","rt.com","rg.ru","farpost.ru","life.ru","woman.ru","smi2.ru","sport-express.ru","cosmo.ru","echo.msk.ru","aif.ru","fishki.net","glavbukh.ru","irecommend.ru","championat.com","eg.ru","lentainform.com","rutube.ru","tass.ru","cian.ru","zaycev.net","e1.ru","sportbox.ru","teleprogramma.pro","dni.ru","russianfood.com","mirtesen.ru","yaplakal.com","vz.ru","360tv.ru","babyblog.ru","rusprofile.ru","wday.ru","baby.ru","starhit.ru","banki.ru","rugion.ru","kommersant.ru","ura.ru","nbs.su","tvzvezda.ru","superjob.ru","vokrug.tv","ren.tv","russian7.ru","inosmi.ru","1mediainvest.ru","4pda.ru","riafan.ru","progorod43.ru","animevost.org","svpressa.ru","1tv.ru","mediafort.ru","rabota.ru","7dn.ru","7ya.ru","tnt-online.ru","rlsnet.ru","regnum.ru","kulturologia.ru","ntv.ru","utro.ru","fotostrana.ru","avtovzglyad.ru","tophotels.ru","fssprus.ru","povar.ru","irr.ru","rutracker.org","news.ru","hsdigital.ru","kp.ru","ria.ru","hearst-shkulev-media.ru","rt.com","rsport.ru","habr.com"]},e._getTopSites=function(){return["yandex","ya","vkontakte","vk","google","youtube","facebook","ok","odnoklassniki","twitter","instagram","localhost"]},e.checkTopSites=function(){return new Promise((function(t){var r=e,i=window.location.hostname.toLowerCase(),n=window.location.host.toLowerCase();if(0===i.indexOf("market.yandex"))return t(0);var a=i.match(/(^|\.)[-\d\w]{2,256}\.(com|com\.ua|ru|msk\.ru|by|pro|info|ua|su|tv|net|xn--p1ai)$/gim);if(a&&a.length){var o=r._getTopSites(),s=a[0].split(".").filter(Boolean),c=s[0];if(o.indexOf(c)>=0)return t(-1e3);var u=r._getTopExactSites(),l=s.join(".");if(u.indexOf(l)>=0)return t(-1e3)}return/\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/.test(n)||/:\d{2,}/.test(n)?t(-1e3):t(0)}))},e.checkHomePageOrStaticPages=function(){return new Promise((function(e){var t=window.location.pathname.toLowerCase().replace(/^\/+|\/+$/g,""),r=window.location.hash.toLowerCase(),i=window.location.search.toLowerCase(),n=["login","registration","auth","delivery","dostavka","contact","contacts","kontakti","kontakty","feedback","favorites","favorite","news","guaranty","services","blog","uslugi","garantiya","warranty","oplata","about-us","o-nas","payment","sitemap","forum","help","payment","kak_zakazat"];if(!r&&!i&&["","index.php","index.html","index.htm","index.aspx","default.aspx","index.asp","default.asp","catalog","shop","shops","opt","partner","job","vendors","basket","card","products","sale","about"].indexOf(t)>=0)return e(-1e3);for(var a=0;a<n.length;a++)if(t.indexOf(n[a])>=0)return e(-1e3);return e(0)}))},e.checkUrlRegExpTerms=function(){return new Promise((function(e){var t,r,n,a,o=window.location.pathname+window.location.search+window.location.hash;try{for(var s=Object(i.f)([/product\/category/gim]),c=s.next();!c.done;c=s.next()){if(c.value.test(o))return e(-.9)}}catch(d){t={error:d}}finally{try{c&&!c.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}try{for(var u=Object(i.f)([/product_id[/=]\w+/gim,/productid[/=]\w+/gim,/product_ids[/=]\w+/gim,/product_by_id[/=]\w+/gim,/prod[/=]\w+/gim,/product[/=]\w+/gim,/products[/=]\w+/gim,/id_product[/=]\w+/gim,/idproduct[/=]\w+/gim,/product\d+/gim,/product_\d+/gim,/\/p\d+/gim,/\W+id[/=]\w+/gim,/\W+pid[/=]\w+/gim,/\W+uid[/=]\w+/gim,/\W+gid[/=]\w+/gim,/\W+uid_\d+/gim,/tid[/=]\w+/gim,/item_id[/=]\w+/gim,/item[/=]+/gim,/itm[/=]\w+/gim,/item\d+/gim,/idtov[/=]\w+/gim,/tovar_id[/=]\w+/gim,/tovarid[/=]\w+/gim,/produkt[/=]\w+/gim,/goodid[/=]\w+/gim,/good_id[/=]\w+/gim,/idgoods[/=]\w+/gim,/id_goods[/=]\w+/gim,/goods[/=]\w+/gim,/good[/=]\w+/gim,/good\d+/gim,/model_id[/=]\w+/gim,/modelid[/=]\w+/gim,/model[/=]\w+/gim,/articul[/=]\w+/gim,/offer_id[/=]\w+/gim,/offerid[/=]\w+/gim,/offer[/=]\w+/gim,/view\/\d+/gim,/show\/\d+/gim,/detail\/\w+/gim,/catalog\/\d+\/\d+/gim]),l=u.next();!l.done;l=u.next()){if(l.value.test(o))return e(.9)}}catch(h){n={error:h}}finally{try{l&&!l.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}return e(0)}))},e.checkSortBlock=function(){return new Promise((function(t){var r=e,i={select:"option",'[class*="dropdown"]':"li"},n=/(\u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e|\u0434\u0435\u0448\u0435\u0432\u044b\u0445|\u0434\u0435\u0448\u0435\u0432\u043b\u0435|\u0434\u043e\u0440\u043e\u0436\u0435|\u0434\u043e\u0440\u043e\u0433\u0438\u043c|\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435|\u0446\u0435\u043d\u0435|\u0446\u0435\u043d\u0430|\u0432\u044b\u0441\u043e\u043a\u0430\u044f|\u043d\u0438\u0437\u043a\u0430\u044f|\u0438\u043c\u0435\u043d\u0438|\u0440\u0435\u0439\u0442\u0438\u043d\u0433\u0443)/gim;for(var a in i)for(var o=r._findAll(document,a),s=0;s<o.length&&s<10;s++){var c=r._findAll(o[s],i[a]),u=c.length;if(u>2&&u<20){var l=c.map((function(e){return e.innerText})).join(" ").trim().toLowerCase();if(!l.length)break;var d=l.match(n);if(d&&d.length>=2)return t(-.4)}}return t(0)}))},e.checkSchemaTags=function(){return new Promise((function(t){var r=e,i=r._findAll(document,'[itemtype*="schema.org/Product" i]').length;return i>0&&i<10?t(.8):i>=40?t(-.8):(i=r._findAll(document,'[itemtype*="schema.org/Offer" i]').length)>0&&i<10?t(.8):t(i>=40?-.8:(i=r._findAll(document,'[itemtype*="schema.org/AggregateRating" i]').length)>0&&i<10?.8:i>=40?-.8:0)}))},e.checkMetaOGTag=function(){return new Promise((function(t){return t(1===e._findAll(document,'meta[property="og:type"][content="product" i], meta[property="og:type"][content*="item" i]').length?.8:0)}))},e._isHasParents=function(e,t,r){try{r||(r=50);for(var i=void 0!==t;null!==(e=e.parentElement)&&r-- >0;)if(e.nodeType===Node.ELEMENT_NODE&&(!i||e.matches(t)))return!0;return!1}catch(n){return!1}},e._checkVisibility=function(e,t){try{var r=getComputedStyle(e);return"none"===r.display||("visible"!==r.visibility||r.opacity<.1||e.offsetWidth+e.offsetHeight+e.getBoundingClientRect().height+e.getBoundingClientRect().width===0)?!t:t}catch(i){return!1}},e._offset=function(e){var t,r=e.getBoundingClientRect(),i=function(e){return null!=e&&e===e.window};if(r.width||r.height){var n=e.ownerDocument,a=i(t=n)?t:9===t.nodeType&&t.defaultView,o=n.documentElement;return{top:r.top+a.pageYOffset-o.clientTop,left:r.left+a.pageXOffset-o.clientLeft}}return r},e._findSingle=function(t,r){var i,n=!1;-1!==r.indexOf(":visible")&&(r=r.replace(/:visible/gi,""),n=!0);var a=t.querySelector(r);return n&&!e._checkVisibility(a,!0)||(i=a),i},e._findAll=function(t,r){var i=!1;-1!==r.indexOf(":visible")&&(r=r.replace(/:visible/gi,""),i=!0);for(var n=[],a=t.querySelectorAll(r),o=0;o<a.length;o++)i&&!e._checkVisibility(a[o],!0)||n.push(a[o]);return n},e._findFirstFromSelector=function(t){var r,n;try{for(var a=Object(i.f)(t),o=a.next();!o.done;o=a.next()){var s=o.value,c=e._findAll(document,s);if(1===c.length){var u=c[0].getAttribute("content");if(u&&u.length||(u=c[0].innerText),u&&u.length)return u}}}catch(l){r={error:l}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return null},e.checkPriceTag=function(){return new Promise((function(t){var r,n,a=e,o={"#price:visible":"text",".price .js-product-price":"text",".price:visible":"text",".price2:visible":"text",".price3:visible":"text",".prices:visible":"text",".bk_price:visible":"text",".product-price:visible":"text",".productPrice:visible":"text",".new-price:visible":"text",".item_current_price:visible":"text",".item_old_price:visible":"text",".item_price:visible":"text",".product__price:visible":"text",".b-products__price-value:visible":"text",".prod-price-new:visible":"text",".price-new:visible":"text",".totalPrice:visible":"text",".cena:visible":"text",".cena2:visible":"text","#cost:visible":"text",".cost:visible":"text",".price_block:visible":"text",".price-block:visible":"text",".item-price:visible":"text",".master_price:visible":"text",".prod_price:visible":"text",".amount:visible":"text",".pricebox:visible":"text",".shk-price:visible":"text",".default-price:visible":"text",".goods-price .goods-price__value":"text","[data-price]":"attr-data-price",uprice:"text",'[name="price_now" i]':"attr-value"},s=a._getParentsSelectors().join(",");try{for(var c=Object(i.f)(['[itemtype*="//schema.org/Offer" i] meta[itemprop="price" i]','[itemtype*="//schema.org/Offer" i] [itemprop="price" i]','meta[itemprop="price" i]','[itemprop="price" i]','meta[property="product:price:amount" i]','[property="product:price:amount" i]']),u=c.next();!u.done;u=c.next()){var l=u.value,d=a._findAll(document,l);if(1===d.length){var h=d[0].getAttribute("content");if(h&&h.length||(h=d[0].innerText),h&&h.length&&h.length<100)return a.itemPrice=a.sanitizePrice(h),t(.8)}}}catch(I){r={error:I}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}var f=a.hasHtmlInDoc()?document.body.innerHTML.match(/["']*ecomm_totalvalue["']*\s*:\s*["']*\d+["']*\s*/gim):null;if(f&&1===f.length&&(f=f[0].match(/(\d+)/im))&&2===f.length)return a.itemPrice=a.sanitizePrice(f[1]),t(.8);if(window&&window.dataLayer&&window.dataLayer.length)for(var p=0;p<window.dataLayer.length;p++){var m=window.dataLayer[p];if(m&&m.ecommerce&&m.ecommerce.detail&&m.ecommerce.detail.products&&m.ecommerce.detail.products.hasOwnProperty("length")&&1===m.ecommerce.detail.products.length&&m.ecommerce.detail.products[0]&&m.ecommerce.detail.products[0].price)return a.itemPrice=a.sanitizePrice(m.ecommerce.detail.products[0].price+""),t(.8)}for(var g in o){var _=a._findAll(document,g).filter((function(e){var t=a._offset(e);return!(t.top>0&&(t.top>1300||t.top<120))&&!a._isHasParents(e,s)}));if(1===_.length){if(!a.itemPrice){var v=void 0;(v=0===o[g].indexOf("attr-")?_[0].getAttribute(o[g].replace("attr-","")):_[0].innerText)&&(v=v.trim()).length>0&&v.length<100&&(a.itemPrice=a.sanitizePrice(v))}return t(.8)}if(_.length>0&&_.length<=3){var E=void 0;for(var p in _){var b=void 0;if(b=0===o[g].indexOf("attr-")?_[p].getAttribute(o[g].replace("attr-","")):_[p].innerText,E||(E=b),!E||E!==b){E=null;break}}if(E&&"string"==typeof E&&E.length>1&&E.length<20)return a.itemPrice=a.sanitizePrice(E),t(.8)}}return t(0)}))},e.checkItemBlocks=function(){return new Promise((function(t){var r,n,a={".product:visible":!0,"#product-info:visible":!0,".product-info:visible":!0,".product__info:visible":!0,"#prod-info:visible":!0,".prod-info:visible":!0,"#products-item:visible":!0,".products-item:visible":!0,"#product-view:visible":!0,".product-view:visible":!0,"#product-data:visible":!0,".product-data:visible":!0,"#page-product:visible":!0,".page-product:visible":!0,'[name="product_id"]:visible':!1,".in-stock:visible":!1,"#product-description:visible":!0,".product-description:visible":!0,"#item-description:visible":!0,".item-description:visible":!0,".item-detail-page:visible":!0,".item_info_section:visible":!0,".product-text:visible":!0,"#product-gallery:visible":!0,"#product-attributes:visible":!0,".product-full-details:visible":!0,"#product-desc:visible":!0,".product_desc:visible":!0,".product_info:visible":!0,"#description:visible":!0,".b-good-description:visible":!0,".b-gallery:visible":!0,".product-description-specifications:visible":!0,".easyzoom:visible":!0,"#item-page:visible":!0,".item-page:visible":!0,"#item_page:visible":!0,".item_page:visible":!0,".good-wrapper:visible":!0,"#bk_product:visible":!0,".bk_product:visible":!0,"#product_inf:visible":!0,".product_inf:visible":!0,".productdetails:visible":!0,".productfull:visible":!0,".buy-block:visible":!0,".single-product-page:visible":!0,".itemInfo:visible":!0};try{for(var o=Object(i.f)(Object.keys(a)),s=o.next();!s.done;s=o.next()){var c=s.value,u=e._findAll(document,c);if(!(1!==u.length||a[c]&&(u[0].clientHeight<200||u.clientWidth<400)))return t(.8)}}catch(l){r={error:l}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return t(0)}))},e.checkAddToCartButton=function(){return new Promise((function(t){var r,n,a,o,s,c,u=e,l=["\u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043a\u043e\u0440\u0437\u0438\u043d\u0443","\u043a\u0443\u043f\u0438\u0442\u044c \u0438\u043b\u0438 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043a\u043e\u0440\u0437\u0438\u043d\u0443","\u043e\u0444\u043e\u0440\u043c\u0438\u0442\u044c \u0437\u0430\u043a\u0430\u0437","\u0432 \u043a\u043e\u0440\u0437\u0438\u043d\u0443","to cart","buy it","\u043a\u0443\u043f\u0438\u0442\u044c \u0441\u0435\u0439\u0447\u0430\u0441","\u043a\u0443\u043f\u0438\u0442\u044c \u0432 \u043e\u0434\u0438\u043d \u043a\u043b\u0438\u043a","\u043a\u0443\u043f\u0438\u0442\u044c \u0432 1 \u043a\u043b\u0438\u043a","\u043a\u0443\u043f\u0438\u0442\u044c \u0437\u0430","\u0434\u043e \u043a\u043e\u0448\u0438\u043a\u0430","\u0431\u044b\u0441\u0442\u0440\u044b\u0439 \u0437\u0430\u043a\u0430\u0437","\u0437\u0430\u043a\u0430\u0437 \u0432 \u043e\u0434\u0438\u043d \u043a\u043b\u0438\u043a","\u0437\u0430\u043a\u0430\u0437 \u0432 1 \u043a\u043b\u0438\u043a","\u043d\u0435\u0442 \u0432 \u043d\u0430\u043b\u0438\u0447\u0438\u0438","\u043d\u0435\u0442 \u043d\u0430 \u0441\u043a\u043b\u0430\u0434\u0435","\u043d\u0435\u0442 \u0432 \u043f\u0440\u043e\u0434\u0430\u0436\u0435","\u0442\u043e\u0432\u0430\u0440 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442","\u043e\u0436\u0438\u0434\u0430\u0435\u0442\u0441\u044f \u043f\u043e\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435","\u0443\u0432\u0435\u0434\u043e\u043c\u0438\u0442\u044c \u043e \u043f\u043e\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0438","\u0443\u0437\u043d\u0430\u0442\u044c \u043e \u043f\u043e\u044f\u0432\u043b\u0435\u043d\u0438\u0438","\u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0432 \u043c\u0430\u0433\u0430\u0437\u0438\u043d","\u0431\u044b\u0441\u0442\u0440\u0430\u044f \u043f\u043e\u043a\u0443\u043f\u043a\u0430","\u043a\u0443\u043f\u0438\u0442\u044c \u0432 \u043a\u0440\u0435\u0434\u0438\u0442","\u0432 \u043a\u0440\u0435\u0434\u0438\u0442","\u043a\u0443\u043f\u0438\u0442\u044c \u0442\u043e\u0432\u0430\u0440","\u043f\u043e\u043b\u043e\u0436\u0438\u0442\u044c \u0432 \u043a\u043e\u0440\u0437\u0438\u043d\u0443"],d=["\u043a\u0443\u043f\u0438\u0442\u044c","buy","\u0437\u0430\u043a\u0430\u0437\u0430\u0442\u044c","\u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442","\u0437\u0430\u043a\u0430\u0437"],h={"button:visible":["text","attrTitle"],"input:visible":["attrValue","attrTitle","attrAlt"],"a:visible":["text","attrTitle"],".btn:visible":["text","attrTitle"],"img:visible":["attrTitle","attrAlt"]},f=u._getParentsSelectors().join(","),p={},m=function(e){var t=u._findAll(document,e);if(t.length>500)return"continue";t.forEach((function(t){var r,n,a,o=u._offset(t);if(o.top>0&&(o.top>1300||o.top<140))return null;try{for(var s=(r=void 0,Object(i.f)(h[e])),c=s.next();!c.done;c=s.next()){var m=c.value;if("text"===m?a=t.innerText:"attrTitle"===m?a=t.getAttribute("title"):"attrAlt"===m?a=t.getAttribute("alt"):"attrValue"===m&&(a=t.getAttribute("value")),a)break}}catch(b){r={error:b}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}if(!a)return null;if(!(a=a.toLowerCase().replace(/\s{2,}/g," ").trim()).length||a.length>50)return null;for(var g={},_=!1,v=0;v<l.length;v++){void 0===g[E="contain--"+e+"--"+v]&&(g[E]=void 0===p[E]?0:p[E]),g[E]>2||0===a.indexOf(l[v])&&(g[E]++,_=!0)}for(v=0;v<d.length;v++){var E;void 0===g[E="equal--"+e+"--"+v]&&(g[E]=void 0===p[E]?0:p[E]),g[E]>2||a===d[v]&&(g[E]++,_=!0)}_&&!u._isHasParents(t,f)&&(p=Object.assign(p,g))}))};try{for(var g=Object(i.f)(Object.keys(h)),_=g.next();!_.done;_=g.next()){m(_.value)}}catch(A){r={error:A}}finally{try{_&&!_.done&&(n=g.return)&&n.call(g)}finally{if(r)throw r.error}}try{for(var v=Object(i.f)([".add-to-cart:visible",".add-to-basket:visible",".to-basket:visible",".buy-btn:visible",".buyButton:visible",".addtocart:visible",".toCart:visible"]),E=v.next();!E.done;E=v.next()){var b=E.value,I="selector--"+b,T=u._findAll(document,b);T.length>100||(p[I]=T.filter((function(e){var t=u._offset(e);return!(t.top>0&&(t.top>1300||t.top<140))})).length)}}catch(P){a={error:P}}finally{try{E&&!E.done&&(o=v.return)&&o.call(v)}finally{if(a)throw a.error}}try{for(var S=Object(i.f)(Object.keys(p)),O=S.next();!O.done;O=S.next()){var y=O.value;if(p[y]>0&&p[y]<=2)return t(.8)}}catch(w){s={error:w}}finally{try{O&&!O.done&&(c=S.return)&&c.call(S)}finally{if(s)throw s.error}}return t(0)}))},e.checkPaginator=function(){return new Promise((function(t){var r=e,i=r._findAll(document,'[class*="pagination" i],[id*="pagination" i]:visible,[class*="paginator" i]:visible,[id*="paginator" i]:visible,[class*="pages" i]:visible,[id*="pages" i]:visible,[class*="page-navigation" i]:visible,[id*="page-navigation" i]:visible,[class*="pager" i]:visible,[id*="pager" i]:visible,[class*="paging" i]:visible,[data-pagination-num]:visible,[data-pagination]:visible').filter((function(e){var t=r._offset(e);return e.clientHeight&&e.clientHeight<300&&e.clientWidth&&t.top>150}));return i.length&&i.map((function(e){return e.innerText})).join("").trim().length?t(-.8):t(0)}))},e.checkPagerParamsInUrl=function(){return new Promise((function(e){var t,r,n,a,o=window.location.pathname;try{for(var s=Object(i.f)([{reg:/page\/\d+/gim,score:-.9},{reg:/\Wpage-\d+/gim,score:-.9},{reg:/\/search/gim,score:-10},{reg:/\/search[/]/gim,score:-10}]),c=s.next();!c.done;c=s.next()){var u=c.value;if(u.reg.test(o))return e(u.score)}}catch(f){t={error:f}}finally{try{c&&!c.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}var l=window.location.search;try{for(var d=Object(i.f)([/page=\d+/gim,/sort=[\w.-_]+/gim,/order=[\w.-_]+/gim,/sorttype=[\w.-_]+/gim,/sort_type=[\w.-_]+/gim,/sortorder=[\w.-_]+/gim,/sort_order=[\w.-_]+/gim,/orderby=[\w.-_]+/gim,/order_by=[\w.-_]+/gim,/sortby=[\w.-_]+/gim,/sort_by=[\w.-_]+/gim,/[?&]search=/gim,/[?&]search_performed=/gim,/[?&]q=/gim,/[?&]search_term=/gim]),h=d.next();!h.done;h=d.next()){if(h.value.test(l))return e(-.9)}}catch(p){n={error:p}}finally{try{h&&!h.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}return e(0)}))},e.checkProductImage=function(){return new Promise((function(t){var r,n,a,o,s=e;if(void 0!==s.checkProductImageCache)return t(s.checkProductImageCache);if(s.biggestImg={square:null,url:null},s._findSingle(document,'[property="og:type"][content="product"]')){var c=s._findSingle(document,'[property="og:image" i ]');c&&(s.biggestImg={square:Math.pow(9,9),url:c.getAttribute("content")})}var u=[],l=s._findAll(document,'img[src]:not([src*=".icon" i]):not([src*=".svg" i]):not([src*=".gif" i]):visible');if(l.length>200)return t(0);if(l.forEach((function(e){if(!e.complete)return null;var t=s._offset(e);if(t.top<150||t.top>1150||t.left<100||t.left>1920)return null;var r=e.clientWidth,i=e.clientHeight;if(r<100||i<100||e.naturalWidth<100||e.naturalHeight<100)return null;if(Number((r>=i?r/i:i/r).toFixed(2))>2.5)return null;var n=!1;if(s._isHasParents(e,"[id*=promo i],[id*=banner i],[id*=logo i],[class*=promo i],[class*=banner i],[class*=logo i]",8))return null;s._isHasParents(e,"[id*=carousel i],[id*=slider i],[id*=fancybox i],[class*=carousel i],[class*=slider i],[class*=fancybox i]",8)&&(n=!0);var a=r*i;u.push({minTopCoef:Math.ceil(t.top/100),top:t.top,minLeftCoef:Math.ceil(t.left/100),left:t.left,width:r,height:i,square:a,isCarousel:n}),a>s.biggestImg.square&&(s.biggestImg.square=a,s.biggestImg.url=e.src)})),u.length<1)return s.checkProductImageCache=0,t(s.checkProductImageCache);if(1===u.length){if(u[0].isCarousel)return s.checkProductImageCache=.7,t(s.checkProductImageCache)}else{var d=0,h={},f={};try{for(var p=Object(i.f)(u),m=p.next();!m.done;m=p.next()){var g=m.value;g.isCarousel?d++:(g.minLeftCoef>0&&(void 0===h[g.minLeftCoef]&&(h[g.minLeftCoef]=0),h[g.minLeftCoef]++),g.minTopCoef>0&&(void 0===f[g.minTopCoef]&&(f[g.minTopCoef]=0),f[g.minTopCoef]++))}}catch(T){r={error:T}}finally{try{m&&!m.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}var _=Object.keys(h),v=Object.keys(f);if(_.length>=3&&v.length>=2&&h[_[0]]>=2&&f[v[0]]>=3)return s.checkProductImageCache=-.8,t(s.checkProductImageCache);if(_.length>=1&&_.length<=2&&v.length>=4){var E=0;try{for(var b=Object(i.f)(Object.values(f)),I=b.next();!I.done;I=b.next()){if(1===I.value&&E++,E>=4)return s.checkProductImageCache=-.2,t(s.checkProductImageCache)}}catch(S){a={error:S}}finally{try{I&&!I.done&&(o=b.return)&&o.call(b)}finally{if(a)throw a.error}}}if(d>=3)return s.checkProductImageCache=.4,t(s.checkProductImageCache)}return s.checkProductImageCache=0,t(s.checkProductImageCache)}))},e.checkPredefinedTextPatterns=function(){return new Promise((function(t){var r,n;if(!e.hasTextInDoc())return t(0);var a=document.body.innerText;try{for(var o=Object(i.f)([/\u043a\u043e\u0434(?:\s+\u0442\u043e\u0432\u0430\u0440\u0430)?.{0,2}:.{0,2}(?:[\d-]+|[-\u0430-\u044fa-z0-9]{4,30})/gi,/\u0430\u0440\u0442\u0438\u043a\u0443\u043b(?:\s+\u0442\u043e\u0432\u0430\u0440\u0430)?.{0,2}:.{0,2}(?:[\d-]+|[-\u0430-\u044fa-z0-9]{4,30})/gi,/id \u0442\u043e\u0432\u0430\u0440\u0430.{0,2}:.{0,2}(?:[\d-]+|[-\u0430-\u044fa-z0-9]{4,30})/gi,/\u043d\u0430\u043b\u0438\u0447\u0438\u0435.{0,2}:.{0,2}(?:\u043d\u0430 \u0441\u043a\u043b\u0430\u0434\u0435|\u0432 \u043d\u0430\u043b\u0438\u0447\u0438\u0438|\u043f\u043e\u0434 \u0437\u0430\u043a\u0430\u0437|\u0435\u0441\u0442\u044c|\u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442)/gi,/(?:\u043d\u0435\u0442|\u0435\u0441\u0442\u044c) \u0432 \u043d\u0430\u043b\u0438\u0447\u0438\u0438/gi,/\u0442\u043e\u0432\u0430\u0440 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442/gi,/\u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 \u043f\u0440\u043e\u0434\u0430\u0436\u0435/gi,/\u0442\u043e\u0432\u0430\u0440 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d/gi,/\u043d\u0435\u0442 \u0432 \u043d\u0430\u043b\u0438\u0447\u0438\u0438/gi,/\u043d\u0435\u0442 \u043d\u0430 \u0441\u043a\u043b\u0430\u0434\u0435/gi,/\u0441\u043d\u044f\u0442 \u0441 \u043f\u0440\u043e\u0434\u0430\u0436\u0438/gi,/\u0443\u0437\u043d\u0430\u0442\u044c \u043e \u043f\u043e\u044f\u0432\u043b\u0435\u043d\u0438\u0438/gi]),s=o.next();!s.done;s=o.next()){var c=s.value,u=a.match(c);if(u&&1===u.length)return t(.2)}}catch(l){r={error:l}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return t(0)}))},e.checkAmountPerPage=function(){return new Promise((function(t){for(var r=e,i=["\u0432\u0441\u0435","\u043f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0441\u0435","all"],n=r._findAll(document,"select"),a=0;a<n.length&&a<10;a++){var o=r._findAll(n[a],"option");if(o.length>2&&o.length<8){for(var s=!1,c=0;c<o.length;c++){var u=o[c].innerText.trim().toLowerCase();if(!u.length){s=!1;break}if(i.indexOf(u)>=0)s=!0;else{var l=parseInt(u,10);if(!(l>0&&l.toString().length===u.length)){s=!1;break}s=!0}}if(s)return t(-.4)}}return t(0)}))},e.sanitizePrice=function(e){var t,r;e=e.replace(new RegExp(String.fromCharCode(160),"g"),"");try{for(var n=Object(i.f)([/\s+/g,/\u0440\u0443\u0431\.?/im,/\u0440\.?/im,/rub\.?/im,"\u0446\u0435\u043d\u0430","\u0441\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c","\u0441\u043a\u0438\u0434\u043a\u0430",/['"]/g]),a=n.next();!a.done;a=n.next()){var o=a.value;e=e.replace(o,"")}}catch(c){t={error:c}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}var s=(e=e.replace(String.fromCharCode(160),"")).match(/(\d+[,.']?\d+)/im);return s&&s.length?s[0].trim():null},e.searchProductInfo=function(){var t,r,n=e,a={},o=['[itemtype*="//schema.org/Offer" i] meta[itemprop="name" i]','[itemtype*="//schema.org/Offer" i] [itemprop="name" i]','meta[itemprop="name" i]','[itemprop="name" i]','meta[property="product:retailer_title" i]','[property="product:retailer_title" i]'];a.itemName||(u=n._findFirstFromSelector(o))&&u.length&&(a.itemName=u.slice(0,512));try{for(var s=Object(i.f)(o),c=s.next();!c.done;c=s.next()){var u,l=c.value,d=n._findAll(document,l);if(1===d.length)if((u=d[0].getAttribute("content"))&&u.length||(u=d[0].innerText),u&&u.length){a.itemName=u.slice(0,512);break}}}catch(m){t={error:m}}finally{try{c&&!c.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}if(void 0!==window&&void 0!==window.dataLayer&&window.dataLayer.hasOwnProperty("length"))for(var h=0;h<window.dataLayer.length;h++){var f=window.dataLayer[h];if(f&&f.ecommerce&&(f.ecommerce.currencyCode&&(a.currencyCode=f.ecommerce.currencyCode),f.ecommerce.detail&&f.ecommerce.detail.products&&f.ecommerce.detail.products.hasOwnProperty("length")&&1===f.ecommerce.detail.products.length&&f.ecommerce.detail.products[0])){var p=f.ecommerce.detail.products[0];!a.itemName&&p.name&&(a.itemName=p.name),p.brand&&(a.brand=p.brand),p.category&&(a.category=[p.category]);break}}return a},e.getCurrencyCode=function(){var t=e._findFirstFromSelector(['[property="product:price:currency" i]','[itemprop="priceCurrency" i]']);return t&&t.length?t:null},e.getBrand=function(){var t=e._findFirstFromSelector(['[property="product:brand" i]','[itemprop="brand" i]']);return t&&t.length?t:null},e.getArticleId=function(){var t,r,n=e;if(!n.hasTextInDoc())return null;var a=document.body.innerText;try{for(var o=Object(i.f)([/\u043a\u043e\u0434(?:\s+\u0442\u043e\u0432\u0430\u0440\u0430)?.{0,2}:?.{0,2}(?:[\d-]+|[-\u0430-\u044fa-z0-9]{4,30})/gi,/\u0430\u0440\u0442\u0438\u043a\u0443\u043b(?:\s+\u0442\u043e\u0432\u0430\u0440\u0430)?.{0,2}:?.{0,2}(?:[\d-]+|[-\u0430-\u044fa-z0-9]{4,30})/gi,/\u0430\u0440\u0442\.\s+(?:[\d-]+|[-\u0430-\u044fa-z0-9]{4,30})/gi,/id \u0442\u043e\u0432\u0430\u0440\u0430.{0,2}:?.{0,2}(?:[\d-]+|[-\u0430-\u044fa-z0-9]{4,30})/gi]),s=o.next();!s.done;s=o.next()){var c=s.value,u=a.match(c);if(u&&1===u.length&&(u=u[0].match(/[\d-_a-z]+/gim))&&u.length)return u[0]}}catch(d){t={error:d}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}var l=n._findFirstFromSelector(['[property="product:retailer_item_id" i]','[itemprop="sku" i]']);return l||null},e.hasHtmlInDoc=function(){return document&&document.body&&document.body.innerHTML&&document.body.innerHTML.length},e.hasTextInDoc=function(){return document&&document.body&&document.body.innerText&&document.body.innerText.length},e.getCategories=function(){var t,r,n=e,a=[];try{for(var o=Object(i.f)(["#breadcrumb:visible",".breadcrumb:visible","#breadcrumbs:visible",".breadcrumbs:visible",".b-breadcrumbs:visible"]),s=o.next();!s.done;s=o.next()){var c=s.value,u=n._findAll(document,c);if(u.length){for(var l=n._findAll(u[0],"li"),d=0;d<l.length;d++){var h=l[d].innerText.trim();h.length>3&&a.push(h)}if(!l.length){var f=u[0].innerText.trim();f.length&&a.push(f)}}if(a.length)break}}catch(m){t={error:m}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}if(!a.length){var p=n._findFirstFromSelector(['[property="og:category" i]','[itemprop="category" i]']);p&&p.length&&a.push(p)}return a.length?a:null},e.check=function(){return this.clearCache(),new Promise((function(t){e.scoreSum=0,e.scoreDetails={};var r=function(t){return new Promise((function(r,i){if(Math.abs(e.scoreSum)>2)return r();setTimeout((function(){var n=Date.now();e[t]().then((function(i){e.scoreSum+=i,e.scoreDetails[t]={score:i,time:Date.now()-n},r()})).catch((function(e){i(e)}))}),1)}))};Promise.resolve().then((function(){return new Promise((function(t,r){var i=!1,n=0,a=function(){i||(i=!0,!e.hasTextInDoc()||!e.hasHtmlInDoc()||document.body.innerHTML.length<1e3?r(new Error("Document html not valid")):t())},o=function(){n++,i||(document&&"complete"===document.readyState?a():n>120?r(new Error("Document not ready")):setTimeout(o,500))};return document?(document.addEventListener("DOMContentLoaded",a),window?(window.addEventListener("load",a),void o()):r(new Error("Window object not found"))):r(new Error("Document object not found"))}))})).then((function(){return r("checkTopSites")})).then((function(){return r("checkHomePageOrStaticPages")})).then((function(){return r("checkUrlRegExpTerms")})).then((function(){return r("checkSchemaTags")})).then((function(){return r("checkMetaOGTag")})).then((function(){return r("checkPriceTag")})).then((function(){return r("checkAmountPerPage")})).then((function(){return r("checkSortBlock")})).then((function(){return r("checkPaginator")})).then((function(){return r("checkPagerParamsInUrl")})).then((function(){return r("checkItemBlocks")})).then((function(){return r("checkAddToCartButton")})).then((function(){return r("checkProductImage")})).then((function(){return r("checkPredefinedTextPatterns")})).then((function(){return t(e.scoreSum>0)})).catch((function(){return t(!1)}))}))},e.getAdditionalParams=function(){var t=e;return t.checkProductImage().then((function(){return void 0===t.itemPrice?t.checkPriceTag():Promise.resolve()})).then((function(){var e={title:null,h1:null,img:t.biggestImg&&t.biggestImg.url?t.biggestImg.url.slice(0,2048):null,price:null,itemName:null,currencyCode:null,category:null,brand:null,articleId:null,scoreSummary:t.scoreSum,scoreTime:null},r=t._findSingle(document,"title");if(r&&(e.title=r.innerText.trim().slice(0,512)),(r=t._findSingle(document,"h1"))&&(e.h1=r.innerText.trim().slice(0,512)),(r=t.searchProductInfo())&&(e=Object.assign(e,r)),e.articleId||(r=t.getArticleId())&&(e.articleId=r),e.category&&1!==e.category.length||(r=t.getCategories())&&(e.category=r),e.brand||(r=t.getBrand())&&(e.brand=r),e.currencyCode||(r=t.getCurrencyCode())&&(e.currencyCode=r),t.scoreDetails){var i=0;for(var n in t.scoreDetails)t.scoreDetails[n].time&&(i+=t.scoreDetails[n].time);i&&(e.scoreTime=i)}t.itemPrice&&(e.price=t.itemPrice);try{var a=window.location.hostname.toLowerCase();if(a.includes("ozon.ru")){var o=document.querySelectorAll('script[src*="https://googleads.g.doubleclick"][src*="ecomm_totalvalue"]');o=o[o.length-1],e.price=new URLSearchParams(decodeURIComponent(new URL(o.getAttribute("src")).search)).get("data").match(/ecomm_totalvalue=\d+/gim)[0].replace("ecomm_totalvalue=","")}else a.includes("detmir.ru")?e.price=document.querySelectorAll('div.i-flocktory[data-fl-action="track-item-view"]')[0].getAttribute("data-fl-item-price"):a.includes("dns-shop.ru")&&(e.price=document.querySelector(".product-card-top .product-buy_one-line .product-buy__price").innerText.replace(/[\u20bd]+.+/gim,"").replace(/[^\d.]/gim,""))}catch(s){}return Promise.resolve(e)})).catch((function(){return Promise.resolve({})}))},e.clearCache=function(){this.checkProductImageCache=void 0},e}();t.a=n},AytR:function(e,t,r){r.d(t,"a",(function(){return i}));var i={production:!0}},EVkI:function(e,t,r){r.d(t,"a",(function(){return a}));var i=r("mrSG"),n=r("fXoL"),a=function(){function e(){}return e.prototype.attachEvent=function(e,t){var r=this;chrome.runtime.onMessage.addListener((function(n,a,o){return Object(i.b)(r,void 0,void 0,(function(){var r;return Object(i.c)(this,(function(i){switch(i.label){case 0:return e!==n.name?[3,2]:(n.url=a.url,n.tab=a.tab,r=o,[4,t(n)]);case 1:r.apply(void 0,[i.sent()]),i.label=2;case 2:return[2]}}))})),!0}))},e.prototype.fireEvent=function(e,t){return void 0===t&&(t={}),new Promise((function(r){var n={action:"event",name:e,data:t.data?t.data:t},a=t.tabId,o=t.extensionId;-4===a?chrome.tabs.query({},(function(e){var t,r;try{for(var a=Object(i.f)(e),o=a.next();!o.done;o=a.next()){var s=o.value;chrome.tabs.sendMessage(s.id,n)}}catch(c){t={error:c}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}})):a?chrome.tabs.sendMessage(a,n,(function(e){r(e)})):o?chrome.runtime.sendMessage(o,n,(function(e){r(e)})):chrome.runtime.sendMessage(n,(function(e){r(e)}))}))},e.LETYSHOPS="LETYSHOPS_",e.SEND_THANKS_PAGE_PARAMETERS=e.LETYSHOPS+"SEND_THANKS_PAGE_PARAMETERS",e.GET_THANKS_PAGE_PARAMETERS=e.LETYSHOPS+"GET_THANKS_PAGE_PARAMETERS",e.FETCH_SIMPLE_SIMILAR_AUTOPROMO=e.LETYSHOPS+"FETCH_SIMPLE_SIMILAR_AUTOPROMO",e.NOTIFICATION_GET_PRICE_SIMILAR_PRODUCTS=e.LETYSHOPS+"NOTIFICATION_GET_PRICE_SIMILAR_PRODUCTS",e.GET_TOKEN_COOKIES=e.LETYSHOPS+"GET_TOKEN_COOKIES",e.GET_PRICE_HISTORY=e.LETYSHOPS+"GET_PRICE_HISTORY",e.SEND_LETYTOOL_EVENT=e.LETYSHOPS+"SEND_LETYTOOL_EVENT",e.CHECK_ALIEXPRESS_AFF_PRODUCT=e.LETYSHOPS+"CHECK_ALIEXPRESS_AFF_PRODUCT",e.NOTIFICATION_GET_SIMILAR_LIST=e.LETYSHOPS+"NOTIFICATION_GET_SIMILAR_LIST",e.GET_IMAGE_SEARCH_ITEMS=e.LETYSHOPS+"GET_IMAGE_SEARCH_ITEMS",e.SEND_GOOGLE_ANALYTICS=e.LETYSHOPS+"SEND_GOOGLE_ANALYTICS",e.SEND_GA_CID=e.LETYSHOPS+"SEND_GA_CID",e.SEND_TO_GOOGLE_FORM=e.LETYSHOPS+"SEND_TO_GOOGLE_FORM",e.CREATE_ADVICES=e.LETYSHOPS+"CREATE_ADVICES",e.REFRESH_ALL=e.LETYSHOPS+"REFRESH_ALL",e.GET_OFFERS_WITH_AUTOPROMO_AND_CASHBACK=e.LETYSHOPS+"GET_OFFERS_WITH_AUTOPROMO_AND_CASHBACK",e.GET_ANY_MERCHANT_BY_ID=e.LETYSHOPS+"GET_ANY_MERCHANT_BY_ID",e.GET_PAGE_COOKIES=e.LETYSHOPS+"GET_PAGE_COOKIES",e.GET_CLUB_OFFERS=e.LETYSHOPS+"GET_CLUB_OFFERS",e.GET_IMAGE_INITIAL_BASE_64=e.LETYSHOPS+"GET_IMAGE_INITIAL_BASE_64",e.SENT_LOG_SHOPPING_TRIP=e.LETYSHOPS+"SENT_LOG_SHOPPING_TRIP",e.IS_BROWSER=e.LETYSHOPS+"IS_BROWSER",e.GET_USER_PARTNER_DATA=e.LETYSHOPS+"GET_USER_PARTNER_DATA",e.USER_UPDATE=e.LETYSHOPS+"USER_UPDATE",e.UPDATE_USER_FORCE=e.LETYSHOPS+"UPDATE_USER_FORCE",e.ON_USER_LOGIN=e.LETYSHOPS+"ON_USER_LOGIN",e.ON_USER_LOGOUT=e.LETYSHOPS+"ON_USER_LOGOUT",e.LOAD_USER_LANGUAGE=e.LETYSHOPS+"LOAD_USER_LANGUAGE",e.CASHBACK_DEACTIVATE=e.LETYSHOPS+"CASHBACK_DEACTIVATE",e.PRICE_MONITORING_GET_DATA=e.LETYSHOPS+"PRICE_MONITORING_GET_DATA",e.PRICE_MONITORING_GET_CHART_DATA=e.LETYSHOPS+"PRICE_MONITORING_GET_CHART_DATA",e.PRICE_MONITORING_GET_SIMILAR_PRODUCTS=e.LETYSHOPS+"PRICE_MONITORING_GET_SIMILAR_PRODUCTS",e.PRICE_MONITORING_GET_PRICE_SELLER_PAGE_DATA=e.LETYSHOPS+"PRICE_MONITORING_GET_PRICE_SELLER_PAGE_DATA",e.PRICE_MONITORING_CLEAR_HISTORY=e.LETYSHOPS+"PRICE_MONITORING_CLEAR_HISTORY",e.UPDATE_FAVORITE_STATUS_FROM_BG=e.LETYSHOPS+"UPDATE_FAVORITE_STATUS_FROM_BG",e.UPDATE_FAVORITE_STATUS=e.LETYSHOPS+"UPDATE_FAVORITE_STATUS",e.GET_VALID_AUTOPROMO_OFFERS=e.LETYSHOPS+"GET_VALID_AUTOPROMO_OFFERS",e.GET_API_CLIENT_URLS_STATE=e.LETYSHOPS+"GET_API_CLIENT_URLS_STATE",e.CHECK_MERCHANT_COOKIES=e.LETYSHOPS+"CHECK_MERCHANT_COOKIES",e.SET_MERCHANT_COOKIES=e.LETYSHOPS+"SET_MERCHANT_COOKIES",e.CLEAR_COOKIES=e.LETYSHOPS+"CLEAR_COOKIES",e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=n.Ac({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},EtE5:function(e,t,r){r.r(t);var i,n,a,o,s=r("fXoL"),c=r("AytR"),u=r("tk/3"),l=r("jhN1"),d=r("HTEd"),h=r("LWby"),f=r("br3F"),p=r("EVkI"),m=r("dje0"),g=r("5Zoz"),v=r("VSgK"),E=r("mrSG"),b=r("q1z7"),I=r("cftt"),T=r("y7o/"),S=r("dkLR"),O=r("xOb2"),y=b.Model.extend({defaults:{id:"",title:"",aliases:[],domain:"",pattern:"",domains_enabled:"",domains_disabled:"",logo:"",shortDesc:"",longDesc:"",url:"",activateUrl:"",promo:[],settings:{globalDisabled:!1,partnerList:!1,partnerListNoActive:!1,browserAction:!1,injectNotification:!1,injectNotificationWithoutActivate:!1,injectSuccessNotification:!1,injectRewriteNotification:!1,injectRewriteNotificationWithoutActivate:!1,showInSearchEngine:!1,iconClickPage:!1,showInSimilar:!1,injectImageSearch:!1,injectImageSearchContextMenu:!1,injectLetyBar:!1,injectionTracking:!1},checkUrlParams:null,checkCookieParams:null,isFavorite:!1,isRecommended:!1,isViewed:!1,isActivated:!1,isSuppressed:!1,hasPromoActivated:"",rewrite:!1,savedParams:[],animated:"",delayActivate:null,thankYouPage:[],cashbackRate:{rate:null,rateFormated:null,isFloating:null,suffixFormated:null,type:null,conditionsFormated:[]},rate:null,rate_formated:null,is_floating:null,suffix:null,type:null,conditionsFormated:null,cashback:null,userCashback:null,cashbackFloated:null,clickPageUrl:"",trackOrderParams:null,transitionId:null,parsePromoCodeParameters:null,parseSentTrackingParameters:null,isSuppressedTime:null},initialize:function(){this.on(S.a.CASHBACK_ACTIVATE,this.activate),this.on(S.a.PROMO_ACTIVATE,this.activatePromo),this.on(S.a.MERCHANT_SUPPRESSED,this.suppressed)},suppressed:function(){this.set("isSuppressed",!0)},delayActivateStatus:function(){this.unset("delayActivate"),this.set("delayActivate",(new Date).getTime()+S.a.UPDATE_INTERVAL_ACTIVATE),this.unset("isSuppressed")},activate:function(){this.set("isActivated",!0),this.delayActivateStatus()},activatePromo:function(e){this.set("hasPromoActivated",""+e),this.delayActivateStatus()},reset:function(){this.unset("hot"),this.unset("hotProducts"),this.resetOnRewrite()},resetOnRewrite:function(){this.unset("delayActivate"),this.unset("isActivated"),this.unset("isSuppressed"),this.unset("savedParams"),this.unset("savedCookie"),this.unset("transitionId"),framework.extension.fireEvent(S.a.BUTTON_UPDATE,{tabId:null})},clearSuppressed:function(){this.unset("isSuppressed"),this.unset("isSuppressedTime")},setSuppressedTime:function(){this.set("isSuppressedTime",(new Date).getTime()+S.a.HIDE_NOTIFICATION_TIME)}}),A=b.Collection.extend({model:y,flag:"merchants",flagRates:"merchantsRates",updateFlag:"merchantsLastUpdated",updateFlagRates:"merchantsLastUpdated",url:I.a.merchants(),initialize:function(){var e=this;e.configService=window.configService,e.on("reset",(function(){e.save()})),e.fetch()},resetAll:function(){_.each(this.models,(function(e){e.unset("bonus"),e.unset("bonusCoefficient"),e.unset("userCashback"),e.unset("userCashbackValue"),_.each(e.get("conditionsFormated"),(function(e){e.currentRateFormated=e.rateFormated,e.currentRate=e.rate})),e.reset()}))},toJSON:function(e){return e&&e.length>0?_.map(e,(function(e){return e&&e.toJSON()})):this.models&&this.models.length>0?_.map(this.models,(function(e){return e&&e.toJSON()})):null},setPersonalCashback:function(e){var t=this;if(e&&e[0]&&_.isArray(e[0])&&(e=e[0]),0!==t.models.length){var r=!0;if(_.each(t.models,(function(e){e.get("rate")||0===e.get("rate")||(r=!1)})),r){if(e&&e.length){e.sort((function(e,t){return t.bonus-e.bonus}));var i=[];_.each(e,(function(e){if(void 0===e.exclude_shop_ids)return!0;e.exclude_shop_ids||i.push(e)})),e=e.filter((function(e){return i.indexOf(e)<0})),_.each(t.models,(function(r){e&&e.length>0?_.each(e,(function(e){void 0===e.exclude_shop_ids?r&&(!r.get("bonus")||e.bonus>r.get("bonus"))&&t.countPersonalCashback(r,e):e.exclude_shop_ids&&r&&r.id&&!e.shop_ids.includes(r.id.toString())&&(!r.get("bonus")||e.bonus>r.get("bonus"))&&t.countPersonalCashback(r,e)})):(r.unset("bonus"),r.unset("bonusCoefficient"),r.set({userCashback:r.get("cashback"),userCashbackValue:+r.get("rate")}),_.each(r.get("conditionsFormated"),(function(e){e.currentRateFormated=e.rateFormated,e.currentRate=e.rate})))})),_.each(i,(function(e){_.each(e.shop_ids,(function(r){var i=t.selectById(r);i&&(!i.get("bonus")||e.bonus>i.get("bonus"))&&t.countPersonalCashback(i,e)}))}))}}else t.fetchRates(),setTimeout(_.bind((function(){t.setPersonalCashback(e)}),t),100)}},countPersonalCashback:function(e,t){e.get("conditionsFormated")&&e.get("conditionsFormated").length>0&&_.each(e.get("conditionsFormated"),(function(e){e.currentRate=(+e.rate*((+t.bonus+100)/100)).toFixed(2),e.currentRateFormated=""+100*+e.currentRate/100+e.suffix}));var r=(+e.get("rate")*((+t.bonus+100)/100)).toFixed(2),i=""+100*+r/100+e.get("suffix");e.set({userCashback:i,userCashbackValue:+r,bonus:t.bonus,bonusCoefficient:T.a.calculateRateCoefficient(t.bonus),lastTimeCountPersonalCashback:_.now()})},setFavorites:function(e){if(0!==this.models.length){_.each(this.models,(function(t){return t.set("isFavorite",e&&e.includes(+t.get("id")))}));try{this.trigger(S.a.POPUP_MERCHANTS_UPDATE)}catch(t){}}},setRecommended:function(e){if(0!==this.models.length){_.each(this.models,(function(t){return t.set("isRecommended",e&&e.includes(+t.get("id")))}));try{this.trigger(S.a.POPUP_MERCHANTS_UPDATE)}catch(t){}}},setViewed:function(e){if(0!==this.models.length){_.each(this.models,(function(t){return t.set("isViewed",e&&e.includes(+t.get("id")))}));try{this.trigger(S.a.POPUP_MERCHANTS_UPDATE)}catch(t){}}},save:function(){O.a.set(this.flag,this.toJSON())},getMerchantsFromStorage:function(e,t,r){O.a.get(e.flag,(function(i){_.isNull(i)||_.isUndefined(i)?e.reset([]):(i&&_.isString(i)&&(i=JSON.parse(i)),_.isObject(i)?e.reset(i):i||(O.a.set(e.updateFlag,0),t.apply(e,r)))}))},setFetchSuccessMerchantObject:function(e,t,r,i,n){return Object(E.b)(this,void 0,void 0,(function(){return Object(E.c)(this,(function(a){return O.a.set(e.updateFlag,_.now()),_.isArray(n[1])&&_.has(n[1][0],"id")?t&&t.apply(e,n):e.getMerchantsFromStorage(e,r,i),[2]}))}))},getShoppingTripMerchants:function(){var e=[];O.a.remove("shoppingTripMerchants"),this.forEach((function(t){if(t.get("shoppingTrip")){var r=t.get("shoppingTrip");e.push({id:t.get("id"),shoppingTrip:r})}})),e&&e.length>0&&O.a.set("shoppingTripMerchants",e)},restoreShoppingTripMerchants:function(){var e=this;O.a.get("shoppingTripMerchants",(function(t){t&&t.length>0&&t.forEach((function(t){var r=e.getMerchantById(t.id);r&&r.set("shoppingTrip",t.shoppingTrip)}))}))},getStatusActivateMerchant:function(){var e=framework.extension.getBackgroundPage().application.get("user");if(O.a.remove("statusActivateMerchants"),e.isLogin()){var t=[];this.forEach((function(e){e.get("isActivated")&&t.push({id:e.get("id"),isActivated:e.get("isActivated"),delayActivate:e.get("delayActivate"),isSuppressed:e.get("isSuppressed"),savedParams:e.get("savedParams"),savedCookie:e.get("savedCookie"),transitionId:e.get("transitionId")})})),t&&t.length>0&&O.a.set("statusActivateMerchants",t)}},restoreStatusActivateMerchant:function(){var e=this;framework.extension.getBackgroundPage().application.get("user").isLogin()&&O.a.get("statusActivateMerchants",(function(t){t&&t.length>0&&t.forEach((function(t){var r=e.getMerchantById(t.id);r&&(r.set("isActivated",t.isActivated),r.set("delayActivate",t.delayActivate),r.set("isSuppressed",t.isSuppressed),r.set("savedParams",t.savedParams),r.set("savedCookie",t.savedCookie),r.set("transitionId",t.transitionId))}))}))},fetch:function(){return Object(E.b)(this,arguments,void 0,(function(){var e,t,r,i,n,a,o,s,c,u,l;return Object(E.c)(this,(function(d){switch(d.label){case 0:return arguments[0]||(arguments[0]={},arguments.length=1),e=this,t=arguments,r=arguments[0],i=arguments.callee,[4,e.configService.getParameter(h.a.UPDATE_INTERVAL_MERCHANT)];case 1:return n=d.sent(),[4,O.a.syncGet("locale")];case 2:return a=d.sent(),[4,O.a.syncGet("deliveryCountry")];case 3:return o=d.sent(),s=o?"&delivery_country="+o:"",e.url=I.a.merchants()+"?locale="+(a||S.a.DEFAULT_LANGUAGE+"_"+S.a.DEFAULT_COUNTRY)+"&version-ext="+framework.extension.version+s,[4,O.a.syncGet(e.updateFlag)];case 4:return c=d.sent(),e.getStatusActivateMerchant(),e.getShoppingTripMerchants(),!c||_.now()-c>n?(u=r.success,l=r.error,r.success=function(){e.setFetchSuccessMerchantObject(e,u,i,t,arguments),e.restoreStatusActivateMerchant(),e.restoreShoppingTripMerchants()},r.error=function(){e.getMerchantsFromStorage(e,i,t)},r.reset=!0,b.Collection.prototype.fetch.apply(e,t).always((function(){r.success=u,r.error=l}))):e.getMerchantsFromStorage(e,i,t),e.restoreStatusActivateMerchant(),e.restoreShoppingTripMerchants(),clearTimeout(e.fetchTimeout),e.fetchTimeout=setTimeout((function(){e.fetch()}),n),[2]}}))}))},fetchForce:function(){return Object(E.b)(this,arguments,void 0,(function(){var e,t,r,i,n,a,o,s,c,u=this;return Object(E.c)(this,(function(l){switch(l.label){case 0:return arguments[0]||(arguments[0]={},arguments.length=1),e=this,t=arguments,r=arguments[0],i=arguments.callee,n=r.success,a=r.error,[4,O.a.syncGet("locale")];case 1:return o=l.sent(),[4,O.a.syncGet("deliveryCountry")];case 2:return s=l.sent(),c=s?"&delivery_country="+s:"",e.url=I.a.merchants()+"?locale="+(o||S.a.DEFAULT_LANGUAGE+"_"+S.a.DEFAULT_COUNTRY)+"&version-ext="+framework.extension.version+c,r.success=function(){e.setFetchSuccessMerchantObject(e,n,i,t,arguments)},r.error=function(){e.getMerchantsFromStorage(e,i,t)},r.reset=!0,[4,b.Collection.prototype.fetch.apply(e,t).always((function(){return Object(E.b)(u,void 0,void 0,(function(){var e,t;return Object(E.c)(this,(function(i){switch(i.label){case 0:return e=r,[4,n];case 1:return e.success=i.sent(),t=r,[4,a];case 2:return t.error=i.sent(),[2]}}))}))}))];case 3:return l.sent(),[2]}}))}))},fetchRates:function(e){var t=this,r=this;O.a.get(r.updateFlagRates,(function(i){return Object(E.b)(t,void 0,void 0,(function(){var t;return Object(E.c)(this,(function(n){switch(n.label){case 0:return[4,r.configService.getParameter(h.a.UPDATE_INTERVAL_MERCHANT)];case 1:return t=n.sent(),!i||_.now()-i>t||e?$.ajax({url:I.a.cashRates(),type:"get",success:function(e){r.addRates(e)},error:function(e,t,i){console.error(e,t,i),r.addRates(r.models)}}):O.a.get(r.flagRates,(function(e){r.addRates(e)})),[2]}}))}))}))},fetchUserCashbackRates:function(e){return Object(E.b)(this,void 0,void 0,(function(){var t,r,i,n;return Object(E.c)(this,(function(a){switch(a.label){case 0:return[4,O.a.syncGet("locale")];case 1:return t=a.sent(),r=I.a.userCashbackRates(e.id)+"?locale="+(t||S.a.DEFAULT_LANGUAGE+"_"+S.a.DEFAULT_COUNTRY),i=this,e.set({lastTimeCountPersonalCashback:_.now()}),n={async:!1,crossDomain:!0,url:r,method:"GET"},$.ajax(n).done((function(e){var t=[];t.push(e),i.addRates(t)})),[2]}}))}))},addRates:function(e){var t=this;_.each(e,(function(e){var r=t.findWhere({id:e.id});r&&(r.set({rate:e.a,rate_formated:e.b,is_floating:e.c,suffix:e.d,type:e.e,conditionsFormated:e.f,cashback:e.b,rateUserCashback:e.ac?e.ac:e.a,userCashback:e.bc?e.bc:e.b,lastTimeCountPersonalCashback:_.now()}),e.c&&e.c>0&&r.set({cashbackFloated:!0}))})),e&&(O.a.set(t.updateFlagRates,_.now()),O.a.set(t.flagRates,e)),t.ratesAdded=!0,t.save()},parse:function(e){return e=_.filter(e,(function(e){return!!e.id&&!!e.c})),_.map(e,(function(e){return _.object(["id","title","aliases","thankYouPage","cashback","cashbackFloated","userCashback","domain","pattern","domains_enabled","domains_disabled","logo","shortDesc","longDesc","url","activateUrl","promo","checkUrlParams","checkCookieParams","countDomainLevel","settings","cashbackRate","rate","rate_formated","is_floating","suffix","type","conditionsFormated","cashback","userCashback","cashbackFloated","clickPageUrl","cartPage","disabledRedirect","trackOrderParams","parsePromoCodeParameters","parseSentTrackingParameters","userCashbackValue"],[e.id,e.a,e.h,e.o,e.i,e.j,e.i,e.c,e.c,e.de,e.dd,e.d,e.e,e.f,e.b,e.m,e.k,e.l,e.n,null!=e.c.match(/\./gi)?e.c.match(/\./gi).length:0,_.isArray(e.g)?_.object(["globalDisabled","partnerList","partnerListNoActive","browserAction","injectNotification","injectNotificationWithoutActivate","injectSuccessNotification","injectRewriteNotification","injectRewriteNotificationWithoutActivate","showInSearchEngine","dontShowInformer","iconClickPage","showInSimilar","injectNotificationCart","injectImageSearch","injectImageSearchContextMenu","injectLetyBar","injectionTracking"],[e.g.includes("global_disabled"),e.g.includes("partner_list"),e.g.includes("partner_list_noactive"),e.g.includes("browser_action"),e.g.includes("inject_notification"),e.g.includes("inject_notification_without_activate"),e.g.includes("inject_success_notification"),e.g.includes("inject_rewrite_notification"),e.g.includes("inject_rewrite_notification_without_activate"),e.g.includes("show_in_search_engine"),e.g.includes("dont_show_informer"),e.g.includes("icon_click_page"),e.g.includes("show_in_similar"),e.g.includes("inject_notification_cart"),e.g.includes("inject_image_search"),e.g.includes("inject_image_search_context_menu"),e.g.includes("inject_letybar"),e.g.includes("injection_tracking")]):{},Object.keys(e.p).length>0?_.object(["rate","rateFormated","isFloating","suffixFormated","type","conditionsFormated"],[e.p.a,e.p.b,e.p.c,e.p.d,e.p.e,e.p.f]):{},e.p.a,e.p.b,e.p.c,e.p.d,e.p.e,e.p.f,e.p.b,e.p.b,e.p.c&&e.p.c>0,e.q,e.r,e.v,e.u,e.s,e.t,e.p.a])}))},selectByDomain:function(e){return this.find((function(t){return T.a.checkEnableDisableDomain(t,e)}))},selectById:function(e){var t=this.findWhere({id:+e});return t&&(t.get("settings").partnerList||t.get("settings").partnerListNoActive||t.get("settings").browserAction||t.get("settings").injectNotification||t.get("settings").injectSuccessNotification||t.get("settings").injectRewriteNotification||t.get("settings").injectRewriteNotificationWithoutActivate||t.get("settings").iconClickPage)?t:null},getInfoForOffer:function(e){var t=this.findWhere({id:+e});return t&&!t.get("settings").partnerList?{mId:t.get("id"),logo:t.get("logo"),cashback:t.get("userCashback")?t.get("userCashback"):t.get("cashback"),cashbackFloated:t.get("cashbackFloated"),isFavorite:t.get("isFavorite"),url:t.get("url"),activateUrl:t.get("activateUrl")}:null},selectFavorites:function(){var e=[];return this.where({isFavorite:!0}).forEach((function(t){(t.get("settings").partnerList||t.get("settings").partnerListNoActive)&&e.push(t)})),e.length>0?this.toJSON(e):[]},selectRecommended:function(){var e=[];return this.where({isRecommended:!0}).forEach((function(t){(t.get("settings").partnerList||t.get("settings").partnerListNoActive)&&e.push(t)})),e.length>0?this.toJSON(e):[]},selectViewed:function(){var e=[];return this.where({isViewed:!0}).forEach((function(t){(t.get("settings").partnerList||t.get("settings").partnerListNoActive)&&e.push(t)})),e.length>0?this.toJSON(e):[]},select50First:function(e){var t=_.filter(this.models,(function(t){return t.get("settings").partnerList&&!_.contains(e,t.id)}));return t&&t.length?(t.length>50&&(t.length=50),this.toJSON(t)):null},selectByAlias:function(e){if(_.isString(e)){var t=this.filter((function(t){return t.get("aliases")&&t.get("aliases").find((function(t){return t.toLowerCase().includes(e.toLowerCase())}))}))||[];if(t.length)return t=this.toJSON(t),(t=_.sortBy(t,(function(t){var r=100;return _.each(t.aliases,(function(t){var i=t.toLowerCase().indexOf(e.toLowerCase());r>i&&-1!==i&&(r=i)})),r}))).splice(50),t}},getMerchantById:function(e){var t=this.findWhere({id:+e});return t||null}}),P=b.Model.extend({defaults:{id:"",domain:"",url:"",history:[],interstitialPageId:"",animation:!1},initialize:function(){this.reset=_.debounce(this.immediateReset,2e4)},immediateReset:function(){var e=this;_.delay((function(){Object(T.b)("TABS.JS: immediateReset",e),e.unset("state"),e.unset("interstitialPageId"),e.unset("activatingMerchantId")}),2e3)}}),w=b.Collection.extend({model:P,initialize:function(){this.eventService=window.eventService,_.each({browser:_.object([framework.browser.TABCLOSED,framework.browser.BEFORENAVIGATE,framework.browser.DOCUMENTCOMPLETE,framework.browser.TABCHANGED],[_.bind(this.tabWasClosed,this),_.bind(this.tabWasWalkingAlongChain,this),_.bind(this.tabWasChanged,this),_.bind(this.tabWasSwitched,this)]),extension:_.object([S.a.TAB_CHANGED],[this.tabWasChanged])},(function(e,t){_.each(e,(function(e,r){framework[t].attachEvent(r,e)}))})),framework.browser.attachEvent(framework.browser.BEFORENAVIGATE,this.tabBeforeNavigate)},tabWasClosed:function(e){var t=this.findWhere&&this.findWhere({id:e.tabId});t&&this.remove&&this.remove(t)},tabWasWalkingAlongChain:function(e){Object(T.b)("TABS.JS tabWasWalkingAlongChain",e);var t={};!function(e,r,i,n){t[i]=window.setTimeout((function(){n.tabWasChanged({tabId:e,url:r})}),S.a.BROWSER_NAME_FF===framework.browser.name?50:1)}(e.tabId,e.url,T.a.guid(),this)},tabWasChanged:function(e){var t=e.url;if(!_.isEmpty(t)){Object(T.b)("TABS.JS tabWasChanged",e);var r=e.tabId,i=T.a.getDomain(e.url),n=this.findWhere&&this.findWhere({id:r});if(n){var a=T.a.getDomain(e.url);n.set({url:t,domain:a})}else n=new P,this.add&&this.add(n),n.set&&n.set({id:r,url:t,domain:i}),S.a.BROWSER_NAME_FF===framework.browser.name&&this.merchantToNavigateAfterLoginForNewelyCreatedTab&&(n.set("merchantToNavigateAfterLogin",this.merchantToNavigateAfterLoginForNewelyCreatedTab),this.merchantToNavigateAfterLoginForNewelyCreatedTab=null),1===this.length&&(this.currentTabId=r,this.trigger(S.a.TAB_CHANGED,n))}},tabWasSwitched:function(e){Object(T.b)("TABS.JS tabWasSwitched",e),framework.extension.fireEvent(S.a.TAB_WAS_CHANGED,{tabId:e.tabId}),this.tabWasChanged(e),this.currentTabId=e.tabId,this.trigger(S.a.TAB_CHANGED,this.selectById())},tabBeforeNavigate:function(e){setTimeout((function(){Object(T.b)("TABS.JS tabBeforenavigate",e);var t=this.application.tabs.selectById(e.tabId),r=T.a.getDomain(e.url),i=r&&this.application.merchants.selectByDomain(r),n={},a={};if(i&&i.attributes){var o="";this.eventService.attachEvent(p.a.GET_PAGE_COOKIES,(function(e){if(e&&e.data){o=e.data.pageCookies;var r=JSON.parse(JSON.stringify(t.get("history")));r[r.length-1].cookies.pageCookies=o,t.set("history",r)}})),n={checkCookieParams:i.attributes.checkCookieParams,savedCookie:i.attributes.savedCookie?i.attributes.savedCookie:"",pageCookies:o},a={checkUrlParams:i.attributes.checkUrlParams,savedParams:i.attributes.savedParams,checkedParams:T.a.getAllUrlParams(e.url)}}if(e&&t){var s=JSON.parse(JSON.stringify(t.get("history"))),c={date:new Date(new Date(new Date(new Date).toISOString()).getTime()-6e4*(new Date).getTimezoneOffset()).toISOString().slice(0,19)+((new Date).getTimezoneOffset()/60).pad(2),url:e.url,referer:"",cookies:n,params:a};s.length>=S.a.HISIORY_LENGTH&&s.shift(),s.length>0&&(c.referer=_.last(s).url),s.push(c),t.set("history",s),this.application.history.length>=S.a.GLOBAL_HISTORY_LENGTH&&this.application.history.shift(),this.application.history.push(c)}else e&&!t&&((t=new P).set({id:e.tabId,url:e.url,domain:T.a.getDomain(e.url),history:[{date:JSON.stringify(new Date),url:e.url,referrer:"",cookie:n,params:a}]}),this.application.tabs.add(t))}),0)},selectById:function(e){return e=e||this.currentTabId,this.findWhere&&this.findWhere({id:e})}}),R=(n="",o={standard:(a="images/btn/")+"logo18.png",animated:a+"logo19.svg",rainbow:a+"logo18rainbow.svg",red:a+"logo18red.png",green:a+"logo18green.png",safari:a+"logo18safari.png",safari_act:a+"logo18safari_activated.png",safari_info:a+"logo18safari_info.png"},(i={}).attach=function(e){framework.ui.button.attachEvent(framework.ui.button.CLICK,e)},i.detach=function(e){framework.ui.button.detachEvent(framework.ui.button.CLICK,e)},i.green=function(){S.a.BROWSER_NAME_SAFARI===framework.browser.name?this.setIcon("safari_act"):this.setIcon("green")},i.red=function(){S.a.BROWSER_NAME_SAFARI===framework.browser.name?this.setIcon("safari_info"):this.setIcon("red")},i.standard=function(){S.a.BROWSER_NAME_SAFARI===framework.browser.name?this.setIcon("safari"):this.setIcon("standard")},i.setBadge=function(e){!e||"number"!=typeof e&&"!"!==e||(n=e),null!=e?framework.ui.button.setBadgeText(e):framework.ui.button.setBadgeText(n)},i.clearCounter=function(){"!"!==n&&(n="",this.setBadge())},i.setTitle=function(e){framework.ui.button.setTitle(e||"\u041a\u044d\u0448\u0431\u044d\u043a-\u0441\u0435\u0440\u0432\u0438\u0441 LetyShops")},i.setIcon=function(e){framework.ui.button.setIcon(o[e])},i.pulseIcon=function(e){var t=this;return void 0===e&&(e=350),new Promise((function(r,n){return Object(E.b)(t,void 0,void 0,(function(){var t;return Object(E.c)(this,(function(a){switch(a.label){case 0:t=0,a.label=1;case 1:return t<=4?i.animation?[4,T.a.sleep(e)]:[2,n()]:[3,5];case 2:return a.sent(),i.red(),[4,T.a.sleep(e)];case 3:a.sent(),i.standard(),a.label=4;case 4:return t++,[3,1];case 5:return[4,T.a.sleep(e)];case 6:return a.sent(),i.animation?[2,r()]:[2,n()]}}))}))}))},i),N=b.Model.extend({defaults:{bonus:"",desc:""},initialize:function(){}}),C=b.Collection.extend({model:N,flag:"codes",updateFlag:"codesLastUpdated",url:I.a.userCodes(),initialize:function(){var e=this;e.configService=window.configService,e.on("reset",(function(){e.save()})),e.fetch()},save:function(){O.a.set(this.flag,this.toJSON())},toJSON:function(e){return void 0===e&&(e=this.models),e.map&&e.map((function(e){return e.toJSON()}))},fetch:function(e){return Object(E.b)(this,arguments,void 0,(function(){var t,r,i,n,a;return Object(E.c)(this,(function(o){switch(o.label){case 0:return arguments[0]||(arguments[0]={},arguments.length=1),t=this,r=arguments.callee,[4,O.a.syncGet("locale")];case 1:return i=o.sent(),[4,t.configService.getParameter(h.a.UPDATE_INTERVAL_CODES)];case 2:return n=o.sent(),t.url=I.a.userCodes()+"?locale="+(i||S.a.DEFAULT_LANGUAGE+"_"+S.a.DEFAULT_COUNTRY),[4,O.a.syncGet(this.updateFlag)];case 3:return!(a=o.sent())||_.now()-a>n||e?b.Collection.prototype.fetch.call(t,{reset:!0}).always((function(){O.a.set(t.updateFlag,_.now())})):O.a.syncGet(t.flag).then((function(e){_.isObject(e)?t.set(e):e||(O.a.set(t.updateFlag,0),r.apply(t,arguments))})),clearTimeout(t.fetchTimeout),t.fetchTimeout=setTimeout((function(){t.fetch()}),n),[2]}}))}))},parse:function(e){return null!=e?e:null}}),L=b.Model.extend({url:I.a.user(),updateFlag:"userLastAuthorization",timerForceUpdateKey:"timerForceUpdateKey",timerUpdate:null,timerForceUpdate:null,defaults:{token:null,name:"",balanceInfo:[],image:"https://image.letyshops.com/sites/default/files/pictures/ava-def.png",partnerUrl:"",partnerPercent:"",rates:{},notifications:[],favorites:[],recommended:[],viewed:[],language:"",country:"",deliveryCountry:"",segments:[],extensionsToDisable:[],experiments:[]},initialize:function(){var e=this;this.set("rates",new C),this.rates=this.get("rates"),this.configService=window.configService,this.eventService=window.eventService,this.eventService.attachEvent(p.a.ON_USER_LOGIN,(function(t){return Object(E.b)(e,void 0,void 0,(function(){return Object(E.c)(this,(function(e){switch(e.label){case 0:return[4,this.logIn(t.data.cookie,!0)];case 1:return e.sent(),[2]}}))}))})),this.eventService.attachEvent(p.a.ON_USER_LOGOUT,(function(){e.logOut()})),this.fetchByStoredToken(!0),this.intervalForceUpdateExecution().then(),O.a.set(S.a.OFFLINE_LIKES,[])},fetchByStoredToken:function(e){var t=this;void 0===e&&(e=!1),O.a.syncGet(S.a.LOGIN_TOKEN).then((function(r){return Object(E.b)(t,void 0,void 0,(function(){return Object(E.c)(this,(function(t){switch(t.label){case 0:return r&&r.length&&"string"==typeof r?[4,this.logIn(r,e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))},intervalForceUpdateExecution:function(){return Object(E.b)(this,void 0,void 0,(function(){var e,t=this;return Object(E.c)(this,(function(r){switch(r.label){case 0:return[4,this.configService.getParameter(h.a.UPDATE_INTERVAL_USER_FORCE)];case 1:return e=r.sent(),this.timerForceUpdate=setTimeout((function(){clearTimeout(t.timerForceUpdate),O.a.syncGet(t.timerForceUpdateKey).then((function(r){return Object(E.b)(t,void 0,void 0,(function(){return Object(E.c)(this,(function(t){switch(t.label){case 0:return!r||_.now()-r>e?(this.fetchByStoredToken(!0),[3,3]):[3,1];case 1:return[4,this.intervalForceUpdateExecution()];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))}))}),e),[2]}}))}))},setUpdated:function(e){e.notifUpdated=!1,e.userUpdated=!1,e.notifUpdated=!1,e.favUpdated=!1,e.recomUpdated=!1,e.viewUpdated=!1,e.rates.codesUpdated&&(e.rates.codesUpdated=!1)},logIn:function(e,t){return void 0===t&&(t=!1),Object(E.b)(this,void 0,void 0,(function(){var r,i=this;return Object(E.c)(this,(function(n){switch(n.label){case 0:return r=this,!e||e===r.get("token")&&!t?[3,2]:(O.a.get(S.a.POPUP_FIRST_OPENING_TOKEN,(function(e){e||R.setBadge("")})),r.setUpdated(r),[4,r.fetch(t)]);case 1:n.sent(),r.set("token",e),O.a.set(S.a.LOGIN_TOKEN,e),clearInterval(r.mainInterval),r.mainInterval=setInterval((function(){return Object(E.b)(i,void 0,void 0,(function(){return Object(E.c)(this,(function(e){switch(e.label){case 0:return[4,r.fetchNotifyIntoLogin()];case 1:return e.sent(),[2]}}))}))}),3e5),n.label=2;case 2:return O.a.get(S.a.OFFLINE_LIKES,(function(e){_.each(e,(function(e){r.pushLiked(e)}),r)})),[2]}}))}))},fetchNotifyIntoLogin:function(e){return void 0===e&&(e=!1),Object(E.b)(this,void 0,void 0,(function(){var t;return Object(E.c)(this,(function(r){switch(r.label){case 0:return[4,(t=this).fetchNotifications(e,(function(e){t.set("notifications",e),_.findWhere(e,{status:"1"})?(R.setBadge(_.where(e,{status:"1"}).length),framework.extension.fireEvent(S.a.SET_NOTIFICATIONS_POPUP,{tabId:null}),O.a.set(S.a.POPUP_FIRST_OPENING_TOKEN,"Wow!"),framework.extension.fireEvent(S.a.SEND_USER_NOTIFICATION_LOGS,{data:{arrayNotifications:_.where(e,{status:"1"}),notificationEvent:"fetchUserNotification"}})):R.clearCounter()}))];case 1:return r.sent(),[2]}}))}))},logOut:function(){var e=this;null!==e.get("token")&&(e.setUpdated(e),clearInterval(e.mainInterval),clearInterval(e.timerForceUpdate),O.a.remove("deliveryCountry"),Object.keys(e.toJSON()).forEach((function(t){e.set(t,e.defaults[t])})),O.a.set(S.a.LOGIN_TOKEN,null),O.a.remove("similarList"),O.a.remove("viewedMerchants"),R.clearCounter(),clearTimeout(e.timerUpdate))},isLogin:function(){return this.get("token")},fetch:function(e){return void 0===e&&(e=!1),Object(E.b)(this,arguments,void 0,(function(){var t,r,i,n,a,o,s=this;return Object(E.c)(this,(function(c){switch(c.label){case 0:return arguments[0]||(arguments[0]={},arguments.length=1),t=this,r=arguments,i=arguments[0],arguments.callee,n=i.success,a=i.error,[4,O.a.syncGet("locale")];case 1:return o=c.sent(),t.url=I.a.user()+"?locale="+(o||S.a.DEFAULT_LANGUAGE+"_"+S.a.DEFAULT_COUNTRY),(!t.userUpdated||_.now()-t.userUpdated>S.a.UPDATE_INTERVAL_USER||e)&&(t.userUpdated=_.now(),i.success=function(r,i){return Object(E.b)(s,void 0,void 0,(function(){var r,n,a,o;return Object(E.c)(this,(function(s){switch(s.label){case 0:return i.name?(t.response=i,r=t.get("language")?t.get("language"):"ru",n=t.get("country")?t.get("country"):S.a.DEFAULT_COUNTRY,a=r+"_"+n,[4,O.a.syncGet("locale")]):[3,3];case 1:return o=s.sent(),O.a.set("locale",a),O.a.set("deliveryCountry",t.get("deliveryCountry")),o&&o.split("_")[0]===r&&o.split("_")[1]===n||t.eventService.fireEvent(p.a.LOAD_USER_LANGUAGE,{tabId:null,data:{language:r}}),e&&framework.extension.fireEvent(S.a.REFRESH_ALL,{tabId:null}),O.a.set(this.timerForceUpdateKey,_.now()),[4,t.intervalForceUpdateExecution()];case 2:return s.sent(),[3,4];case 3:t.logOut(),s.label=4;case 4:return[2]}}))}))},b.Model.prototype.fetch.apply(t,r).always((function(){i.success=n,i.error=a}))),[2]}}))}))},fetchNotifications:function(e,t,r){return Object(E.b)(this,void 0,void 0,(function(){var i,n,a;return Object(E.c)(this,(function(o){switch(o.label){case 0:return i=this,[4,O.a.syncGet("locale")];case 1:return n=o.sent(),[4,I.a.getUserNotifications()+"?locale="+n];case 2:return a=o.sent(),!i.notifUpdated||_.now()-i.notifUpdated>S.a.UPDATE_INTERVAL_USER_NOTIFICATION||r?(i.notifUpdated=_.now(),[4,$.ajax({url:a,type:"GET",dataType:"json",success:function(e){if(i.notifUpdated=_.now(),e&&e.length>0){var r=_.map(e,(function(e){return{id:""+e.id,status:e.status,markup:e.markup,showed:2===parseInt(e.status),date:e.date,url:e.url,type:e.type}}));t&&t(r)}else t&&t([])},error:function(e){"403"!==e.status&&"Forbidden"!==e.statusText||framework.extension.log("fetchNotify - Forbidden")}})]):[3,4];case 3:o.sent(),o.label=4;case 4:return e&&_.delay(_.bind(i.fetchNotifications,i),S.a.UPDATE_INTERVAL_USER_NOTIFICATION,!0,t),[2]}}))}))},pushReviewedNotifications:function(e){var t=this,r=t.get("notifications");_.findWhere(r,{id:""+e})&&$.ajax({url:I.a.getUserNotifications(),type:"POST",data:{notification_ids:[e]},processData:!0,success:function(e){e&&t.fetchNotifications(!0,(function(e){t.set("notifications",e),_.findWhere(e,{status:"1"})?R.setBadge(_.where(e,{status:"1"}).length):R.clearCounter()}),!0)},error:function(e){"400"!==e.status&&"Bad Request"!==e.statusText||framework.extension.log("pushNotify - Forbidden")}})},pushLiked:function(e){$.ajax({url:I.a.favoriteMerchants(),type:"POST",data:{shops_liked:[{shop_id:""+e,date:this.currentDate()}]},processData:!0,success:function(e){e&&(e.numInserted>0||e.numUpdated>0)&&e.numInserted>0&&framework.extension.log(e+", "+e.numInserted+", "+e.numUpdated)},error:function(t){"400"===t.status||"Bad Request"===t.statusText?framework.extension.log("pushLiked - \u200bMissing parameters"):"403"===t.status&&(framework.extension.log("pushLiked -  \u200bAccess Denied"),O.a.get(S.a.OFFLINE_LIKES,(function(t){t.push(e),O.a.set(S.a.OFFLINE_LIKES,t)})))}})},pushDisliked:function(e){$.ajax({url:I.a.deleteFavoriteMerchant(),type:"POST",data:{shops_disliked:[""+e]},processData:!0,success:function(e){e&&e.numUpdated>0&&e.numDeleted>0&&framework.extension.log(e+", "+e.numDeleted)},error:function(t){"400"===t.status||"Bad Request"===t.statusText?framework.extension.log("pushDisliked - \u200bMissing parameters"):"403"===t.status&&(framework.extension.log("pushDisliked -  \u200bAccess Denied"),O.a.get(S.a.OFFLINE_LIKES,(function(t){var r=t.indexOf(e);r>-1&&(t.splice(r,1),O.a.set(S.a.OFFLINE_LIKES,t))})))}})},rewriteViewed:function(e){if(e){var t=[],r=this.get("viewed")||[];(t=Object(E.e)(new Set(Object(E.e)([e],r))))&&t.length>20&&(t=t.slice(0,20)),this.set("viewed",t.map((function(e){return!!e&&e}))),O.a.set("viewedMerchants",t.map((function(e){return!!e&&e})))}},parse:function(e){return _.object(["name","balanceInfo","image","partnerUrl","partnerPercent","viewed","favorites","recommended","language","country","deliveryCountry","segments","experiments"],[e.name,e&&e.balance_info&&Object.keys(e.balance_info).length>0?_.object(["balanceApproved","balancePending","currency","currencyFormatted"],[e.balance_info.balance_approved,e.balance_info.balance_pending,e.balance_info.currency,e.balance_info.currency_formatted]):[],e.image,e.partner_url,e.partner_percent,e.shops_viewed,e.shops_liked,e.shops_recomended,e.language,e.country,e.delivery_country,e.segments,e.experiments])},currentDate:function(){return(new Date).toISOString()}}),D=function(){function e(){if(e.instance)throw new Error("Instantiation failed: use LogShoppingTripModule.getInstance() instead of new.")}return e.getInstance=function(){return e.instance},e.prototype.addListenerWebRequestBeforeRedirect=function(e){var t=this;chrome.webRequest.onBeforeRedirect.addListener((function(r){return Object(E.b)(t,void 0,void 0,(function(){var t,i,n,a,o,s;return Object(E.c)(this,(function(c){switch(c.label){case 0:return t=e.get("user"),(i=r.redirectUrl.match(new RegExp(":"+t.get("token")+":T([0-9]*)")))&&r.url?(n=void 0,(a=r.url.matchAll(S.a.CHECK_LETYSHOPS_VIEW_OR_GO))&&a.length&&(o=parseInt(a[0][1],10),n=e.get("merchants").getMerchantById(o)),n?[4,this.isMerchantHasShoppingTripId(n,e)]:[3,4]):[3,4];case 1:return c.sent()?[3,3]:[4,this.createShoppingTripId(r,n,e)];case 2:c.sent(),c.label=3;case 3:(s=n.get("shoppingTrip")).transitionIdPrevious=0!==s.transitionId&&s.transitionId!==parseInt(i[1],10)?s.transitionId:s.transitionIdPrevious||0,s.transitionId=parseInt(i[1],10),1===s.activationState&&(s.activationState=2),this.setActivationStatusShoppingTrip(n,!0),this.sendLogEvent(e.eapiService,n,2),c.label=4;case 4:return[2]}}))}))}),{urls:["<all_urls>"],types:["main_frame"]})},e.prototype.addListenerWebRequestCompleted=function(e){var t=this;chrome.webRequest.onCompleted.addListener((function(r){return Object(E.b)(t,void 0,void 0,(function(){var t,i,n,a,o;return Object(E.c)(this,(function(s){switch(s.label){case 0:if((t=r.url.includes(I.a.domain)?new URL(r.url):null)&&t.origin.includes(I.a.domain)){i=null;try{i=parseInt(r.url.matchAll(S.a.CHECK_LETYSHOPS_VIEW)[0][1],10)}catch(c){}i&&(n=e.get("merchants").getMerchantById(i))&&(a=n.get("shoppingTrip"))&&(r.url.includes("notification_re_activate_cashback")?(a.activationStatePrevious=a.activationState,a.activationState=3):(a.activationStatePrevious=a.activationState||1,a.activationState=2))}return(o=e.get("merchants").selectByDomain(T.a.getDomain(r.url)))?[4,this.sendLogShoppingTrip(r,o,e)]:[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}}))}))}),{urls:["<all_urls>"],types:["main_frame"]})},e.prototype.addListenerWebRequestBeforeRequest=function(e){var t=this;chrome.webRequest.onBeforeRequest.addListener((function(r){return Object(E.b)(t,void 0,void 0,(function(){var t,i;return Object(E.c)(this,(function(n){switch(n.label){case 0:t=null;try{t=T.a.getDomain(r.initiator)}catch(a){}return t&&(i=e.get("merchants").selectByDomain(t))?[4,this.getPromoCode(r,i,e)]:[3,4];case 1:return n.sent(),[4,this.checkSentTrackingMerchant(r,i,e)];case 2:return n.sent(),[4,this.getOrderIdByRequest(r,i,e)];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))}),{urls:["<all_urls>"]},["requestBody"])},e.prototype.isMerchantHasShoppingTripId=function(e,t){return Object(E.b)(this,void 0,void 0,(function(){var r;return Object(E.c)(this,(function(i){switch(i.label){case 0:return(r=!!e.get("shoppingTrip")&&!!e.get("shoppingTrip").id)?[4,this.isTimeExpiredShoppingTripId(e,t)]:[3,2];case 1:r=i.sent(),i.label=2;case 2:return[2,r]}}))}))},e.prototype.isTimeExpiredShoppingTripId=function(e,t){return Object(E.b)(this,void 0,void 0,(function(){var r;return Object(E.c)(this,(function(i){switch(i.label){case 0:return[4,t.configService.getParameter(h.a.INTERVAL_SHOPPING_TRIP_ID)];case 1:return r=i.sent(),[2,(new Date).getTime()-r<e.get("shoppingTrip").timeCreateShoppingTripId]}}))}))},e.prototype.sendLogShoppingTrip=function(e,t,r){return Object(E.b)(this,void 0,void 0,(function(){var i;return Object(E.c)(this,(function(n){switch(n.label){case 0:return[4,this.isMerchantHasShoppingTripId(t,r)];case 1:return n.sent()?[3,3]:[4,this.createShoppingTripId(e,t,r)];case 2:return n.sent(),[3,4];case 3:t.get("shoppingTrip").timeCreateShoppingTripId=(new Date).getTime(),n.label=4;case 4:return(i=t.get("cartPage"))&&e.url.includes(i)&&this.sendLogEvent(r.eapiService,t,4),this.checkThanksPage(r,t,e.url)?(this.sendLogEvent(r.eapiService,t,5),[4,this.getOrderId(e,t,r)]):[3,6];case 5:n.sent(),n.label=6;case 6:return[2]}}))}))},e.prototype.checkThanksPage=function(e,t,r){var i=t.get("thankYouPage");return i&&i.length>0&&r.includes(i[0].url)&&this.checkParamsThanksPage(r,i)&&this.checkReloadThanksPage(e)},e.prototype.checkParamsThanksPage=function(e,t){var r=!0,i=t[0].params;if(!(i instanceof Array))for(var n in r=!1,i){if(!new RegExp(""+i[n],"i").test(new URL(e).searchParams.get(n))){r=!1;break}r=!0}return r&&!!i},e.prototype.checkReloadThanksPage=function(e){var t=this.getHistoryTransitionsCurrentTab(e),r=t[t.length-1];return r.referer&&r.url!==r.referer},e.prototype.createShoppingTripId=function(e,t,r){return Object(E.b)(this,void 0,void 0,(function(){var i,n,a,o;return Object(E.c)(this,(function(s){switch(s.label){case 0:return i=t.get("shoppingTrip"),[4,this.isMerchantHasShoppingTripId(t,r)];case 1:return s.sent()?(i.id=T.a.guid(),t.get("shoppingTrip").timeCreateShoppingTripId=(new Date).getTime()):(n=(i||{}).transitionId,a=(a=(i||{}).transitionIdPrevious)||n||0,t.set("shoppingTrip",{id:T.a.guid(),timeCreateShoppingTripId:(new Date).getTime(),activationState:1,activationStatePrevious:1,transitionIdPrevious:a})),o=this.getHistoryTransitionsEvent(e),this.sendLogEvent(r.eapiService,t,1,{historyTransitions:o}),[2]}}))}))},e.prototype.setActivationStatusShoppingTrip=function(e,t){e.get("shoppingTrip").activationStatus=t},e.prototype.sendLogEvent=function(e,t,r,i){void 0===i&&(i={}),e.sendLogShoppingTripEvent(this.getPreparedData(t,r,i)).then()},e.prototype.getPreparedData=function(e,t,r){var i=T.a.getFullInfo(),n=e.get("shoppingTrip");return{shopping_trip_id:n.id,transition_id:n.transitionId||0,shop_id:e.get("id"),event_type:t,extension_version:framework.extension.version,activation_status:!!n.activationStatus,activation_state:n.activationState||1,data:Object.assign(r,{activation_state_previous:n.activationStatePrevious||1,transition_id_previous:n.transitionIdPrevious||0,environment:{os:i.os,os_version:i.osversion,browser:i.browser,browser_version:i.version}})}},e.prototype.getOrderId=function(e,t,r){return Object(E.b)(this,void 0,void 0,(function(){var i,n,a,o,s,c;return Object(E.c)(this,(function(u){if((i=t.get("trackOrderParams"))&&i.length>0)switch(n=i[0],a={type:n.type},o=n.parameters,s=null,n.type){case"url":o&&"params"===o.type&&(c=o.param_name,s=new URL(e.url).searchParams.get(c)),o&&"url"===o.type&&(s=decodeURIComponent(e.url).match(new RegExp(o.regex))[o.index]),s&&(a=Object.assign(a,{order_id:s}),this.sendLogEvent(r.eapiService,t,6,{orderParam:a}));break;case"cookies":case"page":(o&&"element"===o.type||n.cookie_params)&&setTimeout((function(){r.eventService.fireEvent(p.a.GET_THANKS_PAGE_PARAMETERS,{tabId:r.get("tabs").currentTabId,merchantId:t.get("id"),parameters:o,trackOrderParamMerchant:n})}),2e3)}return[2]}))}))},e.prototype.getOrderIdByRequest=function(e,t,r){return Object(E.b)(this,void 0,void 0,(function(){var i,n,a,o,s;return Object(E.c)(this,(function(c){if((i=t.get("trackOrderParams"))&&i.length>0&&"request"===(n=i[0]).type&&"url"===(a=n.parameters).type){o={type:n.type},s=null;try{s=decodeURIComponent(e.url).match(new RegExp(a.regex))[a.index]}catch(u){}s&&(o=Object.assign(o,{order_id:s}),this.sendLogEvent(r.eapiService,t,6,{orderParam:o}))}return[2]}))}))},e.prototype.getHistoryTransitionsCurrentTab=function(e){var t=e.tabs.selectById(),r=[];return t.get("history").forEach((function(e){r.push({date:e.date,referer:e.referer,url:e.url})})),r},e.prototype.getHistoryTransitionsEvent=function(e){return e.redirectUrl?{initiator:e.initiator,url:e.redirectUrl,referer:e.url}:{initiator:e.initiator,url:e.url,referer:e.initiator}},e.prototype.initializeEventsHandler=function(e){var t=this;e.eventService.attachEvent(p.a.SEND_THANKS_PAGE_PARAMETERS,(function(r){return Object(E.b)(t,void 0,void 0,(function(){var t,i,n,a,o,s,c;return Object(E.c)(this,(function(u){if(r&&r.data&&r.data.info){if(t={type:r.data.trackOrderParamMerchant.type},r.data.info.orderId)t=Object.assign(t,{order_id:r.data.info.orderId});else if(r.data.info.cookies)try{for(i=Object(E.f)(r.data.trackOrderParamMerchant.cookie_params),n=i.next();!n.done;n=i.next())if(a=n.value,r.data.info.cookies[a]){t=Object.assign(t,{order_id:r.data.info.cookies[a]});break}}catch(l){s={error:l}}finally{try{n&&!n.done&&(c=i.return)&&c.call(i)}finally{if(s)throw s.error}}o=e.get("merchants").getMerchantById(r.data.merchantId),this.sendLogEvent(e.eapiService,o,6,{orderParam:t})}return[2]}))}))})),e.eventService.attachEvent(p.a.SENT_LOG_SHOPPING_TRIP,(function(r){if(r&&r.data&&r.data.merchantId&&r.data.injectionTracking){var i=e.get("merchants").getMerchantById(r.data.merchantId);t.sendLogEvent(e.eapiService,i,9,r.data.injectionTracking)}}))},e.prototype.getPromoCode=function(e,t,r){return Object(E.b)(this,void 0,void 0,(function(){var i,n,a,o,s,c,u,l,d,h;return Object(E.c)(this,(function(f){if(i=t.get("parsePromoCodeParameters"),"requestRegExp","requestBody",i&&e.url.includes(i.requestUrl)&&e.method===i.requestMethod){switch(n={type:i.parseType},a=null,i.parseType){case"requestBody":if(e.requestBody&&e.requestBody.formData)o=e.requestBody.formData,a=o[i.requestData]&&o[i.requestData][0];else if(e.requestBody&&e.requestBody.raw){o=JSON.parse(decodeURIComponent(String.fromCharCode.apply(null,new Uint8Array(e.requestBody.raw[0].bytes)))),s=i.requestData.split(".");try{for(c=Object(E.f)(s),u=c.next();!u.done;u=c.next())l=u.value,a=o[l],o=o[l]}catch(p){d={error:p}}finally{try{u&&!u.done&&(h=c.return)&&h.call(c)}finally{if(d)throw d.error}}}break;case"requestRegExp":a=e.url.match(new RegExp(i.requestData))[1],n=Object.assign(n,{promoCode:a})}a&&(n=Object.assign(n,{promoCode:a}),this.sendLogEvent(r.eapiService,t,7,{promoCodeParam:n}))}return[2]}))}))},e.prototype.checkSentTrackingMerchant=function(e,t,r){return Object(E.b)(this,void 0,void 0,(function(){var i,n;return Object(E.c)(this,(function(a){return(i=t.get("parseSentTrackingParameters"))&&e.url.includes(i.requestUrl)&&e.method===i.requestMethod&&(n={url:e.url,saveParameters:{cookies:t.get("savedCookie"),get:t.get("savedParams")}},this.sendLogEvent(r.eapiService,t,8,{TrackingMerchantParameters:n})),[2]}))}))},e.instance=new e,e}(),k=function(){function e(){if(e.instance)throw new Error("Instantiation failed: use SimilarToolsModule.getInstance() instead of new.")}return e.getInstance=function(){return e.instance},e.prototype.initializeEventsHandler=function(e){var t=this,r=e.get("user");e.eventService.attachEvent(p.a.GET_TOKEN_COOKIES,(function(r){return Object(E.b)(t,void 0,void 0,(function(){return Object(E.c)(this,(function(t){switch(t.label){case 0:return T.a.isBrowser(S.a.BROWSER_NAME_FF)?[4,O.a.syncGet("allowTabUrlCollect")]:[3,2];case 1:if(!t.sent())return[2];t.label=2;case 2:return this.globalCashbackIsAvailableHandler(r,e),[2]}}))}))})),e.eventService.attachEvent(p.a.SEND_LETYTOOL_EVENT,(function(i){return Object(E.b)(t,void 0,void 0,(function(){return Object(E.c)(this,(function(t){switch(t.label){case 0:return T.a.isBrowser(S.a.BROWSER_NAME_FF)?[4,O.a.syncGet("allowTabUrlCollect")]:[3,2];case 1:if(!t.sent())return[2];t.label=2;case 2:return e.similarToolsService.letyToolEvent(i,r),[2]}}))}))})),e.eventService.attachEvent(p.a.NOTIFICATION_GET_SIMILAR_LIST,(function(r){return t.getSimilarList(r,e,e.similarToolsService)})),e.eventService.attachEvent(p.a.GET_IMAGE_SEARCH_ITEMS,(function(i){return t.getImageSearchItems(i,r,e)})),e.eventService.attachEvent(S.a.GET_IMAGE_INITIAL_BASE_64,(function(e){return Object(E.b)(t,void 0,void 0,(function(){return Object(E.c)(this,(function(t){return[2,this.renderBase64(e.data.url,e.data.options)]}))}))}))},e.prototype.globalCashbackIsAvailableHandler=function(e,t){var r=new URL(e.url),i=t.tabs.selectById(t.tabs.currentTabId),n=i&&i.get("history")&&i.get("history").length>0?i.get("history")[i.get("history").length-1].referer:"",a=t.get("user");a&&e&&e.data&&e.data.tokenCookies&&Object.keys(e.data.tokenCookies).length&&a.set({tokenCookies:e.data.tokenCookies});var o=T.a.getDomain(e.url),s=o&&t.merchants.selectByDomain(o),c=s?s.attributes.isCashbackAvailable:{};if(s&&s.get("isCashbackAvailable")&&(0===c.code||1===c.code&&(new Date).getTime()-c.lastTimeRequest>c.expire))return t.similarToolsService.sendCashbackIsAvailable(a,r,n,t),!0;e.url.startsWith("http")&&O.a.get("ddList",(function(e){e&&!e.includes(T.a.getDomain(r.host))&&O.a.get("isCashbackAvailable",(function(e){var i,o,s,c;if(e){var u=[];try{for(var l=Object(E.f)(e),d=l.next();!d.done;d=l.next()){var h=d.value;u.push(h.url)}}catch(m){i={error:m}}finally{try{d&&!d.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}if(u.includes(r.host))try{for(var f=Object(E.f)(e),p=f.next();!p.done;p=f.next()){(h=p.value).url===r.host&&(0===h.code||1===h.code&&(new Date).getTime()-h.lastTimeRequest>h.expire)&&t.similarToolsService.sendCashbackIsAvailable(a,r,n,t)}}catch(g){s={error:g}}finally{try{p&&!p.done&&(c=f.return)&&c.call(f)}finally{if(s)throw s.error}}else t.similarToolsService.sendCashbackIsAvailable(a,r,n,t)}else t.similarToolsService.sendCashbackIsAvailable(a,r,n,t)}))}))},e.prototype.getHotInfo=function(e,t,r){return Object(E.b)(this,void 0,void 0,(function(){return Object(E.c)(this,(function(i){switch(i.label){case 0:return[4,r.getItemHot(e,t)];case 1:return[2,i.sent()]}}))}))},e.prototype.getSimilarList=function(e,t,r){var i;return Object(E.b)(this,void 0,void 0,(function(){var n,a,o,s,c,u,l,d,h,f,p,m,g,_,v,b,I,y,A,P,w,R,N,C,L,D,k,M,U;return Object(E.c)(this,(function(x){switch(x.label){case 0:return e.data?(n=T.a.getDomain(e.url),a=n&&t.merchants.selectByDomain(n),o=t.user,s=[],c=[],u=[],l=e.data,d=l.similarRequestParams,h=l.storageData,[4,r.getSimilarList(d,o)]):[2,null];case 1:if(f=x.sent(),a)return[2,null];if(p=f&&f.searchResult&&f.searchResult.rows)try{for(m=Object(E.f)(p),g=m.next();!g.done;g=m.next())_=g.value,v=T.a.getDomain(_.target.url),(b=v&&t.merchants.selectByDomain(v))&&b.attributes&&b.get("settings").showInSimilar?(I=_.target.priceMinLast&&_.target.priceMinLast.price,y=I,A=I&&I.value,P=I.currency&&S.a.CURRENCY_LIST[I.currency.name],c.push(_.target.id),s.push({merchantId:b.get("id"),targetId:_.target.id,ext_referrer:encodeURIComponent(_.target.url),name:_.target.name,url:_.target.url,img:null!==(i=_.target.imgs[0])&&void 0!==i?i:null,productPricePrefix:P,productPriceValue:A,productPrice:y,link:T.a.getViewUrlItem(b.get("id"),_.target.url),cashbackRate:_.target.cashbackRate,userCashbackAmount:null})):u.push(_.target.id)}catch(j){M={error:j}}finally{try{g&&!g.done&&(U=m.return)&&U.call(m)}finally{if(M)throw M.error}}return w={isLogin:!!o.isLogin(),settingsQuery:f.settingsQuery,params:f.params,offers:s,targetShow:c,targetSkip:u},[4,O.a.syncGet("similarList")];case 2:return R=x.sent(),N=Object(E.a)({},R),C=Object(E.a)(Object(E.a)({},h),{productData:w}),L=C.domainKey,D=C.similarKey,k=C.productData,void 0===N[L]&&(N[L]={blockedByDomain:!1,blockedByTime:null,showMinimizedTill:0}),N[L][D]=Object(E.a)(Object(E.a)({},k),{lastTimeUpdated:Date.now()}),"CODE_STOP"===k.settingsQuery.code&&(N[L].apiBlockTime=Date.now(),N[L].apiBlockTimeExpire=1e3*k.settingsQuery.expire),N[L][D].params&&N[L][D].params.isPreview&&delete N[L][D].params.isPreview,O.a.set("similarList",N),[2,w]}}))}))},e.prototype.getImageSearchItems=function(e,t,r){return Object(E.b)(this,void 0,void 0,(function(){var i,n,a,o,s,c,u,l,d,h,f;return Object(E.c)(this,(function(m){switch(m.label){case 0:return i=e.data,n=i.attempt,a=i.source,o=i.srcPageUrl,s=i.srcImageUrl,c=[],u=[],delete i.attempt,delete i.source,l=new URL(i.srcPageUrl).hostname.includes("aliexpress"),t&&t.isLogin()&&(i.currencyCode=t.attributes.balanceInfo.currency),[4,r.similarToolsService.getItemImageSearch(i,t)];case 1:return(d=m.sent())&&0!==Object.keys(d).length&&d.xTargetList?(d&&d.xTargetList&&d.xTargetList.length>0&&(h=d.xTargetList.filter((function(e){var t=r.merchants.selectById(+e.letySourceId);return t?(c.push(e.id),!(l&&!T.a.isAliexpress(t.get("id")))&&(e.merchantId=+e.letySourceId,e.productPriceValue=e.priceMin,e)):(u.push(e.id),!1)}))),f=d,[4,r.prepareProductOffers(h)]):[2,null];case 2:return f.xTargetList=m.sent(),r.eventService.fireEvent(p.a.SEND_LETYTOOL_EVENT,{tabId:null,data:{name:n,data:{from:a,site_url:encodeURIComponent(o),img_url:encodeURIComponent(s),x_target_list_show:c,x_target_list_skip:u}}}),[2,d]}}))}))},e.prototype.renderBase64=function(e,t){return void 0===t&&(t={format:"image/png",maxWidth:1200,maxHeight:1200}),Object(E.b)(this,void 0,void 0,(function(){var r;return Object(E.c)(this,(function(i){return r=function(e,t,r,i){var n=Math.min(1,r/e,i/t);return{width:e*n,height:t*n}},[2,new Promise((function(i){if(!e)return i();var n=new Image;try{n.onload=function(){var e=document.createElement("canvas"),a=r(n.naturalWidth,n.naturalHeight,t.maxWidth,t.maxHeight),o=a.width,s=a.height;e.width=o,e.height=s,e.getContext("2d").drawImage(n,0,0,o,s);var c=e.toDataURL(t.format);i(c)},n.crossOrigin="anonymous",n.src=e}catch(a){i()}}))]}))}))},e.instance=new e,e}(),M=b.Model.extend({models:["user","merchants","tabs"],history:[],defaults:{merchants:{},offers:{},user:{},tabs:{},currentMerchant:null,currentPopupTab:"stores",contextMenuImageSearchId:null},initialize:function(){return Object(E.b)(this,void 0,void 0,(function(){function e(e){return Object(E.b)(this,void 0,void 0,(function(){var a,o,s,c,u,l,d,h,f,p,m,g,v,b,O,y,A,P,w,R,N,C,L,D,k;return Object(E.c)(this,(function(E){switch(E.label){case 0:if(e.url.includes(I.a.domain)){a=null,o=null;try{a=e.url.matchAll(S.a.CHECK_LETYSHOPS_GO)[0][0],o=parseInt(e.url.matchAll(S.a.CHECK_LETYSHOPS_VIEW)[0][1])}catch(U){}a&&o&&(s=t.merchants.selectById(o),c=new URL(e.url),(u="true"===c.searchParams.get("productWithGo"))&&s.set("productWithGo",u))}if(!e.url.includes("s.click.aliexpress")&&!e.url.includes("affiliates.rozetka.com.ua")){if(l=T.a.getDomain(e.url),(d=t.merchants.selectByDomain(l))&&(t.lastMerchantDomain=d.get("domain").replace("www.","")),(h=new URL(e.url)).search.substr(1).match("hot_product_id=")){function M(e){var t,r,i=decodeURIComponent(h.search.substring(1)).split("&");for(r=0;r<i.length;r++)if((t=i[r].split("="))[0]===e)return void 0===t[1]||t[1]}i=M("hot_product_id"),n=M("rate"),r=!0}d&&d.attributes&&r&&(d.attributes.hotProducts||(d.attributes.hotProducts=[]),f=T.a.getDomainPrice(h.host),p=T.a.getProductId(f,h.pathname),(m={})[p]={hot_product_id:i,rate:n},d.attributes.hotProducts&&d.attributes.hotProducts.length>0?_.each(d.attributes.hotProducts,(function(e){Object.keys(e).includes(p)||d.attributes.hotProducts.push(m)})):d.attributes.hotProducts.push(m),r=!1,i=null,n=null),d&&t.user.isLogin()&&(d.get("isActivated")||d.get("savedParams")||d.get("rewrite")?d.get("isActivated")&&d.get("savedParams")&&t.onParameterResearch(e):(t.onParameterSave(e),d.get("savedParams")&&d.trigger(S.a.CASHBACK_ACTIVATE)))}if(g=T.a.getDomain(e.url),(v=t.merchants.selectByDomain(g))&&v.get("extendedTab")&&(b=t.get("user"),v.get("extendedTab").history.forEach((function(e){var t=e.url,r=new URL(t).href.match(new RegExp(":"+b.attributes.token+":T([0-9]*)"));if(r){var i=v.get("transitionId");v.set("transitionId",i&&i>r[1]?i:r[1])}}))),e.url.includes("s.click.aliexpress")||!e.url.includes("aliexpress.")||!v||!v.get("isActivated"))return[3,3];O=void 0,y=void 0;try{O=T.a.getDomainPrice(new URL(e.url).host),y=parseInt(T.a.getProductId(O,new URL(e.url).pathname),10)}catch(U){}return!y||v.get("hot")&&(!v.get("hot")||v.get("hot")["hot_"+y])?[3,2]:[4,t.similarToolsModule.getHotInfo(e.url,t.user,t.get("similarToolsService"))];case 1:(A=E.sent()).hot||(A.hot=!1),v.attributes.hot=((D={})["hot_"+y]=A.hot,D),E.label=2;case 2:if(v.get("hot")&&v.get("hot")["hot_"+y]&&!v.get("hot")["hot_"+y].isActivatedHotProduct&&(P=!1,(t.tabs.selectById(t.tabs.currentTabId).get("history")?t.tabs.selectById(t.tabs.currentTabId).get("history"):v.get("extendedTab").history).forEach((function(e){var t=e.url,r=new URL(t);r.origin.includes("letyshops.com")&&r.searchParams.get("hot_product_id")&&r.searchParams.get("rate")&&(P=!0)})),!P))return v.unset("isActivated"),v.unset("savedParams"),v.unset("savedCookie"),(w=v.get("hot")["hot_"+y]).isActivatedHotProduct=!0,v.unset("hot"),v.attributes.hot=((k={})["hot_"+y]=w,k),R=new Date,N=v.get("id")+":"+t.user.get("token")+":T"+v.attributes.shoppingTrip.transitionId,C=R.getFullYear()+"-"+R.getMonth()+"-"+R.getDate()+"_"+R.getHours()+":"+R.getMinutes()+":"+R.getSeconds(),L=v.attributes.hot["hot_"+y].url+"&subid="+N+"&subid2="+C+"&subid3=ex53"+v.attributes.hot["hot_"+y].commissionCategory,[2,framework.browser.navigate({tabId:framework.browser.CURRENTTAB,url:L})];v.get("productWithGo")&&(v.set("isSuppressed",!0),v.unset("productWithGo")),E.label=3;case 3:return[2]}}))}))}var t,r,i,n,a,o=this;return Object(E.c)(this,(function(s){switch(s.label){case 0:return(t=this).lastMerchantDomain=null,t.similarToolsService=window.similarToolsService=t.get("similarToolsService"),t.eapiService=window.eapiService=t.get("eapiService"),t.eventService=window.eventService=t.get("eventService"),t.configService=window.configService=t.get("configService"),t.featureService=window.featureService=t.get("featureService"),t.localeService=window.localeService=t.get("localeService"),t.apiClient=I.a,t.set("merchants",new A),t.set("user",new L),t.set("tabs",new w),[4,t.loadUserLanguage()];case 1:return s.sent(),r=!1,i=null,n=null,$.support.cors=!0,t.initPopup(),t.onInstalledAndDelete(),R.standard(),framework.browser.name!==S.a.BROWSER_NAME_SAFARI&&chrome.runtime.onConnect.addListener((function(e){return Object(E.b)(o,void 0,void 0,(function(){var t,r=this;return Object(E.c)(this,(function(i){switch(i.label){case 0:return[4,T.a.getUserSettings()];case 1:return t=i.sent()||{},"optionspresence"===e.name&&e.onDisconnect.addListener((function(){return Object(E.b)(r,void 0,void 0,(function(){var e;return Object(E.c)(this,(function(r){switch(r.label){case 0:return[4,T.a.getUserSettings()];case 1:return e=r.sent()||{},Object.entries(t).toString()!==Object.entries(e).toString()&&framework.extension.fireEvent(S.a.SEND_USER_SETTINGS,{data:{type:1}}),[2]}}))}))})),[2]}}))}))})),_.extend(this,_.object(_.map(t.models,(function(e){return[e,t.attributes[e]]})))),t.merchants.listenTo(t.user,"change:viewed",(function(e,r){O.a.get("viewedMerchants",(function(e){e&&e.length>0?(t.user.set("viewed",e),t.merchants.setViewed(e)):t.merchants.setViewed(r)}))})),t.merchants.listenTo(t.user,"change:favorites",(function(e,r){t.merchants.setFavorites(r)})),t.merchants.listenTo(t.user,"change:recommended",(function(e,r){t.merchants.setRecommended(r)})),t.merchants.listenTo(t.user,"change:token",(function(){t.user.get("token")||(t.merchants.fetchForce(),t.userAutoPromoShops()),t.user.rates.fetch(!0)})),t.merchants.listenTo(t.user.get("rates"),"reset",(function(e){t.merchants.setPersonalCashback(e.toJSON())})),t.user.listenTo(t.merchants,"reset",(function(e){t.user.isLogin()&&(O.a.get("viewedMerchants",(function(r){r&&r.length>0?(t.user.set("viewed",r),e.setViewed(r)):e.setViewed(t.user.get("viewed"))})),e.setRecommended(t.user.get("recommended")),e.setFavorites(t.user.get("favorites")))})),t.listenTo(t.tabs,"change:url",t.initializeInterstitialPageActivationHandler),t.on(S.a.CASHBACK_ACTIVATE,t.activateFromPopup),[4,t.usersNotifyHandler()];case 2:return s.sent(),t.initializeNotificationHandler(),t.initializeParamsHandler(),t.initializeCookieHandler(),[4,t.userAutoPromoShops()];case 3:return s.sent(),[4,t.rivalAddListHandlerAjax()];case 4:return s.sent(),t.clearCacheInterval(),clearInterval(t.intervalPushLogRequest),t.intervalPushLogRequest=setInterval((function(){t.pushLogRequest(I.a.logRequest())}),S.a.INTERVAL_PUSH_LOG_REQUEST),_.delay((function(){O.a.get(S.a.POPUP_FIRST_OPENING_TOKEN,(function(e){e||t.user.isLogin()||R.setBadge("!")}))}),4e3),a={urls:["<all_urls>"],types:["main_frame","xmlhttprequest"]},T.a.isBrowser(S.a.BROWSER_NAME_YABROWSER)&&(a.types=["main_frame","xmlhttprequest","image"]),chrome.webRequest.onBeforeSendHeaders.addListener((function(t){return Object(E.b)(o,void 0,void 0,(function(){return Object(E.c)(this,(function(r){switch(r.label){case 0:return[4,e(t)];case 1:return r.sent(),[2]}}))}))}),a),this.logShoppingTripModule=D.getInstance(),this.logShoppingTripModule.addListenerWebRequestBeforeRequest(t),this.logShoppingTripModule.addListenerWebRequestBeforeRedirect(t),this.logShoppingTripModule.addListenerWebRequestCompleted(t),this.logShoppingTripModule.initializeEventsHandler(t),this.similarToolsModule=k.getInstance(),this.similarToolsModule.initializeEventsHandler(t),[2]}}))}))},loadUserLanguage:function(e){return Object(E.b)(this,void 0,void 0,(function(){var t,r,i,n,a,o,s,c,u;return Object(E.c)(this,(function(l){switch(l.label){case 0:return r=(t=this).get("user"),[4,O.a.syncGet("locale")];case 1:i=l.sent()||"",n=navigator.language.split("-")[0],a=e||i.split("_")[0]||r.get("language")||n||S.a.DEFAULT_LANGUAGE,o=i.split("_")[1]||S.a.DEFAULT_COUNTRY,$.i18n({locale:a}),l.label=2;case 2:return l.trys.push([2,4,,6]),[4,fetch("./i18n/"+$.i18n().locale+".json",{mode:"same-origin"}).then((function(e){return e.json()}))];case 3:return s=l.sent(),[3,6];case 4:return l.sent(),[4,fetch("./i18n/"+S.a.DEFAULT_LANGUAGE+".json",{mode:"same-origin"}).then((function(e){return e.json()}))];case 5:return s=l.sent(),[3,6];case 6:return(u={})[a]=s,c=u,$.i18n().load(c),R.setTitle($.i18n("title")),O.a.set("i18nDataLocale",c),t.i18n={locale:a},[4,t.localeService.load(a,o)];case 7:return l.sent(),[4,t.addImageSearchContextMenuItem()];case 8:return l.sent(),[2]}}))}))},activateFromPopup:function(e,t){var r=framework.browser.name.toLowerCase(),i=this.merchants.selectById(e);if(i){var n=this.tabs.selectById(),a=i.get("activateUrl"),o=T.a.getDomain(n.get("url")),s=T.a.checkEnableDisableDomain(i,o);if(n&&s){var c=n.get("url")?encodeURIComponent(n.get("url")):"";framework.browser.navigate({tabId:framework.browser.CURRENTTAB,url:I.a.getLink()+a+S.a.PARAMETER_DEEP_LINK+c+"&utm_source=extension&utm_campaign=partner_info&utm_term="+r})}else{var u=i.get("url").split("/");framework.browser.navigate({tabId:framework.browser.NEWTAB,url:I.a.getLink()+a+"?utm_source=extension&utm_campaign="+u[0]+"&utm_content="+u[1]+"&utm_term="+r})}t&&t()}},initializeNotificationHandler:function(){var e=this,t=this;framework.extension.attachEvent(S.a.NOTIFICATION_DISMISS,(function(e,r){if(e.data){var i=t.merchants.selectById(e.data);i&&i.trigger(S.a.MERCHANT_SUPPRESSED),t.user&&T.a.checkUserSegments(S.a.PERMISSIONS_SEGMENTS.extTestQ1,t.user.get("segments"))&&i&&i.setSuppressedTime(),r&&r()}})),framework.extension.attachEvent(S.a.NOTIFICATION_CASHBACK_ACTIVATE,(function(e,r){if(e.data){var i=void 0;(i=e.data&&e.data.merchantId?t.merchants.selectById(e.data.merchantId):t.merchants.selectByDomain(T.a.getDomain(e.url)))&&framework.extension.fireEvent(S.a.CLOSE_ALL_NOTIFICATION,{tabId:framework.browser.ALLTABS,data:i.toJSON()})}})),framework.extension.attachEvent(S.a.NOTIFICATION_GET_INFO,_.bind(t.globalPageHandler,t)),framework.browser.attachEvent(framework.browser.DOCUMENTCOMPLETE,_.bind(t.globalPageHandler,t)),framework.browser.attachEvent(framework.browser.TABCHANGED,_.bind(t.globalPageHandler,t)),framework.browser.attachEvent(framework.browser.BEFORENAVIGATE,(function(e){O.a.get("settings",(function(r){if(r&&r.redirectUrl&&r.redirectUrl.length>0){var i=new URL(e.url),n=null;try{n=window.location.href.matchAll(S.a.CHECK_LETYSHOPS)[0][0]}catch(a){}new RegExp(n,"i").test(i.host)&&!new RegExp(n,"i").test(new URL(r.redirectUrl).host)&&framework.browser.navigate({tabId:t.tabs.currentTabId,url:r.redirectUrl+i.pathname+i.search})}}))})),framework.extension.attachEvent(S.a.USER_NOTIFICATION_DISMISS,_.bind(t.usersNotifyDismiss,t)),framework.extension.attachEvent(S.a.SAW_REWRITE,_.bind(t.unRewrite,t)),framework.extension.attachEvent(S.a.BUTTON_UPDATE,_.bind((function(){var e=!!this.get("currentMerchant")&&this.merchants.selectById(this.get("currentMerchant"));e?e.get("isActivated")?R.green():R.red():R.standard()}),t)),framework.extension.attachEvent(S.a.UPDATE_MERCHANTS_RATES,(function(){t.user.rates.fetch(!0)})),t.eventService.attachEvent(p.a.LOAD_USER_LANGUAGE,(function(e){var r=e.data?e.data.language:null;t.loadUserLanguage(r)})),framework.extension.attachEvent(S.a.REFRESH_ALL,(function(){return Object(E.b)(e,void 0,void 0,(function(){return Object(E.c)(this,(function(e){switch(e.label){case 0:return t.user.isLogin()?[4,t.user.fetchNotifications(!0,(function(e){t.user.set("notifications",e),_.findWhere(e,{status:"1"})?(R.setBadge(_.where(e,{status:"1"}).length),framework.extension.fireEvent(S.a.SEND_USER_NOTIFICATION_LOGS,{data:{arrayNotifications:_.where(e,{status:"1"}),notificationEvent:"fetchUserNotification"}})):R.clearCounter()}),!0)]:[3,3];case 1:return e.sent(),O.a.set("deliveryCountry",t.user.get("deliveryCountry")),[4,t.userPartnerSettings()];case 2:return e.sent(),[3,4];case 3:O.a.remove("deliveryCountry"),e.label=4;case 4:return[4,t.promoNotifyHandlerAjax()];case 5:return e.sent(),[4,t.promoNotifyHandlerTimer()];case 6:return e.sent(),[4,t.userSettingsBySegment()];case 7:return e.sent(),[4,t.userAutoPromoShops()];case 8:return e.sent(),[4,t.merchants.fetchForce()];case 9:return e.sent(),[4,t.user.rates.fetch(!0)];case 10:return e.sent(),t.cleanSimpleSimilarCache(),t.cleanSimilarCache(),[2]}}))}))})),framework.extension.attachEvent(S.a.UPDATE_MERCHANTS_HOT_PRODUCTS,(function(e){var r=t.merchants.selectById(e.data.id);r&&r.attributes&&(r.attributes.hotProducts=e.data.hotProductsArr)})),framework.extension.attachEvent(S.a.GET_INFO_USER,(function(e,r){r&&r(t.user.toJSON())})),framework.extension.attachEvent(S.a.SEND_USER_SETTINGS,(function(e){t.clearCacheInterval(),t.pushLogUserSettings(e.data.type)})),framework.extension.attachEvent(S.a.GET_NATIVE_USER_AGENT,(function(e,t){t(T.a.getFullInfo())})),framework.extension.attachEvent(S.a.GET_MERCHANT_BY_ID,(function(e,r){var i=t.merchants.selectById(e.data.merchantId);r&&r(i.toJSON())})),t.eventService.attachEvent(p.a.GET_ANY_MERCHANT_BY_ID,(function(e){return t.merchants.getMerchantById(e.data.merchantId).toJSON()})),framework.extension.attachEvent(S.a.GET_MERCHANT_BY_DOMAIN,(function(e,r){var i=t.merchants.selectByDomain(e.data.domain);r&&r({merchant:i&&i.toJSON()})})),framework.browser.attachEvent(framework.browser.BEFORENAVIGATE,(function(e){O.a.get("settings",(function(r){if(r&&r.redirectUrl&&r.redirectUrl.length>0){var i=new URL(e.url),n=null;try{n=window.location.href.matchAll(S.a.CHECK_LETYSHOPS)[0][0]}catch(a){}n===i.host&&i.host!==new URL(r.redirectUrl).host&&framework.browser.navigate({tabId:t.tabs.currentTabId,url:r.redirectUrl+i.pathname+i.search})}}))})),framework.extension.attachEvent(S.a.SEND_USER_NOTIFICATION_LOGS,(function(e){t.pushUserNotificationLogs(e.data)})),t.eventService.attachEvent(p.a.CREATE_ADVICES,(function(e){var r,i,n=new URL(null!==(r=t.tabs.selectById(t.tabs.currentTabId).get("url"))&&void 0!==r?r:e.url),a=n.origin+n.pathname,o=null!==(i=e.data.source)&&void 0!==i?i:"popup";return O.a.syncGet(a).then((function(e){return!e||void 0===e||_.now()-e.linkAdviceLastCreate>6e4?(O.a.set(a,null),t.eapiService.getAdvices({link:a,source:o}).then((function(e){var t={link:a,adviceLink:e.link,linkAdviceLastCreate:_.now()};return O.a.set(a,t),t}))):e}))})),t.eventService.attachEvent(S.a.GET_SIMPLE_SIMILAR_DOMAIN_DATA,(function(r){return Object(E.b)(e,void 0,void 0,(function(){var e,i,n,a,o,s,c;return Object(E.c)(this,(function(u){switch(u.label){case 0:return e=r.data.domain,t.merchants.selectByDomain(e)||!e?[2]:(i={domainsList:[],settings:S.a.SIMPLE_SIMILAR_VIEWS_SETTINGS},[4,O.a.syncGet("simpleSimilar")]);case 1:if(n=u.sent(),!_.isEmpty(n)&&!_.isEmpty(n.domainsList)){if(o=n.domainsList,a=Object(E.a)({},n),o.some((function(t){return t.domain.replace("www.","").includes(e)})))return[2,a]}else a=Object(E.a)({},i);return[4,t.eapiService.getSimpleSimilarSettings(e)];case 2:return s=u.sent(),_.isEmpty(s)||_.isEmpty(s.domainsList)?[3,3]:(s.domainsList.forEach((function(e){e.status=!0,e.pageCount=1,e.lastShown=1,a.domainsList.push(e)})),a.settings=s.settings,[3,5]);case 3:return[4,t.configService.getParameter(h.a.INTERVAL_COUNT_SETTINGS_SIMPLE_SIMILAR)];case 4:c=u.sent(),a.domainsList.push({domain:e,status:Date.now()+c}),u.label=5;case 5:return O.a.set("simpleSimilar",a),[2,a]}}))}))})),t.eventService.attachEvent(p.a.GET_OFFERS_WITH_AUTOPROMO_AND_CASHBACK,(function(e){return t.prepareProductOffers(e.data.offers)})),t.eventService.attachEvent(p.a.IS_BROWSER,(function(e){return e.data.names.some((function(e){return T.a.isBrowser(e)}))})),t.eventService.attachEvent(p.a.GET_USER_PARTNER_DATA,(function(){return Object(E.b)(e,void 0,void 0,(function(){var e;return Object(E.c)(this,(function(r){switch(r.label){case 0:return[4,O.a.syncGet("userPartnerData")];case 1:return e=r.sent(),_.isEmpty(e)&&t.user.isLogin()?[4,t.eapiService.getPartnerSystemData()]:[3,3];case 2:e=r.sent(),r.label=3;case 3:return[2,e]}}))}))})),t.eventService.attachEvent(p.a.UPDATE_USER_FORCE,(function(){t.user.fetch(!0)})),t.eventService.attachEvent(p.a.UPDATE_FAVORITE_STATUS,(function(e){t.onFavoriteClick(e)})),t.eventService.attachEvent(p.a.FETCH_SIMPLE_SIMILAR_AUTOPROMO,(function(){return t.eapiService.getSimpleSimilarOffers()})),t.eventService.attachEvent(p.a.GET_API_CLIENT_URLS_STATE,(function(){return Object(E.a)(Object(E.a)({},I.a),{reasonCashbackReactivate:I.a.reasonCashbackReactivate(),confidentialPage:I.a.confidentialPage(),helpPage:I.a.helpPage(t.localeService.language)})})),t.eventService.attachEvent(p.a.GET_VALID_AUTOPROMO_OFFERS,(function(){return Object(E.b)(e,void 0,void 0,(function(){return Object(E.c)(this,(function(e){switch(e.label){case 0:return[4,t.getValidAutopromoOffers()];case 1:return[2,e.sent()]}}))}))}))},addImageSearchContextMenuItem:function(){return Object(E.b)(this,void 0,void 0,(function(){var e,t,r,i,n=this;return Object(E.c)(this,(function(a){switch(a.label){case 0:return[4,this.featureService.checkByAvailableCountry(m.a.IMAGE_SEARCH)];case 1:return a.sent()?((e=this.get("contextMenuImageSearchId"))&&chrome.contextMenus.remove(e,(function(){e=null,n.set("contextMenuImageSearchId",null)})),t=function(e){e.srcUrl&&framework.extension.fireEvent(S.a.INVOKE_IMAGE_SEARCH_CONTEXT_MENU,{data:{url:e.srcUrl}})},e||(r=chrome.contextMenus.create({title:$.i18n("imageSearchContextMenuTitle"),contexts:["image"],onclick:t}),this.set("contextMenuImageSearchId",r))):(i=this.get("contextMenuImageSearchId"))&&chrome.contextMenus.remove(i,(function(){i=null,n.set("contextMenuImageSearchId",null)})),[2]}}))}))},globalPageHandler:function(e,t){var r;return Object(E.b)(this,void 0,void 0,(function(){var i,n,a,o,s,c,u,l,d,f;return Object(E.c)(this,(function(p){switch(p.label){case 0:return i=this,R.animation=!1,_.isEmpty(e.url)||e.url.startsWith("chrome://newtab")?(i.attributes.currentMerchant=null,R.standard(),[2]):(n=T.a.getDomain(e.url),a=i.tabs.selectById(e.tabId),o=i.user,(s=n&&i.merchants.selectByDomain(n))&&a&&n?(s&&(!s.get("delayActivate")&&s.get("isActivated")||s.get("delayActivate")&&(new Date).getTime()>s.get("delayActivate"))&&(s.reset&&s.reset(),(c=s.get("shoppingTrip")).activationStatePrevious=c.activationState,c.activationState=5,D.getInstance().setActivationStatusShoppingTrip(s,!1)),s&&o&&T.a.checkUserSegments(S.a.PERMISSIONS_SEGMENTS.extTestQ1,o.get("segments"))&&!s.get("isActivated")&&s.get("isSuppressed")&&s.get("isSuppressedTime")&&(new Date).getTime()>s.get("isSuppressedTime")&&s.clearSuppressed&&s.clearSuppressed(),[4,i.configService.getParameter(h.a.INTERVAL_COUNT_USER_CASHBACK_RATES)]):(i.attributes.currentMerchant=null,R.standard(),[2]));case 1:u=p.sent(),s&&o&&o.isLogin()&&(!s.get("lastTimeCountPersonalCashback")||_.now()-s.get("lastTimeCountPersonalCashback")>u)&&i.merchants.fetchUserCashbackRates(s).then(),s&&i.tabs.currentTabId===e.tabId?((s.get("settings").partnerList||s.get("settings").partnerListNoActive)&&o.rewriteViewed(s.id),i.attributes.currentMerchant=s.id,s&&s.get("settings").browserAction&&i.tabs.currentTabId===a.id?s.get("isActivated")&&i.user.isLogin()?R.green():(R.animation=!0,_.delay((function(){R.pulseIcon().then((function(){return R.red()})).catch((function(){var e=i.get("tabs").selectById(i.get("tabs").currentTabId);if(e){var t=T.a.getDomain(e.get("url")),r=i.get("merchants").selectByDomain(t);if(r&&r.get("isActivated"))return void R.green()}R.standard()}))}),500)):s&&i.tabs.currentTabId===a.id&&R.standard()):(i.attributes.currentMerchant=null,a&&i.tabs.currentTabId===a.id&&R.standard()),l=a&&a.get("state"),d=null;try{d=url.matchAll(S.a.CHECK_LETYSHOPS_VIEW)[0][0]}catch(m){}return e.name!==framework.browser.DOCUMENTCOMPLETE||new RegExp(d,"i").test(e.url)||a.immediateReset(),S.a.TAB_STATE_INTERSTITIAL_REDIRECT!==(l&&S.a.TAB_STATE_INTERSTITIAL_REDIRECT)&&S.a.TAB_STATE_3RD_PARTY===(l&&S.a.TAB_STATE_3RD_PARTY)?s.trigger(S.a.MERCHANT_SUPPRESSED):S.a.TAB_STATE_INTERSTITIAL_REDIRECT===(l&&S.a.TAB_STATE_INTERSTITIAL_REDIRECT)&&s&&s.get("settings").browserAction&&i.tabs.currentTabId===a.id&&(s.get("isActivated")?R.green():R.red()),f=null!==(r=s.get("hasPromoActivated"))&&void 0!==r?r:null,s.attributes.extendedTab=a&&a.attributes,s.attributes.extendedPromo=f&&f.attributes,t&&t(s.attributes),[2]}}))}))},initializeInterstitialPageActivationHandler:function(e,t,r){if(t){if(t.includes(I.a.domain)){var i=null;try{i=parseInt(t.matchAll(S.a.CHECK_LETYSHOPS_VIEW)[0][1])}catch(o){}if(i){var n=this.merchants.getMerchantById(i);if(!n){var a=_.filter(this.merchants.models,_.bind((function(e){return _.contains(e.get("promo"),parseInt(i))}),this));_.isArray(a)&&!_.isEmpty(a)&&(n=a[0])}n&&(n.reset&&n.reset(),n.unset("rewrite"),n.set({extendedTabThanksPage:{state:e.get("state")||S.a.TAB_STATE_INTERSTITIAL_REDIRECT,interstitialPageId:i,shopId:i,interstitialPage:t,tabInfo:e.attributes}}),e.set("state",e.get("state")||S.a.TAB_STATE_INTERSTITIAL_REDIRECT),e.set("interstitialPageId",i),e.set("shopId",i),e.set("interstitialPage",t))}}else $.each(S.a.THIRD_PARTY_LINKS,(function(r,i){if(-1!==t.indexOf(i))return e.set("state",e.get("state")||S.a.TAB_STATE_3RD_PARTY),!1}))}},usersNotifyHandler:function(){return Object(E.b)(this,void 0,void 0,(function(){var e,t,r,i;return Object(E.c)(this,(function(n){switch(n.label){case 0:return(e=this).user.isLogin()&&(t=e.user.get("notifications"),(r=_.where(t,{status:"1",showed:!1}))&&r.length&&(e.user.set("notifications",_.map(t,(function(e){return e.showed=!0,e}))),r.forEach((function(t){function r(e){framework.extension.fireEvent(S.a.SEND_USER_NOTIFICATION_LOGS,{data:{arrayNotifications:[t],notificationEvent:e}})}var i=t.id,n={type:"basic",iconUrl:"images/btn/logo65.png",title:$.i18n("titleCreateNotification"),message:t.markup.replace(/<\/?[^>]+(>|$)/g,"")};chrome.notifications.create(i,n,(function(){r("createNotification")})),chrome.notifications.onClicked.addListener((function(n){if(n===i){var a=T.a.getFullInfo().browser===S.a.BROWSER_NAME_YABROWSER?"yabrowser":framework.browser.name.toLowerCase();framework.browser.navigate({tabId:framework.browser.NEWTAB,url:I.a._root+t.url+"&utm_term="+a}),R.setBadge(_.where(t,{status:"1"}).length),e.user.pushReviewedNotifications(t.id),r("clickNotification"),chrome.notifications.clear(n)}})),T.a.getFullInfo().browser===S.a.BROWSER_NAME_FF||!T.a.getFullInfo().os.includes("Mac OS")&&T.a.getFullInfo().os.includes("Mac OS")||chrome.notifications.onClosed.addListener((function(n,a){n===i&&a&&(R.setBadge(_.where(t,{status:"1"}).length),e.user.pushReviewedNotifications(t.id),r("closeNotification"))}))})))),clearInterval(e.intervalUsersNotifyHandler),[4,e.configService.getParameter(h.a.USER_NOTIFY_INTERVAL)];case 1:return i=n.sent(),e.intervalUsersNotifyHandler=setInterval((function(){e.usersNotifyHandler()}),i),[2]}}))}))},promoNotifyHandler:function(){var e=this.tabs.selectById(this.tabs.currentTabId);O.a.get("showPromoNotifications",(function(t){if((void 0===t||t)&&e&&e.attributes){var r=new URL(e.get("url"));O.a.get("promoNotifications",(function(e){e&&_.each(e,(function(e,t){(e.domains.includes("*")||e.domains.includes(r.origin))&&_.now()>new Date(e._notificateAt).getTime()&&_.now()<new Date(e._expireAt).getTime()&&"push"===e.type&&O.a.get("promoNotifications_"+t,(function(r){r||function(e,t){var r="images/btn/logo65.png";function i(t){framework.extension.fireEvent(S.a.SEND_USER_NOTIFICATION_LOGS,{data:{arrayNotifications:[{id:e.id,type:"promo"}],notificationEvent:t}})}(e._href_logo||e._href_logo.startsWith("http"))&&(r=e._href_logo);var n=e.id,a={type:"basic",iconUrl:r,title:e.title,message:e.message};chrome.notifications.create(n,a,(function(){i("createPromoNotification")})),chrome.notifications.onClicked.addListener((function(t){t===n&&(framework.browser.navigate({tabId:framework.browser.NEWTAB,url:e._href}),i("clickPromoNotification"),chrome.notifications.clear(t))})),T.a.getFullInfo().browser===S.a.BROWSER_NAME_FF||!T.a.getFullInfo().os.includes("Mac OS")&&T.a.getFullInfo().os.includes("Mac OS")||chrome.notifications.onClosed.addListener((function(e,t){e===n&&t&&i("closePromoNotification")})),"function"==typeof t&&t()}(e,(function(){O.a.set("promoNotifications_"+t,!0)}))}))}))}))}}))},promoNotifyHandlerTimer:function(){var e=this;clearInterval(e.intervalPromoNotifyHandler),e.intervalPromoNotifyHandler=setInterval((function(){e.promoNotifyHandler()}),S.a.PROMO_NOTIFY_INTERVAL)},usersNotifyDismiss:function(e,t){e.data&&this.user&&this.user.pushReviewedNotifications(e.data),t&&t()},userAutoPromoShops:function(){return Object(E.b)(this,void 0,void 0,(function(){var e,t;return Object(E.c)(this,(function(r){switch(r.label){case 0:return[4,(e=this).eapiService.getSimpleSimilarOffers()];case 1:return r.sent(),[4,e.configService.getParameter(h.a.UPDATE_INTERVAL_AUTOPROMO)];case 2:return t=r.sent(),clearInterval(e.intervalUserAutoPromoShops),e.intervalUserAutoPromoShops=setInterval((function(){(!e.delayUserAutoPromoShops||(new Date).getTime()>e.delayUserAutoPromoShops)&&(e.delayUserAutoPromoShops=(new Date).getTime()+t,e.userAutoPromoShops())}),t/2),[2]}}))}))},userPartnerSettings:function(){return Object(E.b)(this,void 0,void 0,(function(){var e,t;return Object(E.c)(this,(function(r){switch(r.label){case 0:return(e=this).eapiService.getPartnerSystemData().then(),[4,e.configService.getParameter(h.a.UPDATE_INTERVAL_USER_PARTNER_SETTINGS)];case 1:return t=r.sent(),clearInterval(e.intervalUserPartnerSettings),e.intervalUserPartnerSettings=setInterval((function(){(!e.delayUserPartnerSettings||(new Date).getTime()>e.delayUserPartnerSettings)&&(e.delayUserPartnerSettings=(new Date).getTime()+t,e.userPartnerSettings())}),t/2),[2]}}))}))},promoNotifyHandlerAjax:function(){return Object(E.b)(this,void 0,void 0,(function(){var e,t;return Object(E.c)(this,(function(r){switch(r.label){case 0:return(e=this).eapiService.getPromoNotifications().then(),[4,e.configService.getParameter(h.a.PROMO_NOTIFY_PERIOD)];case 1:return t=r.sent(),clearInterval(e.intervalPromoNotifyHandlerAjax),e.intervalPromoNotifyHandlerAjax=setInterval((function(){(!e.delayPromoNotifyHandlerAjax||(new Date).getTime()>e.delayPromoNotifyHandlerAjax)&&(e.delayPromoNotifyHandlerAjax=(new Date).getTime()+t,e.promoNotifyHandlerAjax())}),t/2),[2]}}))}))},userSettingsBySegment:function(){return Object(E.b)(this,void 0,void 0,(function(){var e,t,r;return Object(E.c)(this,(function(i){switch(i.label){case 0:return t=(e=this).user.get("segments"),e.user.isLogin()&&t?(clearInterval(e.intervalupdateUserSettingsBySegment),[4,e.configService.getParameter(h.a.INTERVAL_COUNT_SETTINGS_BY_SEGMENT)]):[3,2];case 1:r=i.sent(),e.intervalupdateUserSettingsBySegment=setInterval((function(){e.userSettingsBySegment()}),r),i.label=2;case 2:return[2]}}))}))},initializeParamsHandler:function(){framework.extension.attachEvent(S.a.GET_EXTENSION_INFO,(function(e){framework.extension.fireEvent(S.a.SEND_EXTENSION_INFO,{tabId:e.tabId,data:{version:framework.extension.version,name:framework.extension.name}})}))},initializeCookieHandler:function(){var e=this;e.eventService.attachEvent(p.a.SET_MERCHANT_COOKIES,(function(t){if(t.data){var r=e.merchants.getMerchantById(t.data.merchantId);r&&r.set("savedCookie",t.data.cookie)}})),e.eventService.attachEvent(p.a.CASHBACK_DEACTIVATE,(function(t){if(t.data){var r=e.merchants.getMerchantById(t.data.merchantId),i=(e.tabs.selectById(e.tabs.currentTabId),r.get("savedCookie"));if(!r.get("rewrite")){R.red(),r.reset(),r.set({rewrite:!0});var n=r.get("shoppingTrip");e.logShoppingTripModule.setActivationStatusShoppingTrip(r,!1),n.activationStatePrevious=n.activationState,n.activationState=4,n.transitionIdPrevious=n.transitionId,n.transitionId=0;var a=e.logShoppingTripModule.getHistoryTransitionsCurrentTab(e);e.logShoppingTripModule.sendLogEvent(e.eapiService,r,3,{overwritten:{type:"cookie",savedCookie:i,pageCookies:t.data.pageCookies},historyTransitions:a})}}})),e.eventService.attachEvent(p.a.CHECK_MERCHANT_COOKIES,(function(t){var r=T.a.getDomain(t.url),i=r&&e.merchants.selectByDomain(r);return i&&i.get("checkCookieParams")&&i.get("checkCookieParams").length?{merchant:i.toJSON()}:null})),e.eventService.attachEvent(p.a.CLEAR_COOKIES,(function(t){var r=T.a.getDomain(t.url),i=r&&e.merchants.selectByDomain(r);i&&i.set("savedCookie",null)}))},onParameterResearch:function(e){var t=e.url,r=T.a.getDomain(t),i={},n=(this.tabs.selectById(e.tabId),r&&this.merchants.selectByDomain(r));if(n&&n.get("checkUrlParams")&&n.get("checkUrlParams").length&&n.get("isActivated")){var a=n.get("checkUrlParams");if(n.get("savedParams")&&n.get("savedParams").length>0){var o,s=n.get("savedParams");if(_.keys(T.a.getAllUrlParams(t)).length>0){var c=!0;_.each(s,(function(e){if(c){var r=_.filter(a,(function(t){return _.isEqual(_.keys(t),_.keys(e))}));_.each(r[0],(function(e,r){var n=new RegExp(r.replace("$","\\$")+"=([^&]+)","i").exec(decodeURIComponent(t));if(n){var a=new RegExp(r.replace("$","\\$")+"=([^;]+)","i").exec(decodeURIComponent(decodeURIComponent(n[0])));null!==a&&new RegExp(e,"i").test(a[1])?i[r]=a[1].split(" ").join("+"):i[r]=null}})),JSON.stringify(_.keys(i))===JSON.stringify(_.keys(e))?o=JSON.stringify(e)===JSON.stringify(i):0!==_.compact(_.uniq(_.values(i))).length?(o=!0,_.each(i,(function(t,r){if(-1!==Object.keys(e).indexOf(r)){var i=-1!==Object.values(e).indexOf(t);i||(o=i)}}))):o=!0,o||(c=!1)}}))}else o=!0;if(!o){n.resetOnRewrite(),n.set({rewrite:!0}),this.tabs.currentTabId===e.tabId&&R.red(),n.set("extendedTabThanksPage");var u=n.get("shoppingTrip");this.logShoppingTripModule.setActivationStatusShoppingTrip(n,!1),u.activationStatePrevious=u.activationState,u.activationState=4,u.transitionIdPrevious=u.transitionId,u.transitionId=0;var l=this.logShoppingTripModule.getHistoryTransitionsCurrentTab(this);this.logShoppingTripModule.sendLogEvent(this.eapiService,n,3,{overwritten:{type:"get",cashbackParams:s,checkedParams:i},historyTransitions:l})}}}},onParameterSave:function(e){var t=e.url,r=T.a.getDomain(t),i=this.merchants.selectByDomain(r);if(_.keys(T.a.getAllUrlParams(t)).length>0||0===_.keys(T.a.getAllUrlParams(t)).length&&void 0!==i.get("mainFrame")){if(i&&i.get("checkUrlParams")&&i.get("checkUrlParams").length&&!i.get("isActivated")&&!i.get("savedParams")){var n=i.get("checkUrlParams"),a=[];return _.each(n,(function(e){var r=_.chain(e).map((function(e,r){var i=new RegExp(r.replace("$","\\$")+"=([^&]+)","i").exec(decodeURIComponent(t));if(i){var n=new RegExp(r.replace("$","\\$")+"=([^;]+)","i").exec(decodeURIComponent(decodeURIComponent(i[0])));return null!==n&&new RegExp(e,"i").test(n[1])?[r,n[1].split(" ").join("+")]:[r,null]}})).compact().object().value(),i=[];$.each(r,(function(e,t){i.push(t)})),i.length>0&&!i.includes(null)&&a.push(r)})),a&&a.length>0&&i.set("savedParams",a),!0}i&&!i.get("isActivated")&&!i.get("rewrite")&&_.isEmpty(i.get("checkUrlParams"))&&(this.unset("mainFrame"),i.trigger(S.a.CASHBACK_ACTIVATE))}else i.set("mainFrame",!0)},unRewrite:function(e){var t=this.merchants.selectById(e.data.id);t.resetOnRewrite(),t.set({rewrite:!1}),t.set("savedParams",[])},onFavoriteClick:function(e){if(e.data){var t=e.data.id,r=e.data.isFavorite;r?this.user.pushDisliked(t):this.user.pushLiked(t),this.merchants.selectById(t).set("isFavorite",!r)}},updateFavoriteStatusInContent:function(e){this.eventService.fireEvent(p.a.UPDATE_FAVORITE_STATUS_FROM_BG,{tabId:framework.browser.ALLTABS,data:e})},initPopup:function(){framework.ui.button.setPopup({url:"popup/popup.html",width:S.a.POPUP_WIDTH,height:S.a.POPUP_HEIGHT})},onPopupFirstOpening:function(){R.setBadge(""),O.a.get(S.a.POPUP_FIRST_OPENING_TOKEN,(function(e){e||O.a.set(S.a.POPUP_FIRST_OPENING_TOKEN,"Wow!")}))},onInstalledAndDelete:function(){var e=this,t=this;O.a.get("afterInstallPageIsShown",(function(r){if(!r){if(O.a.set("afterInstallPageIsShown",!0),T.a.isBrowser(S.a.BROWSER_NAME_FF)){var i=S.a.DEFAULT_FIREFOX_USER_SETTINGS;Object.keys(i).forEach((function(t){return Object(E.b)(e,void 0,void 0,(function(){var e;return Object(E.c)(this,(function(r){switch(r.label){case 0:return[4,O.a.syncGet(t)];case 1:return e=r.sent(),_.isUndefined(e)?(O.a.set(t,i[t]),[4,T.a.saveUserSettings(t,i[t])]):[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))}))}t.pushLogInstall(),_.delay((function(){framework.browser.navigate({tabId:framework.browser.NEWTAB,url:I.a.afterInstall()})}),500),chrome.runtime.setUninstallURL(I.a.afterDelete())}}))},pushLogInstall:function(){var e=this,t=e.user;if(t&&t.isLogin()){var r=T.a.getFullInfo(),i={url:I.a.logInstall(),type:"POST",data:{os:r.os,browser:r.browser,browser_version:r.version,extension_version:framework.extension.version},dataType:"json"};$.ajax(i).done(),clearInterval(e.intervalPushLogInstall)}else clearInterval(e.intervalPushLogInstall),e.intervalPushLogInstall=setInterval((function(){e.pushLogInstall(I.a.logInstall())}),S.a.INTERVAL_PUSH_LOG)},pushLogUserSettings:function(e){return Object(E.b)(this,void 0,void 0,(function(){var t,r,i;return Object(E.c)(this,(function(n){switch(n.label){case 0:return(t=this.user)&&t.isLogin()?[4,T.a.getUserSettings()]:[3,3];case 1:return r=n.sent()||{},i=T.a.isBrowser(S.a.BROWSER_NAME_FF)?S.a.DEFAULT_FIREFOX_USER_SETTINGS:S.a.DEFAULT_USER_SETTINGS,[4,Object.keys(i).forEach((function(e){r&&!r.hasOwnProperty(e)&&(r[e]=i[e],T.a.saveUserSettings(e,i[e]))}))];case 2:n.sent(),$.ajax({url:I.a.logUserSettings(),type:"POST",data:{type:e,settings:r},dataType:"json"}).done(),n.label=3;case 3:return[2]}}))}))},pushLogRequest:function(){var e=this,t=e.user;O.a.get("afterInstallPageIsShown",(function(r){r&&O.a.get("timePushLogRequest",(function(r){if((!r||_.now()-r>S.a.UPDATE_LOG_REQUEST)&&t&&t.isLogin()){var i=T.a.getFullInfo(),n={url:I.a.logRequest(),type:"POST",data:{os:i.os,browser:i.browser,browser_version:i.version,extension_version:framework.extension.version},dataType:"json"};$.ajax(n).done(),clearInterval(e.intervalPushLogRequest),O.a.set("timePushLogRequest",_.now())}}))}))},pushUserNotificationLogs:function(e){var t=this.user;if(t&&t.isLogin()&&e&&e.arrayNotifications&&e.arrayNotifications.length>0&&e.notificationEvent){var r=[];_.each(e.arrayNotifications,(function(i){r.push({user_id:t.get("token"),notification_id:i.id,notification_type:i.type,notification_recipient:S.a.NOTIFICATION_RECIPIENT,notification_event:e.notificationEvent})}));var i={url:I.a.userNotificationLogs(),type:"POST",data:{data:r},dataType:"json"};$.ajax(i).done()}},rivalAddListHandlerAjax:function(){return Object(E.b)(this,void 0,void 0,(function(){var e,t,r,i;return Object(E.c)(this,(function(n){switch(n.label){case 0:return e=this,[4,O.a.syncGet("locale")];case 1:return t=n.sent(),r={url:I.a.ddList()+"?locale="+(t||S.a.DEFAULT_LANGUAGE+"_"+S.a.DEFAULT_COUNTRY),type:"get",dataType:"json"},$.ajax(r).done((function(e){O.a.set("ddList",e)})),clearInterval(e.intervalRListHandlerAjax),[4,e.configService.getParameter(h.a.R_LIST_ADD_PERIOD)];case 2:return i=n.sent(),e.intervalRListHandlerAjax=setInterval((function(){e.rivalAddListHandlerAjax()}),i),[2]}}))}))},checkMerchantInAutopromo:function(e,t,r){void 0===r&&(r=null);var i=[];return Object.keys(e).forEach((function(t){"lastUpdate"!==t&&(i=Object(E.e)(i,e[t]))})),i.find((function(e){return parseInt(e.id)===parseInt(t)&&!_.isEmpty(e.autoPromotion)&&(e.autoPromotion.placements.includes(r)||_.isString(e.autoPromotion.endAt))}))},getCalculatedPriceForOffer:function(e){var t,r,i=e.cashbackRate&&e.cashbackRate.rate;if(i)switch(i.type){case"RATE_TYPE_PERCENT":return(e.productPriceValue*i.value*(null!==(t=e.userBonusCoefficient)&&void 0!==t?t:1)/100).toFixed(2);case"RATE_TYPE_FIXED":return(i.value*(null!==(r=e.userBonusCoefficient)&&void 0!==r?r:1)).toFixed(0)}return null},getValidAutopromoOffers:function(){return Object(E.b)(this,void 0,void 0,(function(){var e,t;return Object(E.c)(this,(function(r){switch(r.label){case 0:return e=this,[4,O.a.syncGet("simpleSimilarOffers")];case 1:return t=r.sent(),_.isEmpty(t)||_.isEmpty(t.autoPromotions)||!T.a.getEndedAutopromo(t)?[3,4]:(e.merchants.resetAll(),[4,e.user.rates.fetch(!0)]);case 2:return r.sent(),[4,e.eapiService.getSimpleSimilarOffers()];case 3:t=r.sent(),r.label=4;case 4:return[2,t]}}))}))},prepareProductOffers:function(e){return Object(E.b)(this,void 0,void 0,(function(){var t,r;return Object(E.c)(this,(function(i){switch(i.label){case 0:return[4,(t=this).getValidAutopromoOffers()];case 1:return r=i.sent(),[2,e.map((function(e){return t.addAutopromoAndCashbackToOffer(e,r)}))]}}))}))},addAutopromoAndCashbackToOffer:function(e,t){var r,i,n,a,o,s,c=this.merchants.getMerchantById(e.merchantId),u=c.get("suffix");if(e.cashbackFloated=c.get("cashbackFloated"),e.merchantTitle=c.get("title"),e.cashback=c.get("cashback"),e.userCashback=c.get("userCashback"),e.userBonusCoefficient=null!==(r=c.get("bonusCoefficient"))&&void 0!==r?r:null,e.userBonus=null!==(i=c.get("bonus"))&&void 0!==i?i:null,!_.isEmpty(e.cashbackRate)){var l=e.cashbackRate.rate;try{s=parseFloat((l.value*(null!==(n=e.userBonusCoefficient)&&void 0!==n?n:1)).toFixed(2))+u}catch(f){s=null}if(a=this.checkMerchantInAutopromo(t,e.merchantId,"similar_products"),o=this.getCalculatedPriceForOffer(e),!_.isEmpty(a)&&a.autoPromotion&&a.autoPromotion.bonus&&(e.userBonusCoefficient=T.a.calculateRateCoefficient(a.autoPromotion.bonus),s=parseFloat((l.value*e.userBonusCoefficient).toFixed(2))+u,o=this.getCalculatedPriceForOffer(e),!_.isEmpty(a.autoPromotion.maxLimit))){var d=!_.isEmpty(e.productPrice)&&e.productPrice.currency,h=a.autoPromotion.maxLimit[d.name];h&&+o>h.amount&&(o=h.amount)}}return Object(E.a)(Object(E.a)({},e),{userCashbackAmount:o,autopromo:a,userCashbackOffer:s})},clearCacheInterval:function(){var e=this;O.a.syncGet("userSettings").then((function(t){var r=t&&!t.showSimpleSimilarInjection&&!_.isUndefined(t.showSimpleSimilarInjection),i=t&&!t.showSimilarListInjection&&!_.isUndefined(t.showSimilarListInjection),n=t&&!t.showImageSearch&&!_.isUndefined(t.showImageSearch);clearInterval(e.clearCache),e.cleanSimpleSimilarCache(r&&n),e.cleanSimilarCache(i),r&&i&&n||(e.clearCache=setInterval((function(){e.clearCacheInterval()}),S.a.CLEAR_CACHE_INTERVAL))}))},cleanSimpleSimilarCache:function(e){O.a.syncGet("simpleSimilar").then((function(t){if(e||_.isEmpty(t))O.a.remove("simpleSimilar");else{var r=t.domainsList.filter((function(e){return"boolean"==typeof e.status?!e.status:e.status>Date.now()}));O.a.set("simpleSimilar",{domainsList:r,settings:t.settings})}}))},cleanSimilarCache:function(e){O.a.syncGet("similarList").then((function(t){var r,i;if(e||_.isEmpty(t))O.a.remove("similarList");else{var n={};try{for(var a=Object(E.f)(Object.keys(t)),o=a.next();!o.done;o=a.next()){var s=o.value,c=t[s],u=c.showMinimizedTill>Date.now(),l=c.blockedByDomain,d=c.blockedByTime&&c.blockedByTime>Date.now(),h=c.apiBlockTimeExpire&&_.now()-c.apiBlockTime<c.apiBlockTimeExpire;(u||l||d||h)&&(n[s]={blockedByDomain:c.blockedByDomain,blockedByTime:c.blockedByTime,apiBlockTime:c.apiBlockTime,apiBlockTimeExpire:c.apiBlockTimeExpire,showMinimizedTill:c.showMinimizedTill})}}catch(f){r={error:f}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}O.a.set("similarList",n)}}))}}),U=r("ofXK"),x=function(){function e(e){this.httpClient=e,this.googleAnalyticsURL="https://www.google-analytics.com",this.googleAnalyticsURLCollect="/collect",this.googleFormUrl="https://docs.google.com/forms",this.cloudFunctionUrl="https://us-central1-excellent-style-170512.cloudfunctions.net",this.cloudFunctionUrlCollect="/ga_extension"}return e.prototype.sendGoogleAnalyticsData=function(e){var t,r,i=new URL(""+this.googleAnalyticsURL+this.googleAnalyticsURLCollect);try{for(var n=Object(E.f)(Object.keys(e)),a=n.next();!a.done;a=n.next()){var o=a.value;try{i.searchParams.append(o,decodeURIComponent(e[o]))}catch(s){i.searchParams.append(o,e[o])}}}catch(c){t={error:c}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}this.httpClient.post(i.href,null,{responseType:"text"}).subscribe()},e.prototype.sendGoogleAnalyticsDataCloudFunction=function(e){this.httpClient.post(""+this.cloudFunctionUrl+this.cloudFunctionUrlCollect,JSON.stringify(e),{headers:{"Content-Type":"application/json"}}).subscribe()},e.prototype.sendGoogleFormData=function(e,t){var r,i,n=[];try{for(var a=Object(E.f)(Object.keys(e)),o=a.next();!o.done;o=a.next()){var s=o.value;n.push(encodeURIComponent(s)+"="+encodeURIComponent(e[s]))}}catch(c){r={error:c}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}this.httpClient.post(""+this.googleFormUrl+t,n.join("&"),{headers:{"Content-Type":"application/x-www-form-urlencoded"},responseType:"text"}).toPromise()},e.\u0275fac=function(t){return new(t||e)(s.Nc(u.a))},e.\u0275prov=s.Ac({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),j=function(){function e(e,t,r){this.googleService=e,this.eventService=t,this.bg=r,this.googleAnalyticsTID="UA-97996247-1",this.initializeGoogleAnalyticsHandler(r.application)}return e.prototype.initializeGoogleAnalyticsHandler=function(e){var t=this,r=e.get("user");this.eventService.attachEvent(p.a.SEND_GOOGLE_ANALYTICS,(function(i){var n=i.data;if(n||0!==Object.keys(n).length)switch(n.type){case"pageview":t.sendGoogleAnalyticsPageView(n.page,r,e);break;case"event":t.sendGoogleAnalyticsEvent(n.category,n.action,n.label,n.value,r,e)}})),this.eventService.attachEvent(p.a.SEND_GA_CID,(function(e){t.writeGoogleAnalyticsCID(e,r)})),this.eventService.attachEvent(p.a.SEND_TO_GOOGLE_FORM,(function(i){return Object(E.b)(t,void 0,void 0,(function(){var t,n,a,o;return Object(E.c)(this,(function(s){return t=i.data,n=t.body,a=t.replaceUserId,o=t.id,this.sendToGoogleForm(n,a,r,e,o),[2]}))}))}))},e.prototype.writeGoogleAnalyticsCID=function(e,t){t.set("googleAnalyticsCID",e.data)},e.prototype.sendGoogleAnalyticsPageView=function(e,t,r){return Object(E.b)(this,void 0,void 0,(function(){var i,n,a;return Object(E.c)(this,(function(o){switch(o.label){case 0:return T.a.isBrowser(S.a.BROWSER_NAME_FF)?[4,O.a.syncGet("allowAnalyticsCollect")]:[3,2];case 1:if(!o.sent())return[2];o.label=2;case 2:return i=t&&t.get("googleAnalyticsCID"),n=t&&t.get("token"),a={v:"1",tid:this.googleAnalyticsTID,cid:i||"anonymous",cd1:n||"0",cd2:i||"anonymous",t:"pageview",dp:e,cd4:Date.now(),cd5:framework.extension.version},this.analyticsDataRequestHandler(a,r),[2]}}))}))},e.prototype.sendGoogleAnalyticsEvent=function(e,t,r,i,n,a){return Object(E.b)(this,void 0,void 0,(function(){var o,s,c;return Object(E.c)(this,(function(u){switch(u.label){case 0:return T.a.isBrowser(S.a.BROWSER_NAME_FF)?[4,O.a.syncGet("allowAnalyticsCollect")]:[3,2];case 1:if(!u.sent())return[2];u.label=2;case 2:return o=n&&n.get("googleAnalyticsCID"),s=n&&n.get("token"),c={v:"1",tid:this.googleAnalyticsTID,cid:o||"anonymous",cd1:s||"0",cd2:o||"anonymous",t:"event",ec:e,ea:t,el:r,ev:i||0,cd4:Date.now(),cd5:framework.extension.version},this.analyticsDataRequestHandler(c,a),[2]}}))}))},e.prototype.sendToGoogleForm=function(e,t,r,i,n){e[t]=r.get("token")||0,this.googleService.sendGoogleFormData(e,n)},e.prototype.analyticsDataRequestHandler=function(e,t){this.googleService.sendGoogleAnalyticsData(e),this.googleService.sendGoogleAnalyticsDataCloudFunction(e)},e.\u0275mod=s.Cc({type:e}),e.\u0275inj=s.Bc({factory:function(t){return new(t||e)(s.Nc(x),s.Nc(p.a),s.Nc(d.a))},providers:[x],imports:[[U.a]]}),e}(),F=r("U+s4"),G=r("Zhdy"),H=function(){function e(e,t){this.eventService=e,this.clubService=t,this.attachListeners()}return e.prototype.attachListeners=function(){var e=this;this.eventService.attachEvent(p.a.GET_CLUB_OFFERS,(function(){return Object(E.b)(e,void 0,void 0,(function(){return Object(E.c)(this,(function(e){return[2,this.clubService.getOffers()]}))}))})),this.eventService.attachEvent(p.a.REFRESH_ALL,(function(){return Object(E.b)(e,void 0,void 0,(function(){return Object(E.c)(this,(function(e){return[2,this.clubService.clearCacheOffers()]}))}))}))},e.\u0275mod=s.Cc({type:e}),e.\u0275inj=s.Bc({factory:function(t){return new(t||e)(s.Nc(p.a),s.Nc(G.b))},providers:[G.b,p.a],imports:[[U.a]]}),e}(),B=function(e,t,r,i,n){void 0===n&&(n=null),this.domain=e,this.carpPage=t,this.thanksPage=r,this.parsePromoCode=i},V=function(e,t){this.urlPath=e,this.parameters=t},Y=function(e,t,r,i,n){this.parseType=e,this.requestMethod=t,this.requestType=r,this.requestUrl=i,this.requestData=n},K=function(e,t,r){this.shoppingVisitedId=e,this.timeCreateShoppingVisited=t,this.extensionVersion=r},W=function(){function e(e,t){this.httpClient=e,this.cacheService=t,this.cachePrefix="shops",this.cacheKey="promoCode",this.cacheTime=18e5,this.baseUrl=I.a._api,this.pathLogPromoCode="/log-promo-code",this.pathShopsPromoCode="/shops-promo-code",this.shopsPromoCode=new Array}return e.prototype.getShopsPromoCode=function(){return Object(E.b)(this,void 0,void 0,(function(){var e,t=this;return Object(E.c)(this,(function(r){switch(r.label){case 0:return[4,this.cacheService.get(this.cachePrefix,this.cacheKey)];case 1:return(e=r.sent())&&e.length?[2,e]:[4,this.httpClient.get(""+this.baseUrl+this.pathShopsPromoCode,{headers:{"Content-Type":"application/json"}}).toPromise().then((function(e){t.shopsPromoCode=e.map((function(e){var t=new Y(e.parsePromoCode.parseType,e.parsePromoCode.requestMethod,e.parsePromoCode.requestType,e.parsePromoCode.requestUrl,e.parsePromoCode.requestData),r=new V(e.thanksPage.urlPath,e.thanksPage.parameters);return new B(e.domain,e.carpPage,r,t)})),t.cacheService.set(t.cachePrefix,t.cacheKey,t.cacheTime,t.shopsPromoCode)}))];case 2:return r.sent(),[2,this.shopsPromoCode]}}))}))},e.prototype.sendLogPromoCode=function(e){this.httpClient.post(""+this.baseUrl+this.pathLogPromoCode,JSON.stringify(e),{headers:{"Content-Type":"application/json"}}).toPromise().then()},e.\u0275fac=function(t){return new(t||e)(s.Nc(u.a),s.Nc(F.a))},e.\u0275prov=s.Ac({token:e,factory:e.\u0275fac,providedIn:q}),e}(),q=function(){function e(e){var t=this;this.parsePromoCodeService=e,this.shopsPromoCode=new Array,this.timeoutShoppingVisited=36e5,this.parsePromoCodeService.getShopsPromoCode().then((function(e){t.shopsPromoCode=e,t.shopsPromoCode&&t.shopsPromoCode.length>0&&(t.addListenerWebRequestOnCompleted(),t.addListenerWebRequestOnBeforeRequest())}))}return e.prototype.createShoppingVisitedId=function(e,t,r){var i;if(e.shoppingVisited){if(i=e.shoppingVisited,Date.now()<i.timeCreateShoppingVisited)return i.timeCreateShoppingVisited=Date.now()+this.timeoutShoppingVisited,void(e.shoppingVisited=i);i=new K(T.a.guid(),Date.now()+36e5,chrome.runtime.getManifest().version),e.shoppingVisited=i}else i=new K(T.a.guid(),Date.now()+this.timeoutShoppingVisited,chrome.runtime.getManifest().version),e.shoppingVisited=i;var n={shopping_visited_id:e.shoppingVisited.shoppingVisitedId,domain:e.domain,event_type:1,extension_version:e.shoppingVisited.extensionVersion,data:{tab:{referrer:t.initiator,url:t.url},environment:{os:r.os,os_version:r.osversion,browser:r.browser,browser_version:r.version}}};this.parsePromoCodeService.sendLogPromoCode(n)},e.prototype.addListenerWebRequestOnCompleted=function(){var e=this;chrome.webRequest.onCompleted.addListener((function(t){var r=T.a.getFullInfo(),i=null;try{i=T.a.getDomain(t.initiator)}catch(n){}e.shopsPromoCode.find((function(n){if(n.domain===i||t.url.includes(n.domain)){if(e.createShoppingVisitedId(n,t,r),t.url.includes(n.carpPage)){var a={shopping_visited_id:n.shoppingVisited.shoppingVisitedId,domain:n.domain,event_type:3,extension_version:n.shoppingVisited.extensionVersion,data:{tab:{referrer:t.initiator,url:t.url},environment:{os:r.os,os_version:r.osversion,browser:r.browser,browser_version:r.version}}};e.parsePromoCodeService.sendLogPromoCode(a)}if(t.url.includes(n.thanksPage.urlPath)){a={shopping_visited_id:n.shoppingVisited.shoppingVisitedId,domain:n.domain,event_type:4,extension_version:n.shoppingVisited.extensionVersion,data:{tab:{referrer:t.initiator,url:t.url},environment:{os:r.os,os_version:r.osversion,browser:r.browser,browser_version:r.version}}};e.parsePromoCodeService.sendLogPromoCode(a)}}}))}),{urls:["<all_urls>"],types:["main_frame"]})},e.prototype.addListenerWebRequestOnBeforeRequest=function(){var e=this;chrome.webRequest.onBeforeRequest.addListener((function(t){var r=T.a.getFullInfo(),i=null;try{i=T.a.getDomain(t.initiator)}catch(n){}e.shopsPromoCode.find((function(n){var a,o;if(n.domain===i||t.url.includes(n.domain)){var s=n.parsePromoCode;if(t.url.includes(s.requestUrl)&&t.method===s.requestMethod&&t.type===s.requestType){var c=void 0;switch(s.parseType){case"requestBody":if(t.requestBody&&t.requestBody.raw){var u=JSON.parse(decodeURIComponent(String.fromCharCode.apply(null,new Uint8Array(t.requestBody.raw[0].bytes)))),l=s.requestData.split(".");if(u)try{for(var d=Object(E.f)(l),h=d.next();!h.done;h=d.next()){var f=h.value;c=u[f],u=u[f]}}catch(m){a={error:m}}finally{try{h&&!h.done&&(o=d.return)&&o.call(d)}finally{if(a)throw a.error}}else c=u[s.requestData]}else if(t.requestBody&&t.requestBody.formData){c=(u=t.requestBody.formData)[s.requestData][0]}break;case"requestRegExp":c=decodeURIComponent(t.url).match(new RegExp(s.requestData))[1]}var p={shopping_visited_id:n.shoppingVisited.shoppingVisitedId,domain:n.domain,event_type:2,extension_version:n.shoppingVisited.extensionVersion,data:{promo_code:c,tab:{referrer:t.initiator,url:t.url},environment:{os:r.os,os_version:r.osversion,browser:r.browser,browser_version:r.version}}};e.parsePromoCodeService.sendLogPromoCode(p)}}}))}),{urls:["<all_urls>"]},["requestBody"])},e.\u0275mod=s.Cc({type:e}),e.\u0275inj=s.Bc({factory:function(t){return new(t||e)(s.Nc(W))},providers:[W,p.a],imports:[[U.a]]}),e}(),X=r("u8hG"),z=r("Wz/G"),J=function(){function e(e,t,r,i){this.aliexpressProductsService=e,this.priceMonitoringServices=t,this.eventService=r,this.bg=i,this.application=i.application,this.addEventListener()}return e.prototype.addEventListener=function(){var e=this;this.eventService.attachEvent(p.a.PRICE_MONITORING_GET_DATA,(function(t){return Object(E.b)(e,void 0,void 0,(function(){var e;return Object(E.c)(this,(function(r){switch(r.label){case 0:return t.tabId||(t.tabId=this.application.tabs.currentTabId),[4,this.priceMonitoringServices.init(t,this.application)];case 1:return e=r.sent(),[2,JSON.parse(JSON.stringify(e))]}}))}))})),this.eventService.attachEvent(p.a.PRICE_MONITORING_GET_CHART_DATA,(function(t){return Object(E.b)(e,void 0,void 0,(function(){var e;return Object(E.c)(this,(function(r){switch(r.label){case 0:return[4,this.priceMonitoringServices.getPriceDynamicChartData(t)];case 1:return e=r.sent(),[2,JSON.parse(JSON.stringify(e))]}}))}))})),this.eventService.attachEvent(p.a.PRICE_MONITORING_GET_SIMILAR_PRODUCTS,(function(t){return Object(E.b)(e,void 0,void 0,(function(){var e;return Object(E.c)(this,(function(r){switch(r.label){case 0:return[4,this.priceMonitoringServices.getSimilarProducts(t)];case 1:return e=r.sent(),[2,JSON.parse(JSON.stringify(e))]}}))}))})),this.eventService.attachEvent(p.a.PRICE_MONITORING_CLEAR_HISTORY,(function(){var t=e.priceMonitoringServices.clearHistoryItems();return JSON.parse(JSON.stringify(t))}))},e.\u0275mod=s.Cc({type:e}),e.\u0275inj=s.Bc({factory:function(t){return new(t||e)(s.Nc(z.a),s.Nc(X.a),s.Nc(p.a),s.Nc(d.a))},providers:[X.a,p.a],imports:[[U.a]]}),e}(),Z=function(){function e(){}return e.prototype.ngDoBootstrap=function(e){},e.\u0275mod=s.Cc({type:e}),e.\u0275inj=s.Bc({factory:function(t){return new(t||e)},providers:[v.a,f.a,p.a,h.a,F.a,m.a,{provide:s.c,useFactory:function(e,t,r,i,n,a){window.application=new M({similarToolsService:e,eapiService:t,eventService:r,configService:i,featureService:n,localeService:a})},deps:[v.a,f.a,p.a,h.a,m.a,g.a]},{provide:d.a,useFactory:function(){return framework.extension.getBackgroundPage()}}],imports:[[l.a,u.b,j,H,q,J]]}),e}();c.a.production&&Object(s.jb)(),l.c().bootstrapModule(Z,{ngZone:"noop"}).catch((function(e){return console.error(e)}))},HTEd:function(e,t,r){r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a}));var i=r("fXoL"),n=new i.A("Current extension background instance"),a=new i.A("Extension framework")},LWby:function(e,t,r){r.d(t,"a",(function(){return a}));var i=r("mrSG"),n=r("xOb2"),a=function(){function e(){this.configKey="config",this.parameters={UPDATE_INTERVAL_MERCHANT:72e5,UPDATE_INTERVAL_OFFERS:9e5,UPDATE_INTERVAL_CODES:72e5,UPDATE_INTERVAL_SETTINGS:72e5,UPDATE_INTERVAL_URLS:72e5,PROMO_NOTIFY_PERIOD:36e5,R_LIST_ADD_PERIOD:432e5,USER_NOTIFY_INTERVAL:3e5,INTERVAL_COUNT_USER_CASHBACK_RATES:3e5,INTERVAL_COUNT_CLUB_OFFERS:18e6,INTERVAL_COUNT_SETTINGS_BY_SEGMENT:72e5,UPDATE_INTERVAL_USER_FORCE:144e5,INTERVAL_COUNT_SETTINGS_SIMPLE_SIMILAR:72e5,UPDATE_INTERVAL_AUTOPROMO:36e5,INTERVAL_SHOPPING_TRIP_ID:36e5,UPDATE_INTERVAL_USER_PARTNER_SETTINGS:216e5,UPDATE_INTERVAL_INFO_SIMILAR:12e4,GREEN_LIGHT_BOOKING_END_TIME:1635724799e3}}return e.prototype.getParameter=function(e){return Object(i.b)(this,void 0,void 0,(function(){var t;return Object(i.c)(this,(function(r){switch(r.label){case 0:return[4,n.a.syncGet(this.configKey)];case 1:return void 0!==(t=r.sent())&&Object.keys(t).length===Object.keys(this.parameters).length&&t[e]?this.parameters=t:n.a.set(this.configKey,this.parameters),[2,this.parameters[e]]}}))}))},e.prototype.updateConfig=function(e){var t=this;n.a.syncGet(this.configKey).then((function(r){return Object(i.b)(t,void 0,void 0,(function(){var t,a,o,s,c;return Object(i.c)(this,(function(u){try{for(t=Object(i.f)(Object.keys(e)),a=t.next();!a.done;a=t.next())o=a.value,r[o]=e[o]}catch(l){s={error:l}}finally{try{a&&!a.done&&(c=t.return)&&c.call(t)}finally{if(s)throw s.error}}return n.a.set(this.configKey,r),[2]}))}))}))},e.UPDATE_INTERVAL_MERCHANT="UPDATE_INTERVAL_MERCHANT",e.UPDATE_INTERVAL_OFFERS="UPDATE_INTERVAL_OFFERS",e.UPDATE_INTERVAL_CODES="UPDATE_INTERVAL_CODES",e.UPDATE_INTERVAL_SETTINGS="UPDATE_INTERVAL_SETTINGS",e.UPDATE_INTERVAL_URLS="UPDATE_INTERVAL_URLS",e.PROMO_NOTIFY_PERIOD="PROMO_NOTIFY_PERIOD",e.R_LIST_ADD_PERIOD="R_LIST_ADD_PERIOD",e.USER_NOTIFY_INTERVAL="USER_NOTIFY_INTERVAL",e.INTERVAL_COUNT_USER_CASHBACK_RATES="INTERVAL_COUNT_USER_CASHBACK_RATES",e.INTERVAL_COUNT_CLUB_OFFERS="INTERVAL_COUNT_CLUB_OFFERS",e.INTERVAL_COUNT_SETTINGS_BY_SEGMENT="INTERVAL_COUNT_SETTINGS_BY_SEGMENT",e.UPDATE_INTERVAL_USER_FORCE="UPDATE_INTERVAL_USER_FORCE",e.UPDATE_INTERVAL_AUTOPROMO="UPDATE_INTERVAL_AUTOPROMO",e.INTERVAL_COUNT_SETTINGS_SIMPLE_SIMILAR="INTERVAL_COUNT_SETTINGS_SIMPLE_SIMILAR",e.INTERVAL_SHOPPING_TRIP_ID="INTERVAL_SHOPPING_TRIP_ID",e.UPDATE_INTERVAL_USER_PARTNER_SETTINGS="UPDATE_INTERVAL_USER_PARTNER_SETTINGS",e.UPDATE_INTERVAL_INFO_SIMILAR="UPDATE_INTERVAL_INFO_SIMILAR",e.GREEN_LIGHT_BOOKING_END_TIME="GREEN_LIGHT_BOOKING_END_TIME",e}()},OTfX:function(e,t,r){var i;r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return n})),function(e){e[e.DISCOUNT=1]="DISCOUNT",e[e.CODE=2]="CODE",e[e.STOCK=4]="STOCK"}(i||(i={}));var n=function(e){this.id=e.id,this.currency=e.currency,this.description=e.description,this.link=e.link,this.status=e.status,this.title=e.title,this.totalComments=e.totalComments,this.totalLikes=e.totalLikes,this.url=e.url,this.imagePath=e.imagePath,this.offerType=e.offerType,this.discount=e.discount?new a(e.discount):null,this.shop=e.shop?new o(e.shop):null},a=function(e){this.type=e.type,this.value=e.value?Math.round(e.value):null},o=function(e){this.id=e.id,this.link=e.link,this.name=e.name}},"U+s4":function(e,t,r){r.d(t,"a",(function(){return o}));var i=r("mrSG"),n=r("fXoL"),a=r("xOb2"),o=function(){function e(){}return e.createKey=function(e,t){return e+"."+t},Object.defineProperty(e.prototype,"now",{get:function(){return(new Date).getTime()},enumerable:!1,configurable:!0}),e.prototype.get=function(t,r){return Object(i.b)(this,void 0,void 0,(function(){var n,o,s;return Object(i.c)(this,(function(i){switch(i.label){case 0:return[4,a.a.syncGet(e.createKey(t,r))];case 1:return n=i.sent()||{},o=n.payload,s=n.expired,o&&s&&s>this.now?[2,o]:[2,null]}}))}))},e.prototype.set=function(t,r,i,n){a.a.set(e.createKey(t,r),{payload:n,expired:this.now+i})},e.prototype.remove=function(t,r){a.a.remove(e.createKey(t,r))},e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=n.Ac({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},VSgK:function(e,t,r){r.d(t,"a",(function(){return p}));var i=r("mrSG"),n=r("fXoL"),a=r("cftt"),o=r("dkLR"),s=r("A1rn"),c=r("y7o/"),u=r("LWby"),l=r("EVkI"),d=r("xOb2"),h=r("tk/3"),f=r("dje0"),p=function(){function e(e,t,r,i){this.httpClient=e,this.configService=t,this.eventService=r,this.featureService=i,this.cashbackIsAvailable="/api/extension/v1/cashback/is-available",this.eventInform="/api/extension/v1/event/inform",this.productImageDetect="/api/extension/v1/product-by-image/detect",this.similarList="/twirp/letytools.api.v2.SimilarService/list",this.itemHot="/api/extension/v1/item/hot",this.minAvailableApplying=5}return Object.defineProperty(e.prototype,"baseUrl",{get:function(){return a.a._tools},enumerable:!1,configurable:!0}),e.prototype.getHeaders=function(e,t){e=e.attributes?e.attributes:e;return{Accept:"application/json","Content-Type":"application/json","app-token":o.a.APP_TOKEN,"extension-token":e.tokenCookies&&e.tokenCookies.eaetkn?e.tokenCookies.eaetkn:"","user-token":e.tokenCookies&&e.tokenCookies.eautkn?e.tokenCookies.eautkn:"",referrer:t||"","version-ext":chrome.runtime.getManifest().version}},e.prototype.sendCashbackIsAvailable=function(e,t,r,n){var a=new URL(""+this.baseUrl+this.cashbackIsAvailable),o={url:t.href};Object.keys(o).forEach((function(e){a.searchParams.append(e,o[e])})),this.httpClient.get(a.href,{headers:this.getHeaders(e,r)}).toPromise().then((function(e){var r=c.a.getDomain(a),o=r&&n.get("merchants").selectByDomain(r);o?o.set({isCashbackAvailable:{code:e.code,expire:1e3*e.expire,lastTimeRequest:(new Date).getTime()}}):d.a.get("isCashbackAvailable",(function(r){var n,a,o,s;if(r){var c=[];try{for(var u=Object(i.f)(r),l=u.next();!l.done;l=u.next()){var h=l.value;c.push(h.url)}}catch(m){n={error:m}}finally{try{l&&!l.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}if(c.includes(t.host)){try{for(var f=Object(i.f)(r),p=f.next();!p.done;p=f.next()){h=p.value;t.host===h.url&&(h.url=t.host,h.code=e.code,h.expire=1e3*e.expire,h.lastTimeRequest=(new Date).getTime())}}catch(g){o={error:g}}finally{try{p&&!p.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}d.a.set("isCashbackAvailable",r)}else r.push({url:t.host,code:e.code,expire:1e3*e.expire,lastTimeRequest:(new Date).getTime()}),d.a.set("isCashbackAvailable",r)}else(r=[]).push({url:t.host,code:e.code,expire:1e3*e.expire,lastTimeRequest:(new Date).getTime()}),d.a.set("isCashbackAvailable",r)}))}))},e.prototype.getItemHot=function(e,t){return Object(i.b)(this,void 0,void 0,(function(){var r,n;return Object(i.c)(this,(function(i){return r=new URL(""+this.baseUrl+this.itemHot),n={url:e},Object.keys(n).forEach((function(e){r.searchParams.append(e,n[e])})),[2,this.httpClient.get(r.href,{headers:this.getHeaders(t)}).toPromise().then((function(e){return e}))]}))}))},e.prototype.letyToolEvent=function(e,t){this.httpClient.post(""+this.baseUrl+this.eventInform,JSON.stringify({name:e.data.name,data:e.data.data}),{headers:this.getHeaders(t)}).toPromise().then((function(e){return e}))},e.prototype.getSimilarList=function(e,t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.c)(this,(function(r){return[2,this.httpClient.post(""+this.baseUrl+this.similarList,JSON.stringify(e),{headers:this.getHeaders(t)}).toPromise().then((function(e){return e}))]}))}))},e.prototype.getItemImageSearch=function(e,t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.c)(this,(function(r){return[2,this.httpClient.post(""+this.baseUrl+this.productImageDetect,JSON.stringify(e),{headers:this.getHeaders(t)}).toPromise().then((function(e){return e}))]}))}))},e.prototype.getBase64FromBg=function(e){var t=e.url;return this.eventService.fireEvent(l.a.GET_IMAGE_INITIAL_BASE_64,{tabId:null,data:{url:t,options:{format:"image/jpeg",maxWidth:1e3,maxHeight:1e3}}})},e.prototype.disableTool=function(t){return Object(i.b)(this,void 0,void 0,(function(){var r,n,a;return Object(i.c)(this,(function(i){switch(i.label){case 0:switch(r=t.type,n=t.placement,a=c.a.getDomain(window.location.href),n){case e.SIMILAR:return[3,1];case e.SIMPLE_SIMILAR:return[3,3]}return[3,5];case 1:return[4,this.disableSimilarTool(r,a)];case 2:return[2,i.sent()];case 3:return[4,this.disableSimpleSimilarTool(r,a)];case 4:return[2,i.sent()];case 5:return[2]}}))}))},e.prototype.fetchDomainData=function(e){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.c)(this,(function(t){return[2,this.eventService.fireEvent(o.a.GET_SIMPLE_SIMILAR_DOMAIN_DATA,{domain:e})]}))}))},e.prototype.getSimilarData=function(e){var t=this,r=e.token?e.token:"0",n=window.location.pathname,a=window.location.href.split("#")[0]+"_user_"+r,o=c.a.getDomain(window.location.href),s=this;return new Promise((function(r){return Object(i.b)(t,void 0,void 0,(function(){var t,c,u,l,d,h;return Object(i.c)(this,(function(i){switch(i.label){case 0:return[4,s.checkOffersFromStorage({similarKey:a,domainKey:o,pagePathname:n})];case 1:return t=i.sent(),c=t.status,u=t.fetch,l=t.showMinimizedTill,u?[4,s.fetchOffers({user:e,similarKey:a,domainKey:o})]:[2,r(c)];case 2:return d=i.sent(),[4,s.renderChecker({offer:d,cache:!1,pagePathname:n,showMinimizedTill:l})];case 3:return h=i.sent(),[2,r(h)]}}))}))}))},e.prototype.checkOffersFromStorage=function(e){return Object(i.b)(this,void 0,void 0,(function(){var t,r,n,a,o=this;return Object(i.c)(this,(function(s){switch(s.label){case 0:return t=e.domainKey,r=e.similarKey,n=e.pagePathname,[4,d.a.syncGet("similarList")];case 1:return a=s.sent(),[2,new Promise((function(e){return Object(i.b)(o,void 0,void 0,(function(){var o,s,c,l,d,h,f;return Object(i.c)(this,(function(i){switch(i.label){case 0:return a&&a[t]?(o=a[t].blockedByDomain,s=a[t].showMinimizedTill,c=a[t].blockedByTime&&a[t].blockedByTime>Date.now(),l=a[t].apiBlockTimeExpire&&Date.now()-a[t].apiBlockTime<a[t].apiBlockTimeExpire,o||c||l?[2,e({status:!1,fetch:!1,showMinimizedTill:s})]:a[t][r]?(d=a[t][r],[4,this.configService.getParameter(u.a.UPDATE_INTERVAL_INFO_SIMILAR)]):[3,3]):[3,4];case 1:return h=i.sent(),Date.now()-d.lastTimeUpdated>h?[2,e({status:!1,fetch:!0,showMinimizedTill:s})]:[4,this.renderChecker({offer:d,cache:!0,pagePathname:n,showMinimizedTill:s})];case 2:return f=i.sent(),[2,e({status:f,fetch:!1})];case 3:case 4:return[2,e({status:!1,fetch:!0,showMinimizedTill:s})]}}))}))}))]}}))}))},e.prototype.renderChecker=function(e){var t=this,r=e.offer,n=e.cache,a=e.pagePathname,o=e.showMinimizedTill,s=r&&r.offers&&r.offers.length,c=r&&r.params&&r.params.isPreview,u=!o||Date.now()>o;return new Promise((function(e){return Object(i.b)(t,void 0,void 0,(function(){var t,o;return Object(i.c)(this,(function(l){switch(l.label){case 0:return s&&a===window.location.pathname?(t=r,[4,this.getOffersFromBackground(r.offers,null===(o=r.params)||void 0===o?void 0:o.isUsedImageSearch)]):[3,2];case 1:return t.offers=l.sent(),[2,e(Object(i.a)(Object(i.a)({},r),{cache:n,isPreview:u||c}))];case 2:return[2,e(!1)]}}))}))}))},e.prototype.fetchOffers=function(e){return Object(i.b)(this,void 0,void 0,(function(){var t,r,n,a,o,c,u,h,f,p,m;return Object(i.c)(this,(function(i){switch(i.label){case 0:return t=this,r=e.user,n=e.domainKey,a=e.similarKey,[4,s.a.getAdditionalParams()];case 1:return o=i.sent(),m={title:o.title,url:window.location.href,currency:o.currencyCode,brand:o.brand,scoreSummary:o.scoreSummary,itemName:o.itemName,articleId:o.articleId,h1:o.h1,imgUrl:o.img},[4,t.getBase64FromBg({url:o.img})];case 2:return m.imgBody=i.sent(),m.price=o.price,c=m,[4,d.a.syncGet("locale")];case 3:return u=i.sent(),h=null!=u?u:u.split("_")[1].toUpperCase(),f=r&&r.balanceInfo&&r.balanceInfo.currency||null,p=r&&r.country||h||null,[2,this.eventService.fireEvent(l.a.NOTIFICATION_GET_SIMILAR_LIST,{tabId:null,data:{similarRequestParams:{page:c,country:p,currency:f},storageData:{domainKey:n,similarKey:a}}}).then((function(e){return e}))]}}))}))},e.prototype.getOffersFromBackground=function(e,t){return Object(i.b)(this,void 0,void 0,(function(){var r,n,a;return Object(i.c)(this,(function(o){switch(o.label){case 0:return r=t?"similar_is":"similar",[4,this.eventService.fireEvent(l.a.GET_OFFERS_WITH_AUTOPROMO_AND_CASHBACK,{tabId:null,data:{offers:e}})];case 1:return n=o.sent(),a={apply_autopromo:"0",ext_feature:"similar",hide_timer:"true",utm_source:"extension",utm_medium:"similar",utm_campaign:r,utm_content:c.a.getDomain(window.location.href),utm_term:framework.browser.name.toLowerCase()},[2,n&&n.map((function(e){var t=Object(i.a)({},a);return e.autopromo&&(t.utm_campaign=r+"_autopromo",t.apply_autopromo="0",e.autopromo.autoPromotion.endAt||(t.apply_autopromo=""+e.autopromo.autoPromotion.id)),e.link+="&"+c.a.urlFromObject(t),e}))]}}))}))},e.prototype.disableSimilarTool=function(e,t){return Object(i.b)(this,void 0,void 0,(function(){var r,n;return Object(i.c)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,d.a.syncGet("similarList")];case 1:return(r=i.sent())||(r={}),r[t]||(r[t]={}),"day"===e&&((n=new Date).setHours(23,59,59,999),r[t].blockedByTime=n.getTime()),"domain"===e&&(r[t].blockedByDomain=!0),"hour"===e&&(r[t].showMinimizedTill=Date.now()+o.a.SIMILAR_MINIMIZED_TYPE_VIEW_PERIOD),d.a.set("similarList",r),[2,!0];case 2:return i.sent(),[2,!1];case 3:return[2]}}))}))},e.prototype.getSimpleSimilarDomainData=function(e,t){return Object(i.b)(this,void 0,void 0,(function(){var r,n,a,o,s,c,u,l,d,h,f,p,m,g;return Object(i.c)(this,(function(_){switch(_.label){case 0:if((n=t.domainsList.filter((function(t){return t.domain.replace("www.","").includes(e)})))&&n.length)if((a=window.location.pathname)&&"/"!==a){"__",o=(e+a).split("/").filter((function(e){return e.length})),s=o.join("__"),(c=n.map((function(e){var t=e.domain.split("/").filter((function(e){return e.length}));return{splitValue:t.length<=o.length&&t,domain:e.domain}}))).sort((function(e,t){return e.splitValue.length-t.splitValue.length}));try{for(l=Object(i.f)(c),d=l.next();!d.done;d=l.next())if(h=d.value,f=h.splitValue&&h.splitValue.join("__")){if(s===f){u=h.domain;break}s.includes(f)&&(u=h.domain)}}catch(v){m={error:v}}finally{try{d&&!d.done&&(g=l.return)&&g.call(l)}finally{if(m)throw m.error}}r=n.find((function(e){return e.domain===u}))}else r=n.find((function(t){return t.domain===e}));return p=t.settings.offers_show_count?t.settings.offers_show_count:3,[4,this.getAutopromoOffersForDomain(r,p)];case 1:return[2,_.sent()]}}))}))},e.prototype.getAutopromoOffersForDomain=function(e,t){return Object(i.b)(this,void 0,void 0,(function(){var r,n;return Object(i.c)(this,(function(i){switch(i.label){case 0:if(!e)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.getSimpleSimilarOffersByCategory(e.kind_id,e.kind_type)];case 2:return r=i.sent(),_.isEmpty(r)||(r.forEach((function(t,r){var i={};try{i={utmSource:"extension",utmMedium:"simplesimilar",utmCampaign:"SSautopromo",utmContent:c.a.getDomain(window.location.href)}}catch(n){throw new Error(n)}t.link=t.link?t.link:e.link,!_.isEmpty(t.autoPromotion)&&t.autoPromotion.placements.includes("simple_similar")&&(t.link=a.a._root+"/view/"+t.id,t.autoPromotion.endAt||(i.applyAutopromo=""+t.autoPromotion.id)),t.utm=c.a.urlFromObject(c.a.objectKeysTransform(i,"snakecase"))})),e.offers=r.slice(0,t)),[2,e];case 3:throw n=i.sent(),new Error(n);case 4:return[2,e]}}))}))},e.prototype.getSimpleSimilarOffersByCategory=function(e,t){return Object(i.b)(this,void 0,void 0,(function(){var r,n;return Object(i.c)(this,(function(i){switch(i.label){case 0:return r=this,[4,d.a.syncGet("simpleSimilarOffers")];case 1:return n=i.sent(),[2,r.filterOffers(n,e,t)]}}))}))},e.prototype.filterOffers=function(e,t,r){return 0==+t&&"shops"===r?this.sortOffersForAllCategory(e,t,r):this.sortOffersByCategoryId(e,t)},e.prototype.sortOffersByCategoryId=function(e,t){var r=this,n=[];return _.isEmpty(e)||Object.keys(e).forEach((function(a){if("lastUpdate"!==a){var o=e[a].filter((function(e){var i=e.categoryIds,n=e.autoPromotion,a=(i||[]).includes(""+t),o=!_.isEmpty(n);return a&&o&&n.availableApplying>=r.minAvailableApplying&&(n.placements.includes("simple_similar")||_.isString(n.endAt))}));o=r.sortOffers(o),n=Object(i.e)(n,o)}})),n},e.prototype.sortOffersForAllCategory=function(e,t,r){var n=this,a=[];return _.isEmpty(e)||Object.keys(e).forEach((function(o){if("lastUpdate"!==o){var s=e[o].filter((function(e){var i=e.autoPromotion,a=0==+t&&"shops"===r,o=!_.isEmpty(i);return a&&o&&i.availableApplying>=n.minAvailableApplying&&(i.placements.includes("simple_similar")||_.isString(i.endAt))}));s=n.sortOffers(s),a=Object(i.e)(a,s)}})),a},e.prototype.sortOffers=function(e){var t=this,r=e.slice();return _.isEmpty(e)||r.sort((function(e,r){var i=t.sortRule(e.autoPromotion.weight,r.autoPromotion.weight,!0);return 0===i?t.sortRule(e.cashbackRate.calculatedValue,r.cashbackRate.calculatedValue):i})),r},e.prototype.sortRule=function(e,t,r){return void 0===r&&(r=!1),e>t?r?1:-1:e<t?r?-1:1:0},e.prototype.incrementSimpleSimilarView=function(e,t,r){var n=e.domain,a=c.a.getDomain(window.location.href),o=Object(i.a)({},t);o.domainsList.forEach((function(e){(e.domain===n||e.domain.includes(a)&&0===e.domain.lastIndexOf(a))&&Object.keys(r).forEach((function(t){e[t]=r[t]}))})),d.a.set("simpleSimilar",o)},e.prototype.disableSimpleSimilarTool=function(e,t){return Object(i.b)(this,void 0,void 0,(function(){var r,n,a,s;return Object(i.c)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,d.a.syncGet("simpleSimilar")];case 1:return r=i.sent(),n=!1,a=function(){if("day"===e){var t=new Date;return t.setHours(23,59,59,999),t.getTime()}return"domain"!==e&&("hour"===e?Date.now()+o.a.PERIOD_DISABLED_FOR_HOUR:void 0)},r||(r={domainsList:[],settings:o.a.SIMPLE_SIMILAR_VIEWS_SETTINGS}),r.domainsList.forEach((function(e){(e.domain===t||e.domain.includes(t)&&0===e.domain.lastIndexOf(t))&&(n=!0,e.status=a())})),n||(s=a(),r.domainsList.push({domain:t,status:s})),d.a.set("simpleSimilar",r),[2,!0];case 2:return i.sent(),[2,!1];case 3:return[2]}}))}))},e.SIMILAR="SIMILAR",e.SIMPLE_SIMILAR="SIMPLE_SIMILAR",e.\u0275fac=function(t){return new(t||e)(n.Nc(h.a),n.Nc(u.a),n.Nc(l.a),n.Nc(f.a))},e.\u0275prov=n.Ac({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},"Wz/G":function(e,t,r){r.d(t,"a",(function(){return o}));var i=r("mrSG"),n=r("fXoL"),a=r("tk/3"),o=function(){function e(e){this.httpClient=e,this.baseUrl="https://gpsfront.aliexpress.com",this.recommendingResults="/getI2iRecommendingResults.do",this.baseUrlNewDesign="https://aliexpress.ru/aer-api/v1",this.recommendation="/seller/recommendation",this.specialForYou="/product/detail/special_for_you"}return e.prototype.getAliSimilarItems=function(e,t,r,i,n,a,o){return void 0===n&&(n="pcDetailLeftTopSell"),void 0===a&&(a=50),void 0===o&&(o=0),""+this.baseUrl+this.recommendingResults+"?currentItemList="+e+"&categoryId="+t+"&shopId="+r+"&companyId="+i+"&scenario="+n+"&limit="+a+"&offset="+o},e.prototype.getAliexpressSimilarItems=function(e){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.c)(this,(function(t){return[2,this.httpClient.get(e).toPromise().then((function(e){var t,r,n=[];if(e&&e.results.length)try{for(var a=Object(i.f)(e.results),o=a.next();!o.done;o=a.next()){var s=o.value,c=new URL("https:"+s.productDetailUrl);s.productDetailUrl=c.origin+c.pathname,n.push(s)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return n}))]}))}))},e.prototype.getAliexpressRecommendation=function(e){return""+this.baseUrlNewDesign+this.recommendation+"?product_id="+e},e.prototype.getAliexpressSpecialForYou=function(e){return""+this.baseUrlNewDesign+this.specialForYou+"?product_id="+e},e.prototype.getAliexpressRecommendationSimilarItems=function(e){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.c)(this,(function(t){return[2,this.httpClient.post(e,JSON.stringify({pageSize:50})).toPromise().then((function(e){var t,r,n=[];if(e&&e.products.length)try{for(var a=Object(i.f)(e.products),o=a.next();!o.done;o=a.next()){var s=o.value,c=new URL("https:"+s.url);s.productDetailUrl=c.origin+c.pathname,s.productId=s.id,s.productImage=s.imgUrl,s.productTitle=s.title,s.minPrice=s.price,n.push(s)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return n}))]}))}))},e.\u0275fac=function(t){return new(t||e)(n.Nc(a.a))},e.\u0275prov=n.Ac({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},Zhdy:function(e,t,r){r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return g}));var i,n=r("mrSG"),a=r("tk/3"),o=r("fXoL"),s=r("F/XL"),c=r("67Y/"),u=r("xMyE"),l=r("cftt"),d=r("OTfX"),h=r("dje0"),f=r("U+s4"),p=r("5Zoz"),m=((i={})[d.b.CODE]="/catalog/dt-promocode",i[d.b.DISCOUNT]="/catalog/dt-discount",i[d.b.STOCK]="/catalog/dt-stock",i),g=function(){function e(e,t,r,i){this.httpClient=e,this.cacheService=t,this.localeService=r,this.featureService=i,this.offersUrl="/api/v1/offers",this.queryLimitKey="limit",this.queryLimitValue=50,this.cachePrefix="club",this.cachePopupOffersKey="popup.offers",this.cachePopupOffersTime=18e5}return e.serializeOffers=function(e){var t=[];return e.forEach((function(e){d.b[e.offerType]&&t.push(new d.a(e))})),t},Object.defineProperty(e.prototype,"baseUrl",{get:function(){return l.a._club},enumerable:!1,configurable:!0}),e.prototype.isAvailable=function(){return Object(n.b)(this,void 0,void 0,(function(){return Object(n.c)(this,(function(e){return[2,this.featureService.isFeatureEnable(h.a.BEST_DEALS)]}))}))},Object.defineProperty(e.prototype,"country",{get:function(){return this.localeService.country},enumerable:!1,configurable:!0}),e.prototype.getOffers=function(){return Object(n.b)(this,void 0,void 0,(function(){var t,r,i=this;return Object(n.c)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.cacheService.get(this.cachePrefix,this.cachePopupOffersKey)];case 1:return(t=o.sent())&&t.length?[2,t]:(r=(new a.c).set(this.queryLimitKey,this.queryLimitValue.toString()).set("strategy","lite").set("country",this.country),[2,this.httpClient.get(""+this.baseUrl+this.offersUrl,{params:r}).pipe(Object(c.a)((function(t){var r=t.data;return Object(s.a)(e.serializeOffers(r))})),Object(u.a)((function(e){return Object(n.b)(i,void 0,void 0,(function(){var t;return Object(n.c)(this,(function(r){switch(r.label){case 0:return[4,e.toPromise()];case 1:return(t=r.sent())&&this.cacheService.set(this.cachePrefix,this.cachePopupOffersKey,this.cachePopupOffersTime,t),[2]}}))}))})),Object(c.a)((function(e){return e.toPromise()}))).toPromise()]);case 2:return o.sent(),console.error("Club offers fetching is failed!"),[3,3];case 3:return[2]}}))}))},e.prototype.clearCacheOffers=function(){this.cacheService.remove(this.cachePrefix,this.cachePopupOffersKey)},e.\u0275fac=function(t){return new(t||e)(o.Nc(a.a),o.Nc(f.a),o.Nc(p.a),o.Nc(h.a))},e.\u0275prov=o.Ac({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},br3F:function(e,t,r){r.d(t,"a",(function(){return l}));var i=r("mrSG"),n=r("fXoL"),a=r("cftt"),o=r("dkLR"),s=r("y7o/"),c=r("xOb2"),u=r("tk/3"),l=function(){function e(e){this.httpClient=e,this.versionExt="version-ext",this.locale="locale",this.domain="domain",this.baseUrl=a.a._api,this.pathLogShoppingTrip="/log-shopping-trip",this.pathSettingsSimpleSimilar="/settings/simple-similar",this.pathSimpleSimilarOffers="/simple-similar/offers",this.pathUserPartnerData="/user/partner-system",this.promoNotifications="/promo-notifications",this.advices="/user/advices"}return e.prototype.getHeaders=function(){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.c)(this,(function(t){switch(t.label){case 0:return[4,c.a.syncGet("locale")];case 1:return e=t.sent(),[2,{"Content-Type":"application/json","extension-version":this.getExtensionVersion(),locale:e}]}}))}))},e.prototype.getExtensionVersion=function(){return chrome.runtime.getManifest().version},e.prototype.sendLogShoppingTripEvent=function(e){return Object(i.b)(this,void 0,void 0,(function(){var t;return Object(i.c)(this,(function(r){switch(r.label){case 0:return[4,this.getHeaders()];case 1:return t=r.sent(),this.httpClient.post(""+this.baseUrl+this.pathLogShoppingTrip,JSON.stringify(e),{headers:t}).toPromise().then((function(e){return e})).catch((function(e){return console.error(e)})),[2]}}))}))},e.prototype.getSimpleSimilarSettings=function(e){return Object(i.b)(this,void 0,void 0,(function(){var t,r,n;return Object(i.c)(this,(function(i){switch(i.label){case 0:return[4,c.a.syncGet("locale")];case 1:return t=i.sent(),[4,this.getHeaders()];case 2:return r=i.sent(),n=""+this.baseUrl+this.pathSettingsSimpleSimilar+"?"+this.versionExt+"="+this.getExtensionVersion()+(t?"&"+this.locale+"="+t:"")+(e?"&"+this.domain+"="+e:""),[2,this.httpClient.get(n,{headers:r}).toPromise().then((function(e){return e}))]}}))}))},e.prototype.getSimpleSimilarOffers=function(){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.c)(this,(function(t){switch(t.label){case 0:return c.a.set("simpleSimilarOffers",{lastUpdate:null}),[4,this.getHeaders()];case 1:return e=t.sent(),[2,this.httpClient.get(""+this.baseUrl+this.pathSimpleSimilarOffers,{headers:e}).toPromise().then((function(e){var t=e||{};return t.lastUpdate=Date.now(),c.a.set("simpleSimilarOffers",t),t})).catch((function(e){return console.error(e),{}}))]}}))}))},e.prototype.getPartnerSystemData=function(){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.c)(this,(function(t){switch(t.label){case 0:return[4,this.getHeaders()];case 1:return e=t.sent(),[2,this.httpClient.get(""+this.baseUrl+this.pathUserPartnerData,{headers:e}).toPromise().then((function(e){return!(!e||!e.title&&!e.description)&&(c.a.set("userPartnerData",s.a.objectKeysTransform(e)),s.a.objectKeysTransform(e))}))]}}))}))},e.prototype.getPromoNotifications=function(){return Object(i.b)(this,void 0,void 0,(function(){var e,t,r;return Object(i.c)(this,(function(n){switch(n.label){case 0:return[4,this.getHeaders()];case 1:return e=n.sent(),[4,c.a.syncGet("locale")];case 2:return t=n.sent(),r=""+this.baseUrl+this.promoNotifications+"?locale="+(t||o.a.DEFAULT_LANGUAGE+"_"+o.a.DEFAULT_COUNTRY),this.httpClient.get(r,{headers:e}).toPromise().then((function(e){var t,r;c.a.set("promoNotifications",e);var n=[];try{for(var a=Object(i.f)(Object.keys(e)),s=a.next();!s.done;s=a.next()){var u=s.value;n.push({id:e[u].id,type:"promo"})}}catch(l){t={error:l}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}c.a.syncGet("fetchPromoNotification").then((function(e){if(null==e)framework.extension.fireEvent(o.a.SEND_USER_NOTIFICATION_LOGS,{data:{arrayNotifications:n,notificationEvent:"fetchPromoNotification"}});else{var t=n.filter((function(t,r){return t.id!==(e[r]?e[r].id:null)}));Array.isArray(t)&&t.length>0&&framework.extension.fireEvent(o.a.SEND_USER_NOTIFICATION_LOGS,{data:{arrayNotifications:t,notificationEvent:"fetchPromoNotification"}})}c.a.set("fetchPromoNotification",n)}))})),[2]}}))}))},e.prototype.getAdvices=function(e){return Object(i.b)(this,void 0,void 0,(function(){var t,r,n,a,o,s;return Object(i.c)(this,(function(c){t=new FormData;try{for(r=Object(i.f)(Object.keys(e)),n=r.next();!n.done;n=r.next())a=n.value,t.append(a,e[a])}catch(u){o={error:u}}finally{try{n&&!n.done&&(s=r.return)&&s.call(r)}finally{if(o)throw o.error}}return[2,this.httpClient.post(""+this.baseUrl+this.advices,t).toPromise().then((function(e){return e}))]}))}))},e.\u0275fac=function(t){return new(t||e)(n.Nc(u.a))},e.\u0275prov=n.Ac({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},cftt:function(e,t,r){r.d(t,"a",(function(){return u}));var i,n=r("mrSG"),a=r("LWby"),o=r("dkLR"),s=r("xOb2"),c=r("y7o/"),u=((i={domain:"letyshops.com"})._root="https://"+i.domain,i._api="https://eapi.letyshops.com/eapi",i._club="https://club.letyshops.com",i._help="https://help.letyshops.com",i._tools="https://tools.letyshops.com",i.cookieKey="uid",i.configService=new a.a,i.updateUrlsApi=function(){return Object(n.b)(void 0,void 0,void 0,(function(){var e;return Object(n.c)(this,(function(t){switch(t.label){case 0:return"undefined"==typeof framework?[3,3]:Object.keys(framework).length>2?[4,i.configService.getParameter(a.a.UPDATE_INTERVAL_URLS)]:[3,2];case 1:return e=t.sent(),$.ajax({url:i._api+"/urls",type:"GET",dataType:"json",success:function(e){e&&(e&&e.siteUrl&&(i.domain=new URL(e.siteUrl).hostname,i._root=e.siteUrl,i._link=e.siteUrl),e&&e.apiUrl&&(i._api=e.apiUrl+"/eapi"),e&&e.apiUrl&&e.cdnUrl&&(i._cdn=e.cdnUrl+"/eapi"),e&&e.clubUrl&&(i._club=e.clubUrl),e&&e.helpUrl&&(i._help=e.helpUrl),e&&e.toolsUrl&&(i._tools=e.toolsUrl),s.a.set("dataUrls",e))},error:function(e,t,r){console.error(t+":"+r)}}),clearInterval(i.intervalupdateUrlsApiHandlerTimer),i.intervalupdateUrlsApiHandlerTimer=setInterval((function(){i.updateUrlsApi()}),e),[3,3];case 2:s.a.get("dataUrls",(function(e){e?(e&&e.siteUrl&&(i.domain=new URL(e.siteUrl).hostname,i._root=e.siteUrl,i._link=e.siteUrl),e&&e.apiUrl&&(i._api=e.apiUrl+"/eapi"),e&&e.apiUrl&&e.siteUrl&&e.cdnUrl&&(i._cdn=e.cdnUrl+"/eapi"),e&&e.clubUrl&&(i._club=e.clubUrl),e&&e.helpUrl&&(i._help=e.helpUrl),e&&e.toolsUrl&&(i._tools=e.toolsUrl)):i.updateUrlsApi()})),t.label=3;case 3:return[2]}}))}))},i.getSettings=function(){return Object(n.b)(void 0,void 0,void 0,(function(){var e;return Object(n.c)(this,(function(t){switch(t.label){case 0:return"undefined"!=typeof framework&&Object.keys(framework).length>2?[4,i.configService.getParameter(a.a.UPDATE_INTERVAL_SETTINGS)]:[3,2];case 1:e=t.sent(),$.ajax({url:(i._cdn?i._cdn:i._api)+"/settings?version-ext="+chrome.runtime.getManifest().version,type:"GET",dataType:"json",success:function(e){if(e){if(s.a.set("settings",e),e.updateIntervals||e.updateEndTimeFeatures){var t={};e.updateIntervals&&_.each(Object.keys(e.updateIntervals),(function(r,i){switch(r){case"shops":t[a.a.UPDATE_INTERVAL_MERCHANT]=Object.values(e.updateIntervals)[i];break;case"lety-codes":t[a.a.UPDATE_INTERVAL_CODES]=Object.values(e.updateIntervals)[i];break;case"settings":t[a.a.UPDATE_INTERVAL_SETTINGS]=Object.values(e.updateIntervals)[i];break;case"urls":t[a.a.UPDATE_INTERVAL_URLS]=Object.values(e.updateIntervals)[i];break;case"promo-notifications":t[a.a.PROMO_NOTIFY_PERIOD]=Object.values(e.updateIntervals)[i];break;case"dd-list":t[a.a.R_LIST_ADD_PERIOD]=Object.values(e.updateIntervals)[i];break;case"user_notifications":t[a.a.USER_NOTIFY_INTERVAL]=Object.values(e.updateIntervals)[i];break;case"user_cashback_rates":t[a.a.INTERVAL_COUNT_USER_CASHBACK_RATES]=Object.values(e.updateIntervals)[i];break;case"segment_settings":t[a.a.INTERVAL_COUNT_SETTINGS_BY_SEGMENT]=Object.values(e.updateIntervals)[i];break;case"user_update_force":t[a.a.UPDATE_INTERVAL_USER_FORCE]=Object.values(e.updateIntervals)[i];break;case"simple_similar_settings":t[a.a.INTERVAL_COUNT_SETTINGS_SIMPLE_SIMILAR]=Object.values(e.updateIntervals)[i];break;case"user_autopromo_update":t[a.a.UPDATE_INTERVAL_AUTOPROMO]=Object.values(e.updateIntervals)[i];break;case"interval_shopping_trip_id":t[a.a.INTERVAL_SHOPPING_TRIP_ID]=Object.values(e.updateIntervals)[i];break;case"update_interval_info_similar":t[a.a.UPDATE_INTERVAL_INFO_SIMILAR]=Object.values(e.updateIntervals)[i]}})),e.updateEndTimeFeatures&&_.each(Object.keys(e.updateEndTimeFeatures),(function(r,i){switch(r){case"greenLightBookingEndTime":t[a.a.GREEN_LIGHT_BOOKING_END_TIME]=Object.values(e.updateEndTimeFeatures)[i]}})),i.configService.updateConfig(t)}e.autoUpdate.shops&&framework.extension.fireEvent(o.a.UPDATE_MERCHANTS_RATES,{})}},error:function(e,t,r){console.error(t+":"+r)}}),clearInterval(i.intervalupdateSettingsApiHandlerTimer),i.intervalupdateSettingsApiHandlerTimer=setInterval((function(){i.getSettings()}),e),t.label=2;case 2:return[2]}}))}))},i.updateUrlsApi(),i.getSettings(),i.getRoot=function(){return i._root+"/"},i.getLink=function(){return i._link?i._link+"/":i.getRoot()},i.afterInstall=function(){var e=c.a.getFullInfo().browser===o.a.BROWSER_NAME_YABROWSER?"yabrowser":framework.browser.name.toLowerCase();return i._root+"/extension?action=install&utm_source=extension&utm_campaign=install&utm_term="+e},i.afterDelete=function(){var e=c.a.getFullInfo().browser===o.a.BROWSER_NAME_YABROWSER?"yabrowser":framework.browser.name.toLowerCase();return i._root+"/extension?action=uninstall&utm_source=extension&utm_campaign=uninstall&utm_term="+e},i.user=function(){return i._api+"/user"},i.cashRates=function(){return i._api+"/cashback-rates"},i.userCashbackRates=function(e){return i._api+"/cashback-rates/"+e},i.userCodes=function(){return i._api+"/user/lety-codes"},i.favoriteMerchants=function(){return i._api+"/user/shops-liked"},i.deleteFavoriteMerchant=function(){return i._api+"/user/shops-disliked"},i.merchants=function(){return(i._cdn?i._cdn:i._api)+"/shops"},i.recommendMerchants=function(){return i._api+"/user/shops-recomended"},i.getUserNotifications=function(){return i._api+"/user/notifications"},i.advices=function(){return i._api+"/user/advices"},i.userNotificationLogs=function(){return i._api+"/user/notifications/logs"},i.interstitialPage=function(){return i._root+"/"},i.interstitialPageLogIn=function(){var e=framework.browser.name.toLowerCase();return i._root+"?auth=1&utm_source=extension&utm_campaign=popup_login&utm_term="+e},i.accountPage=function(){var e=framework.browser.name.toLowerCase();return i._root+"/user?utm_source=extension&utm_campaign=popup_user&utm_term="+e},i.allStoresPage=function(){var e=framework.browser.name.toLowerCase();return i._root+"/shops?utm_source=extension&utm_campaign=shops&utm_term="+e},i.helpPage=function(e){var t=framework.browser.name.toLowerCase();return i._help+"/hc/"+e+"/sections/360000147845?utm_source=extension&utm_campaign=support&utm_content=zendesk&utm_term="+t},i.confidentialPage=function(){var e=framework.browser.name.toLowerCase();return i._root+"/confidential?utm_campaign=confidential&utm_content=zendesk&utm_source=extension&utm_term="+e},i.reasonCashbackReactivate=function(){var e=framework.browser.name.toLowerCase();return i._root+"/re-activate-cashback-message?utm_source=extension&utm_campaign=notification_re_activate_cashback&utm_term="+e},i.logInstall=function(){return i._api+"/extension/install"},i.logRequest=function(){return i._api+"/extension/request"},i.logUserSettings=function(){return i._api+"/user/extension-settings"},i.ddList=function(){return(i._cdn?i._cdn:i._api)+"/dd-list"},i.partner=function(){return i._root+"/cashbacklink"},i)},dje0:function(e,t,r){r.d(t,"a",(function(){return s}));var i=r("mrSG"),n=r("fXoL"),a=r("y7o/"),o=r("xOb2"),s=function(){function e(){this.domain=a.a.getDomain(window.location.href)}return e.prototype.isFeatureEnable=function(e){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.c)(this,(function(t){switch(t.label){case 0:return[4,this.isFeatureEnableOnEapi(e)];case 1:return t.sent()?[4,this.isFeatureEnableOnUserSettings(e)]:[2,!1];case 2:return t.sent()?[4,this.checkByAvailableCountry(e)]:[2,!1];case 3:return t.sent()?[4,this.checkDomainInFeatureDisabledHosts(e)]:[2,!1];case 4:return t.sent()?[2,!1]:[2,!0]}}))}))},e.prototype.isFeatureEnableOnEapi=function(e){return Object(i.b)(this,void 0,void 0,(function(){var t;return Object(i.c)(this,(function(r){switch(r.label){case 0:return[4,this.getSettings()];case 1:return[2,!!(t=r.sent())&&t.features&&t.features.hasOwnProperty(e)&&t.features[e].enabled]}}))}))},e.prototype.isFeatureEnableOnUserSettings=function(t){return Object(i.b)(this,void 0,void 0,(function(){var r;return Object(i.c)(this,(function(i){switch(i.label){case 0:switch(t){case e.IMAGE_SEARCH:return[3,1];case e.SIMILAR:return[3,3];case e.SIMPLE_SIMILAR:return[3,5]}return[3,7];case 1:return[4,o.a.syncGet(e.IMAGE_SEARCH_USER_SETTINGS)];case 2:return r=i.sent(),[3,8];case 3:return[4,o.a.syncGet(e.SIMILAR_USER_SETTINGS)];case 4:return r=i.sent(),[3,8];case 5:return[4,o.a.syncGet(e.SIMPLE_SIMILAR_USER_SETTINGS)];case 6:return r=i.sent(),[3,8];case 7:r=!0,i.label=8;case 8:return[2,"boolean"!=typeof r||r]}}))}))},e.prototype.checkDomainInFeatureDisabledHosts=function(e){return Object(i.b)(this,void 0,void 0,(function(){var t,r,n=this;return Object(i.c)(this,(function(i){switch(i.label){case 0:return[4,this.getSettings()];case 1:return t=i.sent(),[2,(r=!!t&&t.features.hasOwnProperty(e)&&t.features[e].alwaysDisabledHosts)&&r.some((function(e){return e===n.domain}))]}}))}))},e.prototype.checkByAvailableCountry=function(e){return Object(i.b)(this,void 0,void 0,(function(){var t,r;return Object(i.c)(this,(function(i){switch(i.label){case 0:return[4,this.getSettings()];case 1:return t=i.sent(),r=!!t&&t.features.hasOwnProperty(e)&&t.features[e].countries,[4,a.a.matchLocaleCookie(r)];case 2:return[2,i.sent()]}}))}))},e.prototype.getSettings=function(){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.c)(this,(function(t){switch(t.label){case 0:return this.eapiSettings?[2,this.eapiSettings]:[3,1];case 1:return e=this,[4,o.a.syncGet("settings")];case 2:return e.eapiSettings=t.sent(),[2,this.eapiSettings]}}))}))},e.SIMPLE_SIMILAR_USER_SETTINGS="showSimpleSimilarInjection",e.IMAGE_SEARCH_USER_SETTINGS="showImageSearch",e.SIMILAR_USER_SETTINGS="showSimilarListInjection",e.SIMPLE_SIMILAR="SIMPLE_SIMILAR",e.IMAGE_SEARCH="IMAGE_SEARCH",e.SIMILAR="SIMILAR",e.BEST_DEALS="BEST_DEALS",e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=n.Ac({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},dkLR:function(e,t,r){r.d(t,"a",(function(){return i}));var i=function(){function e(){}return e.DEBUG=!1,e.LEVEL_ERROR=0,e.LEVEL_WARNING=1,e.LEVEL_INFO=2,e.LEVEL_ERROR_COLOR="#f44336",e.LEVEL_WARNING_COLOR="#ffcc00",e.LEVEL_INFO_COLOR="#00c853",e.LEVEL_ERROR_STATUS="bad",e.LEVEL_WARNING_STATUS="stranger",e.LEVEL_INFO_STATUS="good",e.TYPE_NO_CHANGE=0,e.TYPE_MINOR_DOWN=1,e.TYPE_DOWN=2,e.TYPE_MINOR_DOWN_AFTER_UP=3,e.TYPE_MINOR_UP_AFTER_DOWN=4,e.TYPE_UP=5,e.TYPE_MINOR_UP=6,e.BROWSER_NAME_IE="Internet Explorer",e.BROWSER_NAME_FF="Firefox",e.BROWSER_NAME_CHROME="Chrome",e.BROWSER_NAME_OPERA="Opera",e.BROWSER_NAME_SAFARI="Safari",e.BROWSER_NAME_YABROWSER="YaBrowser",e.PARAMETER_DEEP_LINK="?ext_referrer=",e.APP_TOKEN="Owmeaiaiwlsn3444_aasi344Mgoak",e.REGEX_ACT_MIN_PRICE=/window\.runParams\.actMinPrice="(.+)";/gim,e.REGEX_ACT_MAX_PRICE=/window\.runParams\.actMaxPrice="(.+)";/gim,e.REGEX_MIN_PRICE=/window\.runParams\.minPrice="(.+)";/gim,e.REGEX_MAX_PRICE=/window\.runParams\.maxPrice="(.+)";/gim,e.REGEX_BASE_CURRENCY_CODE=/window\.runParams\.baseCurrencyCode="(.+)";/gim,e.REGEX_REGION_COUNTRY_NAME=/window\.runParams\.regionCountryName="(.+)";/gim,e.REGEX_REGION_PROVINCE_NAME=/window\.runParams\.regionProvinceName="(.+)";/gim,e.REGEX_REGION_CITY_NAME=/window\.runParams\.regionCityName="(.+)";/gim,e.REGEX_ALI_PRODUCT_ID=/^\/(?:item(?:\/.*)?\/|s\/item(?:\/.*)?\/|store\/product(?:\/.*)?\/\d+_|\d+\-)([\d]+)(?:\-detail)?\.html/,e.REGEX_GEARBEST_PRODUCT_ID=/^(?:\/.*)?\/pp_([\d]+)\.html/,e.REGEX_BANG_GOOD_PRODUCT_ID=/^(?:\/.*)?\/(?:.*)?\-p\-([\d]+)\.html/,e.REGEX_BANG_GOOD_US_PRODUCT_ID=/^(?:\/.*)?\/(?:.*)?\-wp\-Usa\-([\d]+)\.html/,e.REGEX_BANG_GOOD_EU_PRODUCT_ID=/^(?:\/.*)?\/(?:.*)?\-wp\-Eu\-([\d]+)\.html/,e.REGEX_LIGHT_IN_THE_BOX_PRODUCT_ID=/^(?:\/.*)?\/(?:.*)?_p([\d]+)\.html/,e.REGEX_TOM_TOP_PRODUCT_ID=/^(?:\/.*)?\/p\-(.+)\.html/,e.CHECK_LETYSHOPS=/letyshops\.[\w]+/gim,e.CHECK_LETYSHOPS_VIEW=/letyshops\.[\w]+\/[\w-_\/]*[view|short\-link]\/(\d+)/gim,e.CHECK_LETYSHOPS_GO=/letyshops\.[\w]+\/[\w-_\/]*[view|short\-link]\/(\d+)\/go/gim,e.CHECK_LETYSHOPS_VIEW_OR_GO=/letyshops\.[\D]+\/*[view|short\-link|shops]\/(\d+)/gim,e.REG_URL=/(https?:\/\/[^\s]+)/g,e.ARRAY_MERCHANTS_PRICE=[13366481,17292915,17289199,15131011,15131239,13433222,13083906,15223074],e.ARRAY_MERCHANTS_PRICE_SELLER=[13366481,17292915,17289199],e.COMMUNICATION_EVENT_NAME_PREFIX="LETYSHOPS_",e.LOGIN_TOKEN=e.COMMUNICATION_EVENT_NAME_PREFIX+"LOGIN_TOKEN",e.POPUP_FIRST_OPENING_TOKEN=e.COMMUNICATION_EVENT_NAME_PREFIX+"POPUP_FIRST_OPENING_TOKEN",e.CASHBACK_ACTIVATE=e.COMMUNICATION_EVENT_NAME_PREFIX+"CASHBACK_ACTIVATE",e.PROMO_ACTIVATE=e.COMMUNICATION_EVENT_NAME_PREFIX+"PROMO_ACTIVATE",e.NOTIFICATION_CASHBACK_ACTIVATE=e.COMMUNICATION_EVENT_NAME_PREFIX+"NOTIFICATION_CASHBACK_ACTIVATE",e.NOTIFICATION_DISMISS=e.COMMUNICATION_EVENT_NAME_PREFIX+"NOTIFICATION_DISMISS",e.USER_NOTIFICATION_DISMISS=e.COMMUNICATION_EVENT_NAME_PREFIX+"USER_NOTIFICATION_DISMISS",e.NOTIFICATION_GET_INFO=e.COMMUNICATION_EVENT_NAME_PREFIX+"NOTIFICATION_GET_INFO",e.NOTIFICATION_RENDER_LETYSHOPS_BAR=e.COMMUNICATION_EVENT_NAME_PREFIX+"NOTIFICATION_RENDER_LETYSHOPS_BAR",e.NOTIFICATION_RENDER_LETYSHOPS_BAR_ALI=e.COMMUNICATION_EVENT_NAME_PREFIX+"NOTIFICATION_RENDER_LETYSHOPS_BAR_ALI",e.CLOSE_ALL_NOTIFICATION=e.COMMUNICATION_EVENT_NAME_PREFIX+"CLOSE_ALL_NOTIFICATION",e.UPDATE_MERCHANTS_HOT_PRODUCTS=e.COMMUNICATION_EVENT_NAME_PREFIX+"UPDATE_MERCHANTS_HOT_PRODUCTS",e.GET_EXTENSION_INFO=e.COMMUNICATION_EVENT_NAME_PREFIX+"GET_EXTENSION_INFO",e.SEND_EXTENSION_INFO=e.COMMUNICATION_EVENT_NAME_PREFIX+"SEND_EXTENSION_INFO",e.SEND_PAGE_INFO=e.COMMUNICATION_EVENT_NAME_PREFIX+"SEND_PAGE_INFO",e.OFFLINE_LIKES=e.COMMUNICATION_EVENT_NAME_PREFIX+"OFFLINE_LIKES",e.SAW_REWRITE=e.COMMUNICATION_EVENT_NAME_PREFIX+"SAW_REWRITE",e.BUTTON_UPDATE=e.COMMUNICATION_EVENT_NAME_PREFIX+"BUTTON_RED",e.SET_NOTIFICATIONS_POPUP=e.COMMUNICATION_EVENT_NAME_PREFIX+"SET_NOTIFICATIONS_POPUP",e.TAB_WAS_CHANGED=e.COMMUNICATION_EVENT_NAME_PREFIX+"TAB_WAS_CHANGED",e.SEND_USER_SETTINGS=e.COMMUNICATION_EVENT_NAME_PREFIX+"SEND_USER_SETTINGS",e.SEND_USER_NOTIFICATION_LOGS=e.COMMUNICATION_EVENT_NAME_PREFIX+"SEND_USER_NOTIFICATION_LOGS",e.CHECK_PAGE=e.COMMUNICATION_EVENT_NAME_PREFIX+"CHECK_PAGE",e.GET_NATIVE_USER_AGENT=e.COMMUNICATION_EVENT_NAME_PREFIX+"GET_NATIVE_USER_AGENT",e.MERCHANT_SUPPRESSED=e.COMMUNICATION_EVENT_NAME_PREFIX+"MERCHANT_SUPPRESSED",e.POPUP_MERCHANTS_UPDATE=e.COMMUNICATION_EVENT_NAME_PREFIX+"POPUP_MERCHANTS_UPDATE",e.POPUP_TO_NOTIFICATION_TAB=e.COMMUNICATION_EVENT_NAME_PREFIX+"POPUP_TO_NOTIFICATION_TAB",e.POPUP_TO_INVITATION_TAB=e.COMMUNICATION_EVENT_NAME_PREFIX+"POPUP_TO_INVITATION_TAB",e.POPUP_TO_MERCHANT_CARD=e.COMMUNICATION_EVENT_NAME_PREFIX+"POPUP_TO_MERCHANT_CARD",e.POPUP_INITIALIZE_FOOTER_FOR_STORES=e.COMMUNICATION_EVENT_NAME_PREFIX+"POPUP_INITIALIZE_FOOTER_FOR_STORES",e.POPUP_UPDATE_FOOTER=e.COMMUNICATION_EVENT_NAME_PREFIX+"POPUP_UPDATE_FOOTER",e.POPUP_TO_UPDATE_FAVORITE_STATUS=e.COMMUNICATION_EVENT_NAME_PREFIX+"POPUP_TO_UPDATE_FAVORITE_STATUS",e.POPUP_PUSH_REVIEWED_NOTIFY=e.COMMUNICATION_EVENT_NAME_PREFIX+"POPUP_PUSH_REVIEWED_NOTIFY",e.USER_APPLIED_LETY_CODES=e.COMMUNICATION_EVENT_NAME_PREFIX+"USER_APPLIED_LETY_CODES",e.UPDATE_MERCHANTS_RATES=e.COMMUNICATION_EVENT_NAME_PREFIX+"UPDATE_MERCHANTS_RATES",e.GET_INFO_USER=e.COMMUNICATION_EVENT_NAME_PREFIX+"GET_INFO_USER",e.CREATE_ADVICES=e.COMMUNICATION_EVENT_NAME_PREFIX+"CREATE_ADVICES",e.RETURN_ADVICE_LINK=e.COMMUNICATION_EVENT_NAME_PREFIX+"RETURN_ADVICE_LINK",e.REFRESH_ALL=e.COMMUNICATION_EVENT_NAME_PREFIX+"REFRESH_ALL",e.SHOW_SIMILAR_PRODUCTS=e.COMMUNICATION_EVENT_NAME_PREFIX+"SHOW_SIMILAR_PRODUCTS",e.GET_MERCHANT_BY_ID=e.COMMUNICATION_EVENT_NAME_PREFIX+"GET_MERCHANT_BY_ID",e.GET_MERCHANT_BY_DOMAIN=e.COMMUNICATION_EVENT_NAME_PREFIX+"GET_MERCHANT_BY_DOMAIN",e.INVOKE_IMAGE_SEARCH_CONTEXT_MENU=e.COMMUNICATION_EVENT_NAME_PREFIX+"INVOKE_IMAGE_SEARCH_CONTEXT_MENU",e.GET_IMAGE_INITIAL_BASE_64=e.COMMUNICATION_EVENT_NAME_PREFIX+"GET_IMAGE_INITIAL_BASE_64",e.USER_APPLIED_AUTOPROMO=e.COMMUNICATION_EVENT_NAME_PREFIX+"USER_APPLIED_AUTOPROMO",e.GET_SIMPLE_SIMILAR_DOMAIN_DATA=e.COMMUNICATION_EVENT_NAME_PREFIX+"GET_SIMPLE_SIMILAR_DOMAIN_DATA",e.TAB_CHANGED=e.COMMUNICATION_EVENT_NAME_PREFIX+"TAB_CHANGED",e.HISIORY_LENGTH=10,e.GLOBAL_HISTORY_LENGTH=100,e.POPUP_WIDTH=470,e.POPUP_HEIGHT=560,e.TAB_STATE_3RD_PARTY=2,e.TAB_STATE_INTERSTITIAL_REDIRECT=3,e.FOOTER_ALL_STORES=1,e.FOOTER_ALL_OFFERS=2,e.FOOTER_LABEL=0,e.FOOTER_ADVICE=!0,e.THIRD_PARTY_LINKS=["event.2parale.ro","www.awin1.com","partners.webmasterplan.com","web.epartner.es","clic.reussissonsensemble.fr","being.successfultogether.co.uk","anrdoezrs.net","t.dgm-au.com","google.com/aclk?sa","pepperjamnetwork.com","aos.prf.hn","ad.zanox.com","rover.ebay.com","track.commissionfactory.com.au","clk.tradedoubler.com","tkqlhce.com","partnerprogramma.bol.com","tc.tradetracker.net","tr.rdrtr.com","lead-analytics.nl","partners.adtriplex.com","action.metaffiliation.com","smart4ads.com","gr.linkwi.se","tracking.publicidees.com","fls.doubleclick.net","gan.doubleclick.net","click.linksynergy.com","v2.afilio.com.br","jdoqocy.com","send.onenetworkdirect.net",".7eer.net",".evyy.net",".ojrq.net","affiliate.buy.com","affiliate.rakuten.com","affiliates.abebooks.com","affiliates.babiesrus.com","affiliates.toysrus.com","afsrc=1","aos.prf.hn","commission-junction.com","dpbolvw.net","dpbolvw.net","google.com/aclk","gopjn.com","goto.orientaltrading.com","goto.target.com","goto.target.com/c/","kqzyfj.com","partners.hotwire.com","pepperjamnetwork.com","pjatr.com","pjtra.com","pntra.com","pntrs.com","prf.hn","qksrv.net","shareasale.com","t.dgm-au.com","www.linkconnector.com","apytrc.com","ams.apypx.com"],e.gaPrefix="/_extension/",e.gaPageShops=e.gaPrefix+"shops/",e.gaPagePopup=e.gaPrefix+"popup/",e.gaPageSales=e.gaPrefix+"sales/",e.gaPageFriends=e.gaPrefix+"friends/",e.gaPageHistory=e.gaPrefix+"history/",e.gaPageSettings=e.gaPrefix+"settings/",e.gaDisabledShop=e.gaPagePopup+"no-extension/",e.gaLetyClub=e.gaPagePopup+"letyclub/",e.gaPrefixMonitor="_monitor/",e.gaPrefixSimilar="_recommendation/",e.gaPageSimilarShow=e.gaPrefixSimilar+"show/",e.gaPrefixAdvices="_partner_link/",e.gaPageAdvices=e.gaPrefixAdvices+"show/",e.aliexpressID=13366481,e.aliexpressWWID=17292915,e.DEFAULT_LANGUAGE="en",e.DEFAULT_COUNTRY="EN",e.CHECK_LOCALE_COOKIE="hl",e.PERMISSIONS_SEGMENTS={similar:["web.ex_726_similar_test_5"],simpleSimilar:["web.SS-test-group-5-teaser"],extTestQ1:["web.test_ext_q1"],bestDeals:["web.best_deals"]},e.NOTIFICATION_RECIPIENT="extension",e.NO_ALI_AFFILIATE_COUNTRY=["RU","AM","AZ","BY","GE","KG","KZ","TJ","TM","UZ","MD"],e.BOOKING_ID=13810496,e.DEFAULT_USER_SETTINGS={showPrice:!0,showUserNotifications:!0,showPromoNotifications:!0,showCashbackHints:!0,showSimilarListInjection:!0,showSimpleSimilarInjection:!0,showImageSearch:!0,imageSearchDisabledHosts:[],allowTabUrlCollect:!0,allowAnalyticsCollect:!0},e.DEFAULT_FIREFOX_USER_SETTINGS={showPrice:!1,showUserNotifications:!0,showPromoNotifications:!0,showCashbackHints:!0,showSimilarListInjection:!1,showSimpleSimilarInjection:!0,showImageSearch:!1,imageSearchDisabledHosts:[],allowTabUrlCollect:!1,allowAnalyticsCollect:!1},e.IMAGE_SEARCH_SEGMENTS=["web.image_search_ru_test"],e.PROMO_NOTIFY_INTERVAL=12e4,e.UPDATE_INTERVAL_ACTIVATE=36e5,e.UPDATE_INTERVAL_USER=6e4,e.UPDATE_INTERVAL_USER_NOTIFICATION=36e5,e.UPDATE_LOG_REQUEST=864e5,e.INTERVAL_PUSH_LOG_REQUEST=3e5,e.INTERVAL_PUSH_LOG=6e4,e.UPDATE_INTERVAL_INFO_HISTORY_PRICE=6e5,e.INTERVAL_SHOW_NOTIFICATION_MARKET=36e5,e.PERIOD_DISABLED_FOR_HOUR=36e5,e.SIMPLE_SIMILAR_VIEWS_SETTINGS={frequency_view_page:10,frequency_view_time:3e5},e.PERIOD_DISABLED_BAR=36e5,e.SIMILAR_MINIMIZED_TYPE_VIEW_PERIOD=36e5,e.CLEAR_CACHE_INTERVAL=18e5,e.HIDE_NOTIFICATION_TIME=9e5,e.CURRENCY_LIST={PERCENT:"%",RUB:"\u0440\u0443\u0431.",RUR:"\u0440\u0443\u0431.",USD:"$",EUR:"\u20ac",UAH:"\u0433\u0440\u043d.",KZT:"\u0442\u0433.",BYR:"Br",BYN:"Br",PLN:"z\u0142",GBP:"\xa3",MXN:"MXN",ARS:"ARS",CLP:"CLP",COP:"COP",BRL:"R$",PEN:"S/",CAD:"C$",AUD:"A$",NZD:"NZ$",ZAR:"R",INR:"Rs",PHP:"\u20b1",AED:"Dhs"},e}()},u8hG:function(e,t,r){r.d(t,"a",(function(){return f}));var i=r("mrSG"),n=r("fXoL"),a=r("cftt"),o=r("dkLR"),s=r("y7o/"),c=r("EVkI"),u=r("xOb2"),l=r("jhN1"),d=r("Wz/G"),h=r("tk/3"),f=function(){function e(e,t,r,i){this.sanitizer=e,this.eventService=t,this.aliexpressProductsService=r,this.httpClient=i,this.baseUrl=a.a._tools,this.itemHistory="/api/extension/v1/item/history",this.itemInfo="/api/extension/v1/item/info",this.affiliateCheck="/api/extension/v1/affiliate/check",this.affiliateCheckList="/api/extension/v1/affiliate/check-list"}return e.prototype.init=function(e,t){return Object(i.b)(this,void 0,void 0,(function(){var r,n,a,o,c;return Object(i.c)(this,(function(u){switch(u.label){case 0:return this.application=t,(r=e.data)&&r.priceData?(n=this.application.merchants.selectByDomain(s.a.getDomain(r.href)),a=this.application.get("user"),[4,this.getPriceSellerData(e,n)]):[2,null];case 1:return(o=u.sent())?this.isMerchantHasSellerInfo(n)?[4,this.setUpHistoryItems(Object(i.a)(Object(i.a)({},o),{productReviewsText:r.productReviewsText,countSoldItemText:r.countSoldItemText}))]:[3,3]:[2,{empty:!0}];case 2:o=u.sent(),u.label=3;case 3:return c={rawData:o,pageData:r,hasSellerInfo:this.isMerchantHasSellerInfo(n),history:this.isMerchantHasSellerInfo(n)&&this.historyInfo(o),merchant:n.toJSON(),user:a.toJSON()},[4,this.getAffiliateStatus(r,n,a)];case 4:return[2,(c.affiliate=u.sent(),c)]}}))}))},e.prototype.getPriceSellerData=function(e,t){return Object(i.b)(this,void 0,void 0,(function(){var r,n,a;return Object(i.c)(this,(function(o){switch(o.label){case 0:return r={},this.isEventValid(e)?(n=r,[4,u.a.syncGet("locale")]):[2,null];case 1:return n.locale=o.sent(),r.language=r.locale.split("_")[0],[4,this.getPriceInfo(e,t)];case 2:return(a=o.sent())&&(r=Object(i.a)(Object(i.a)({},r),a)),this.isValid(r)?[2,JSON.parse(JSON.stringify(r))]:[2,null]}}))}))},e.prototype.getAffiliateStatus=function(e,t,r){return Object(i.b)(this,void 0,void 0,(function(){var n,a,u,l,d,h,f;return Object(i.c)(this,(function(i){switch(i.label){case 0:return n=new URL(e.href),a=s.a.isAliexpressProductPage(n.pathname),[4,s.a.matchLocaleCookie(o.a.NO_ALI_AFFILIATE_COUNTRY)];case 1:return u=i.sent(),l={status:null,isAffiliate:!1,show:!1},a&&u?(d=n.origin+n.pathname,[4,this.checkAffiliateAliItem(d,r)]):(l.isAffiliate=!0,l.show=!1,[2,l]);case 2:return h=i.sent(),(f=h&&h.result)?t?(h||(l.status="unknown",l.icon="alert"),h&&f&&t.isActivated&&(l.status="success",l.icon="check"),h&&f&&!t.isActivated&&(l.status="pending",l.icon="alert"),h&&!f&&(l.status="failur",l.icon="alert"),l.isAffiliate=f,l.show=!0,this.eventService.fireEvent(c.a.SEND_GOOGLE_ANALYTICS,{tabId:null,data:{type:"pageview",page:o.a.gaPrefixMonitor+"view/notification/"+l.status+"/"}}),[2,l]):(l.isAffiliate=!1,l.status="unknown",l.icon="alert",[2,l]):(l.isAffiliate=!1,l.status="unknown",l.icon="alert",[2,l])}}))}))},e.prototype.sellerResume=function(e){var t,r,i,n;return null===(n=null===(i=null===(r=null===(t=null==e?void 0:e.price)||void 0===t?void 0:t.targetInfo)||void 0===r?void 0:r.itemInfo)||void 0===i?void 0:i.seller)||void 0===n?void 0:n.resume},e.prototype.isValid=function(e){var t,r;if(!e||!e.targetInfo)return null;var i=e.targetInfo.itemInfo;return!!(null==i?void 0:i.url)||!!(null===(t=null==i?void 0:i.dynamic)||void 0===t?void 0:t.value)||!!(null===(r=null==i?void 0:i.seller)||void 0===r?void 0:r.score)},e.prototype.isEventValid=function(e){var t,r;return(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.href)&&(null===(r=null==e?void 0:e.data)||void 0===r?void 0:r.priceData)},e.prototype.isMerchantHasSellerInfo=function(e){return e&&o.a.ARRAY_MERCHANTS_PRICE_SELLER.includes(e.id)},e.prototype.isValidSellerInfo=function(e){},e.prototype.getPriceDynamicChartData=function(e){return Object(i.b)(this,void 0,void 0,(function(){var t,r,n,a,o,s,c,u,l,d,h,f,m,g;return Object(i.c)(this,(function(_){switch(_.label){case 0:return t=e.data,r=t.user,n=t.pageData,a=t.targetInfo,[4,this.getPriceChartData(n.priceData,r,a.itemInfo)];case 1:return(o=_.sent()).list?(s=(new Date).getTime(),c=new Date(s-2592e6).getTime(),u=this.getArrayFromPeriodDate(c,s,n.month),l=o.list[0].currency.sign,d=this.prepareChartData({list:o,month:n.month,previousDate:c,currentDate:s}),h=d.dataPriceDate,f=d.arrMinPrice,m=Math.min.apply(Math,Object(i.e)(f)),g=Math.max.apply(Math,Object(i.e)(f)),[2,{chart:this.prepareChart(h,u,g,l),minPrice:p.getPrice(m,l),maxPrice:p.getPrice(g,l),priceLast:p.getPrice(a.itemInfo.priceLast.min,l),description:a.itemInfo.dynamic.ItemDynamic.ItemDynamicSvg.text}]):[2,null]}}))}))},e.prototype.prepareChartData=function(e){var t=e.list,r=e.previousDate,i=e.currentDate,n=e.month,a=[],o=[];return t.list.sort((function(e,t){return e.timestamp-t.timestamp})).forEach((function(e){if(1e3*e.timestamp<r){var t=new Date(r);t.setDate(t.getDate()-3),a.length>0?(a[0].x=t.getDate()+" "+n[t.getMonth()]+" "+t.getFullYear(),a[0].y=e.min,a[0].time=1e3*e.timestamp,a[0].dateStr=t.getDate()+" "+n[t.getMonth()]):a.push({x:t.getDate()+" "+n[t.getMonth()]+" "+t.getFullYear(),y:e.min,time:1e3*e.timestamp,dateStr:t.getDate()+" "+n[t.getMonth()]})}if(1e3*e.timestamp>r&&1e3*e.timestamp<i){var s=new Date(1e3*e.timestamp);o.push(e.min),a.push({x:s.getDate()+" "+n[s.getMonth()]+" "+s.getFullYear(),y:e.min,time:1e3*e.timestamp,dateStr:s.getDate()+" "+n[s.getMonth()]})}})),{dataPriceDate:a,arrMinPrice:o}},e.prototype.getArrayFromPeriodDate=function(e,t,r){var i=[];for((e=new Date(e)).setDate(e.getDate()-3),(t=new Date(t)).setDate(t.getDate()+3),i.push(new Date(e).getDate()+" "+r[new Date(e).getMonth()]+" "+new Date(e).getFullYear());e<t;)(e=new Date(e)).setDate(e.getDate()+1),i.push(new Date(e).getDate()+" "+r[new Date(e).getMonth()]+" "+new Date(e).getFullYear());return i},e.prototype.prepareChart=function(e,t,r,i){return{signPrice:i,series:[{data:e}],labels:t,colors:[{backgroundColor:"transparent",borderColor:"#bce0fc",pointBackgroundColor:"#00A8FF",pointBorderColor:"#00A8FF"}],options:{tooltips:{mode:"nearest",intersect:!1,displayColors:!1,callbacks:{}},scales:{xAxes:[{display:!1,ticks:{gridLines:{offsetGridLines:!0}}}],yAxes:[{gridLines:{borderDash:[5,5],offsetGridLines:!1},ticks:{beginAtZero:!0,min:0,stepSize:Math.ceil(Math.ceil(r+.1*r)/4)}}]}}}},e.prototype.historyInfo=function(e){var t=e.targetInfo.itemInfo,r=e.historyItems;return t&&e&&r?e.historyItems.map((function(e){return{productDetailUrl:e.urlItem,productImage:e.imageItem,productTitle:e.name,minPrice:p.getPrice(e.priceLastMin,t.dynamic.currency.sign),orders:e.countSoldItem,reviews:e.countReviewsItem,sellerResumeStatusItem:{icon:"smile_"+e.sellerResumeStatusItem,value:e.sellerResumeScoreItem.value},priceDynamicItem:{icon:e.priceDynamicItem.ItemDynamic.ItemDynamicSvg.icon,svgIcon:e.priceDynamicItem.ItemDynamic.ItemDynamicSvg.svg,value:e.priceDynamicItem.sign+" "+p.getPrice(e.priceDynamicItem.value,e.priceDynamicItem.currency.sign)}}})):null},e.prototype.setUpHistoryItems=function(e){return Object(i.b)(this,void 0,void 0,(function(){var t,r,n;return Object(i.c)(this,(function(i){switch(i.label){case 0:return[4,this.getHistoryItems()];case 1:return t=i.sent(),r=t.slice(),n=this.setHistoryItems(t,e.id,e),u.a.set("historyItems",n),e.historyItems=this.setHistoryItemUrl(r,e.merchant),[2,e]}}))}))},e.prototype.clearHistoryItems=function(){return Object(i.b)(this,void 0,void 0,(function(){var e;return Object(i.c)(this,(function(t){switch(t.label){case 0:return[4,u.a.syncGet("historyItems")];case 1:return e=t.sent(),u.a.set("historyItems",[e.pop()]),[2,!0]}}))}))},e.prototype.setHistoryItemUrl=function(e,t){var r=t.id,i=t.isActivated;return e.map((function(e){return s.a.isAliexpressCis(r)||(e.urlItem=i?s.a.getGoUrlItem(r,e.urlItem):s.a.getViewUrlItem(r,e.urlItem)),e}))},e.prototype.setHistoryItems=function(e,t,r){if(e.find((function(e){return e.idItem===t})))return e;var i=this.createHistoryItem(t,r);return e.concat([i])},e.prototype.createHistoryItem=function(e,t){var r=new URL(t.targetInfo.itemInfo.url);return{idItem:e,nameItem:t.targetInfo.itemInfo.name,countReviewsItem:t.productReviewsText?parseInt(t.productReviewsText,10):"-",countSoldItem:t.countSoldItemText?parseInt(t.countSoldItemText,10):"-",urlItem:r.origin+r.pathname,imageItem:t.targetInfo.itemInfo.img,sellerResumeScoreItem:t.targetInfo.itemInfo.seller.resume.score,sellerResumeStatusItem:t.targetInfo.itemInfo.seller.resume.decodeNotes.notesScore.status,priceDynamicItem:t.targetInfo.itemInfo.dynamic,priceLastMin:t.targetInfo.itemInfo.priceLast.min}},e.prototype.getHistoryItems=function(){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.c)(this,(function(e){switch(e.label){case 0:return[4,u.a.syncGet("historyItems")];case 1:return[2,e.sent()||[]]}}))}))},e.prototype.getSimilarProducts=function(e){return Object(i.b)(this,void 0,void 0,(function(){var t,r,n,a,o,c,u;return Object(i.c)(this,(function(i){switch(i.label){case 0:return t=e.url,r=e.data,n=r.runParams,a=r.merchant,o=a.id,c=a.isActivated,e.data.urlsSimilarItems=this.getUrlsSimilarItems(n,t),[4,this.getPriceSimilarProducts(e)];case 1:return(u=i.sent())&&u.length?[2,u.map((function(e){return s.a.isAliexpressCis(o)||(e.productDetailUrl=c?s.a.getGoUrlItem(o,e.productDetailUrl):s.a.getViewUrlItem(o,e.productDetailUrl)),e}))]:[2,null]}}))}))},e.prototype.getUrlsSimilarItems=function(e,t){if(e){var r=e.data.recommendModule,i=r.productId,n=r.categoryId,a=r.storeNum,o=r.companyId,s=r.features.recommendGpsScenarioOtherSellerProducts,c=r.features.recommendGpsScenarioTopSelling;return{urlTopSell:this.aliexpressProductsService.getAliSimilarItems(i,n,a,o,c,5),urlOtherSeller:this.aliexpressProductsService.getAliSimilarItems(i,n,a,o,s)}}var u=t.match(new RegExp(/[\d*]{1,}/gim))[0];return u?{urlTopSell:this.aliexpressProductsService.getAliexpressSpecialForYou(u),urlOtherSeller:this.aliexpressProductsService.getAliexpressRecommendation(u),productId:u}:null},e.prototype.getPriceInfo=function(e,t){return Object(i.b)(this,void 0,void 0,(function(){var r,n,a,s,c,l,d,h,f,p;return Object(i.c)(this,(function(i){switch(i.label){case 0:return r=null,n=e.data,a=n.priceData,s=n.href,c=this.application.get("tabs").selectById(e.tabId),l=this.application.get("user"),t&&o.a.ARRAY_MERCHANTS_PRICE.includes(t.id)?(d=a.id+"_"+(a.region?a.region+"_":"")+a.currencyDisplay,[4,u.a.syncGet(d)]):[3,4];case 1:return!(h=i.sent())||(new Date).getTime()-h.createdAt>o.a.UPDATE_INTERVAL_INFO_HISTORY_PRICE?(f=e.url.includes("http")?e.url:s,[4,this.getTargetInfo(f,a,l)]):[3,3];case 2:(h=i.sent()).createdAt=(new Date).getTime(),h&&h.itemInfo&&h.itemInfo.dynamic&&(h.itemInfo.dynamic.value>0?h.itemInfo.dynamic.sign="+":h.itemInfo.dynamic.value<0?h.itemInfo.dynamic.sign="-":h.itemInfo.dynamic.sign="",h.itemInfo.dynamic.value=Math.abs(h.itemInfo.dynamic.value),h.itemInfo.dynamic.ItemDynamic=this.getDecodeItemDynamic(h),a&&Object.keys(a).length&&(h.itemInfo.priceLast.dataPricePage=a)),h&&h.itemInfo&&h.itemInfo.seller&&(h.itemInfo.seller.resume.score.value=parseInt(h.itemInfo.seller.resume.score.value,10),h.itemInfo.seller.resume.decodeNotes=this.getDecodeNotes(h)),u.a.set(d,h),i.label=3;case 3:p=t&&t.get("hasPromoActivated")?this.application.get("offers").get(+t.get("hasPromoActivated")):null,c&&(t.attributes.extendedTab=c.attributes,t.attributes.extendedPromo=p,r={merchant:t.attributes,isLogin:l.isLogin(),targetInfo:h||"",id:a.id,region:a.region}),i.label=4;case 4:return[2,r]}}))}))},e.prototype.getDecodeItemDynamic=function(e){var t={};switch(e.itemInfo.dynamic.type){case o.a.TYPE_NO_CHANGE:t.svg='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">\n<path fill="#1EB1FC" fill-rule="evenodd" d="M16.492 17.85a.747.747 0 0 1-1.057-1.058l4.004-4.004H2.747a.747.747 0 0 1 0-1.495h16.709l-4.018-4.017a.747.747 0 0 1 1.058-1.057l5.285 5.285a.747.747 0 0 1 0 1.058l-5.289 5.287z"/>\n</svg>',t.icon="dynamic_no_changes",t.text="notificationPriceTypeNoChangeText";break;case o.a.TYPE_MINOR_DOWN:t.svg='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">\n<path fill="#00C853" fill-rule="evenodd" d="M11.065 19.323a.747.747 0 0 1 0-1.495h5.662L4.924 6.025a.747.747 0 0 1 1.057-1.057l11.815 11.814v-5.681a.747.747 0 0 1 1.495 0v7.475a.747.747 0 0 1-.748.747h-7.478z"/>\n</svg>',t.icon="dynamic_low_down",t.text="notificationPriceTypeMinorDownText";break;case o.a.TYPE_DOWN:t.svg='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">\n<path fill="#00C853" fill-rule="evenodd" d="M6.185 16.527a.747.747 0 0 1 1.057-1.058l4.004 4.003V2.783a.747.747 0 0 1 1.495 0V19.49l4.018-4.018a.747.747 0 0 1 1.057 1.058l-5.285 5.285a.747.747 0 0 1-1.058 \t0l-5.287-5.288z"/>\n</svg>',t.icon="dynamic_down",t.text="notificationPriceTypeDownText";break;case o.a.TYPE_MINOR_DOWN_AFTER_UP:t.svg='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">\n<path fill="#00C853" fill-rule="evenodd" d="M11.711 8.829l7.016 6.999h-5.662a.747.747 0 1 0 0 1.495h7.478a.747.747 0 0 0 .748-.747V9.1a.747.747 0 0 0-1.495 0v5.681L12.355 7.36a.769.769 0 0 0-.069-.078c-.268-.268-.682-.29-.923-.048l-.08.08a.761.761 0 0 0-.032.032L3.045 15.55c-.241.242-.22.655.05.924.268.268.681.29.923.048L11.71 8.83z"/>\n</svg>',t.icon="dynamic_down_after_up",t.text="notificationPriceTypeMinorAfterUpText";break;case o.a.TYPE_MINOR_UP_AFTER_DOWN:t.svg='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">\n<path fill="#F44336" fill-rule="evenodd" d="M11.711 15.56l7.016-7h-5.662a.747.747 0 1 1 0-1.495h7.478c.413 0 .748.334.748.747v7.475a.747.747 0 0 1-1.495 0V9.606l-7.441 7.423a.769.769 0 0 1-.069.078c-.268.268-.682.29-.923.048l-.08-.08a.761.761 0 0 1-.032-.032L3.045 8.838c-.241-.242-.22-.655.05-.924.268-.268.681-.29.923-.048l7.693 7.693z"/>\n</svg>',t.icon="dynamic_up_after_down",t.text="notificationPriceTypeMinorAfterDownText";break;case o.a.TYPE_UP:t.svg='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">\n<path fill="#F44336" fill-rule="evenodd" d="M17.815 7.542a.747.747 0 0 1-1.057 1.057l-4.004-4.004v16.692a.747.747 0 0 1-1.495 0V4.578L7.242 8.596a.747.747 0 0 1-1.057-1.057l5.285-5.286a.747.747 0 0 1 1.058 0l5.287 5.289z"/>\n</svg>',t.icon="dynamic_up",t.text="notificationPriceTypeUpText";break;case o.a.TYPE_MINOR_UP:t.svg='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">\n<path fill="#F44336" fill-rule="evenodd" d="M19.289 12.97a.747.747 0 0 1-1.495 0V7.306L5.99 19.11a.747.747 0 0 1-1.057-1.057L16.748 6.238h-5.681a.747.747 0 0 1 0-1.495h7.475c.413 0 .747.335.747.748v7.478z"/>\n</svg>',t.icon="dynamic_low_up",t.text="notificationPriceTypeMinorUpText"}return{ItemDynamicSvg:t}},e.prototype.getDecodeNotes=function(e){var t,r,n=e.itemInfo.seller.resume;function a(e){var t={};switch(e){case o.a.LEVEL_ERROR:t.color=o.a.LEVEL_ERROR_COLOR,t.status=o.a.LEVEL_ERROR_STATUS;break;case o.a.LEVEL_WARNING:t.color=o.a.LEVEL_WARNING_COLOR,t.status=o.a.LEVEL_WARNING_STATUS;break;case o.a.LEVEL_INFO:t.color=o.a.LEVEL_INFO_COLOR,t.status=o.a.LEVEL_INFO_STATUS}return t}function s(e,t){switch(e){case 0:t.text="notificationPriceTypeScore1";break;case 1:t.text="notificationPriceTypeScore2";break;case 2:t.text="notificationPriceTypeScore3";break;case 3:t.text="notificationPriceTypeScore4"}}function c(e,t){switch(e){case 4:t.text="notificationPriceTypeFeedback1";break;case 5:t.text="notificationPriceTypeFeedback2";break;case 6:t.text="notificationPriceTypeFeedback3";break;case 7:t.text="notificationPriceTypeFeedback4"}}function u(e,t,r){switch(e){case 8:t.text="notificationPriceTypeAge1";break;case 9:t.text="notificationPriceTypeAge2";break;case 10:t.text="notificationPriceTypeAge3",t.textArg=r}}function l(e,t){switch(e){case 11:t.text="notificationPriceTypeDescription1";break;case 12:t.text="notificationPriceTypeDescription2";break;case 13:t.text="notificationPriceTypeDescription3";break;case 14:t.text="notificationPriceTypeDescription4";break;case 15:t.text="notificationPriceTypeDescription5"}}function d(e,t){switch(e){case 16:t.text="notificationPriceTypeCommunication1";break;case 17:t.text="notificationPriceTypeCommunication2";break;case 18:t.text="notificationPriceTypeCommunication3";break;case 19:t.text="notificationPriceTypeCommunication4";break;case 20:t.text="notificationPriceTypeCommunication5"}}function h(e,t){switch(e){case 21:t.text="notificationPriceTypeShipping1";break;case 22:t.text="notificationPriceTypeShipping2";break;case 23:t.text="notificationPriceTypeShipping3";break;case 24:t.text="notificationPriceTypeShipping4";break;case 25:t.text="notificationPriceTypeShipping5"}}var f={color:"",status:"",text:""},p=f,m=f,g=f,_=f,v=f,E=f;try{for(var b=Object(i.f)(n.notes),I=b.next();!I.done;I=b.next()){var T=I.value;switch(T.group){case 0:p=a(T.level),s(T.type,p),{notesScore:p};break;case 1:m=a(T.level),c(T.type,m),{notesFeedback:m};break;case 2:g=a(T.level),u(T.type,g,T.tokens[0].value),{notesAge:g};break;case 3:_=a(T.level),l(T.type,_),{notesDescription:_};break;case 4:v=a(T.level),d(T.type,v),{notesCommunication:v};break;case 5:E=a(T.level),h(T.type,E),{notesShipping:E}}}}catch(S){t={error:S}}finally{try{I&&!I.done&&(r=b.return)&&r.call(b)}finally{if(t)throw t.error}}return{notesScore:p,notesFeedback:m,notesAge:g,notesDescription:_,notesCommunication:v,notesShipping:E}},e.prototype.getPriceChartData=function(e,t,r){return Object(i.b)(this,void 0,void 0,(function(){var n,a,s,c,l,d,h,f,p;return Object(i.c)(this,(function(i){switch(i.label){case 0:n={data:{itemInfo:r}},i.label=1;case 1:return i.trys.push([1,7,,9]),a=e.id,s=e.region,c=e.currencyDisplay,a&&a.length?(l=a+"_"+(s?s+"_":"")+c+"_chartData",d=a+"_"+(s?s+"_":"")+c+"_chartTimeLastUpdated",[4,u.a.syncGet(d)]):[3,6];case 2:return!(h=i.sent())||Date.now()-h>o.a.UPDATE_INTERVAL_INFO_HISTORY_PRICE?[4,this.getPriceHistory(n,t)]:[3,4];case 3:return(p=i.sent())?(u.a.set(l,p),u.a.set(d,Date.now()),[2,p]):[3,6];case 4:return[4,u.a.syncGet(l)];case 5:if(f=i.sent())return[2,f];i.label=6;case 6:return[3,9];case 7:return i.sent(),[4,this.getPriceHistory(n,t)];case 8:return(p=i.sent())?[2,p]:[3,9];case 9:return[2]}}))}))},e.prototype.getPriceHistory=function(e,t){var r=e.data.itemInfo,i=r.priceLast.dataPricePage,n=Object.keys(i).length;return this.getItemHistory(r,i,n,t)},e.prototype.getItemHistory=function(e,t,r,n){return Object(i.b)(this,void 0,void 0,(function(){var a,o;return Object(i.c)(this,(function(i){return a=new URL(""+this.baseUrl+this.itemHistory),o={id:e.id.id,type:e.id.type,priceMin:e&&0!==r?t.priceMin:"",priceMax:e&&0!==r?t.priceMax:"",currency:e&&0!==r?t.currency:"",priceMinDisplay:e&&0!==r?t.priceMinDisplay:"",priceMaxDisplay:e&&0!==r?t.priceMaxDisplay:"",currencyDisplay:e&&0!==r?t.currencyDisplay:"",timezone:e&&0!==r?t.timezone:""},Object.keys(o).forEach((function(e){a.searchParams.append(e,o[e])})),[2,this.httpClient.get(a.href,{headers:this.getHeaders(n)}).toPromise().then((function(e){return e}))]}))}))},e.prototype.getHeaders=function(e,t){var r=e.attributes?e.attributes:e;return{Accept:"application/json","Content-Type":"application/json","app-token":o.a.APP_TOKEN,"extension-token":r.tokenCookies&&r.tokenCookies.eaetkn?r.tokenCookies.eaetkn:"","user-token":r.tokenCookies&&r.tokenCookies.eautkn?r.tokenCookies.eautkn:"",referrer:t||"","version-ext":chrome.runtime.getManifest().version}},e.prototype.getPriceSimilarProducts=function(e){return Object(i.b)(this,void 0,void 0,(function(){var t,r,n,a,c,u,l,d,h;return Object(i.c)(this,(function(i){switch(i.label){case 0:t=s.a.getDomain(e.url),r=t&&this.application.get("merchants").selectByDomain(t),n=this.application.get("user"),a=[],i.label=1;case 1:return i.trys.push([1,11,,12]),null!==e.data.urlsSimilarItems&&o.a.ARRAY_MERCHANTS_PRICE_SELLER.includes(r.get("id"))?e.data.urlsSimilarItems.productId?[3,4]:[4,this.aliexpressProductsService.getAliexpressSimilarItems(e.data.urlsSimilarItems.urlTopSell)]:[3,10];case 2:return c=i.sent(),[4,this.aliexpressProductsService.getAliexpressSimilarItems(e.data.urlsSimilarItems.urlOtherSeller)];case 3:return u=i.sent(),a=c.concat(u),[3,7];case 4:return[4,this.aliexpressProductsService.getAliexpressRecommendationSimilarItems(e.data.urlsSimilarItems.urlTopSell)];case 5:return c=i.sent(),[4,this.aliexpressProductsService.getAliexpressRecommendationSimilarItems(e.data.urlsSimilarItems.urlOtherSeller)];case 6:u=i.sent(),a=c.concat(u),i.label=7;case 7:return[4,s.a.matchLocaleCookie(o.a.NO_ALI_AFFILIATE_COUNTRY)];case 8:return i.sent()?(l=a.map((function(e){return{input:e.productId}})),[4,this.checkArrayAffiliateAliItems(l,n)]):[3,10];case 9:d=i.sent(),a=a.filter((function(e){return d.list.find((function(t){return t.input===e.productId&&!!t.result}))})),i.label=10;case 10:return[3,12];case 11:return h=i.sent(),console.error(h),[3,12];case 12:return[2,a.filter((function(e){return e&&e.productId}))]}}))}))},e.prototype.checkAffiliateAliItem=function(e,t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.c)(this,(function(r){return[2,this.httpClient.post(""+this.baseUrl+this.affiliateCheck,JSON.stringify({input:e}),{headers:this.getHeaders(t)}).toPromise().then((function(e){return e}))]}))}))},e.prototype.checkArrayAffiliateAliItems=function(e,t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.c)(this,(function(r){return[2,this.httpClient.post(""+this.baseUrl+this.affiliateCheckList,JSON.stringify({list:e}),{headers:this.getHeaders(t)}).toPromise().then((function(e){return e}))]}))}))},e.prototype.getTargetInfo=function(e,t,r){return Object(i.b)(this,void 0,void 0,(function(){var n,a,o;return Object(i.c)(this,(function(i){return n=Object.keys(t).length,a=new URL(""+this.baseUrl+this.itemInfo),o={url:e,priceMin:t&&0!==n?t.priceMin:"",priceMax:t&&0!==n?t.priceMax:"",currency:t&&0!==n?t.currency:"",priceMinDisplay:t&&0!==n?t.priceMinDisplay:"",priceMaxDisplay:t&&0!==n?t.priceMaxDisplay:"",currencyDisplay:t&&0!==n?t.currencyDisplay:"",timezone:t&&0!==n?t.timezone:""},Object.keys(o).forEach((function(e){a.searchParams.append(e,o[e])})),[2,this.httpClient.get(a.href,{headers:this.getHeaders(r)}).toPromise().then((function(e){return e}))]}))}))},e.\u0275fac=function(t){return new(t||e)(n.Nc(l.b),n.Nc(c.a),n.Nc(d.a),n.Nc(h.a))},e.\u0275prov=n.Ac({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),p=function(){function e(){}return e.getPrice=function(e,t){var r=parseFloat(e.toFixed(2)).toLocaleString("en").replace(/,/g," ");return"\u20bd"===t?r+" \u0440\u0443\u0431.":""+t+r},e}()},xOb2:function(e,t,r){r.d(t,"a",(function(){return n}));var i=r("fXoL"),n=function(){function e(){}return e.get=function(e,t){chrome.storage.local.get(e,(function(r){t&&t(r[e])}))},e.syncGet=function(e){return new Promise((function(t){chrome.storage.local.get(e,(function(r){return t(r[e])}))}))},e.set=function(e,t){var r;chrome.storage.local.set(((r={})[e]=t,r))},e.remove=function(e){chrome.storage.local.remove(e)},e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=i.Ac({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},"y7o/":function(e,t,r){r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return f}));var i=r("mrSG"),n=r("LWby"),a=r("cftt"),o=r("dkLR"),s=r("xOb2"),c=r("0FjH"),u=r.n(c),l=r("p5zV"),d=r.n(l),h=function(){var e=this,t={getDomain:function(e){if(!e)return null;try{e=new URL(e).host.replace("www.","")}catch(t){e=e.replace("www.","")}return e},getStyle:function(e,t){if(e.currentStyle)return e.currentStyle[t];if(window.document.defaultView&&window.document.defaultView.getComputedStyle){var r=window.document.defaultView.getComputedStyle(e,"");return r?r[t]:null}return e.style?e.style[t]:void 0},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},getFullInfo:function(){var e="",t="",r="",i="",n="",a="",o=window.navigator.userAgent||"",s=window.navigator.platform||"";return/MSIE/.test(o)?(e="Internet Explorer",/IEMobile/.test(o)&&(r=1),t=/MSIE \d+[.]\d+/.exec(o)[0].split(" ")[1]):/YaBrowser/.test(o)?(/CrOS/.test(o)&&(s="CrOS"),e="YaBrowser",t=/YaBrowser\/[\d\.]+/.exec(o)[0].split("/")[1]):/Opera/.test(o)||/OPR/.test(o)?(e="Opera",t=/OPR\/[\d\.]+/.exec(o)[0].split("/")[1],(/mini/.test(o)||/Mobile/.test(o))&&(r=1)):/Chrome/.test(o)?(/CrOS/.test(o)&&(s="CrOS"),e="Chrome",t=/Chrome\/[\d\.]+/.exec(o)[0].split("/")[1]):/Android/.test(o)?(e="Android Webkit Browser",r=1,i=/Android\s[\.\d]+/.exec(o)[0]):/Firefox/.test(o)?(e="Firefox",/Fennec/.test(o)&&(r=1),t=/Firefox\/[\.\d]+/.exec(o)[0].split("/")[1]):/Safari/.test(o)&&(e="Safari",(/iPhone/.test(o)||/iPad/.test(o)||/iPod/.test(o))&&(i="iOS",r=1)),t||(t=(t=/Version\/[\.\d]+/.exec(o))?t[0].split("/")[1]:framework.browser.version),"MacIntel"===s||"MacPPC"===s?(i="Mac OS X",(n=o.matchAll(/[\d\\_]+[\d]+/gim)[0][0])&&(n=n.split("_").join("."))):"CrOS"===s?i="ChromeOS":"Win32"===s||"Win64"===s?(i="Windows",a=s.replace(/[^0-9]+/,"")):!i&&/Android/.test(o)?i="Android":!i&&/Linux/.test(s)?i="Linux":!i&&/Windows/.test(o)&&(i="Windows"),{browser:e.toLowerCase(),version:t,mobile:r,os:i,osversion:n,bit:a}},getAllUrlParams:function(e){var t=e?e.split("?")[1]:window.location.search.slice(1),r={};if(t)for(var i=(t=t.split("#")[0]).split("&"),n=0;n<i.length;n++){var a=i[n].split("="),o=void 0,s=a[0].replace(/\[\d*\]/,(function(e){return o=e.slice(1,-1),""})),c=void 0===a[1]||null===a[1]?"":a[1];s=s.toLowerCase(),c=c.toLowerCase(),r[s]?("string"==typeof r[s]&&(r[s]=[r[s]]),void 0===o?r[s].push(c):r[s][o]=c):r[s]=c}return r},getDomainPrice:function(e){var t=null;return e&&e.length>0&&(e.includes("aliexpress")?t="aliexpress":e.includes("gearbest")?t="gearbest":e.includes("banggood")?t="banggood":e.includes("lightinthebox")?t="lightinthebox":e.includes("miniinthebox")?t="miniinthebox":e.includes("tomtop")&&(t="tomtop")),t},getProductId:function(e,t){var r=null;if(e&&e.length>0)switch(e){case"aliexpress":r=t.matchAll(o.a.REGEX_ALI_PRODUCT_ID)[0][1],r+="_aliexpress";break;case"gearbest":r=t.matchAll(o.a.REGEX_GEARBEST_PRODUCT_ID)[0][1],r+="_gearbest";break;case"ru.gearbest":r=t.matchAll(o.a.REGEX_GEARBEST_PRODUCT_ID)[0][1],r+="_ru_gearbest";break;case"banggood":r=t.matchAll(o.a.REGEX_BANG_GOOD_PRODUCT_ID)[0][1],r+="_banggood";break;case"eu.banggood":r=t.matchAll(o.a.REGEX_BANG_GOOD_EU_PRODUCT_ID)[0][1],r+="_eu_banggood";break;case"us.banggood":r=t.matchAll(o.a.REGEX_BANG_GOOD_US_PRODUCT_ID)[0][1],r+="_us_banggood";break;case"lightinthebox":r=t.matchAll(o.a.REGEX_LIGHT_IN_THE_BOX_PRODUCT_ID)[0][1],r+="_lightinthebox";break;case"miniinthebox":r=t.matchAll(o.a.REGEX_LIGHT_IN_THE_BOX_PRODUCT_ID)[0][1],r+="_miniinthebox";break;case"tomtop":r=t.matchAll(o.a.REGEX_TOM_TOP_PRODUCT_ID)[0][1],r+="_tomtop"}return r},_getTimeZoneOffset:function(){try{return(new Date).toString().match(/([-\+][0-9]+)\s/)[1]}catch(e){return null}},_getPriceGearbest:function(){try{var e=$("#siteWrap").eq(0).find("script").html();e=e.match(/\s+appPrice:\s*"([\d.]+)",/im)[1];var r=e=parseFloat(parseFloat(e).toFixed(2));if(e>r)throw new Error("getPriceObj priceMin > priceMax");if(!(e>0&&r>0))throw new Error("getPriceObj priceMin or priceMax less or equal 0");var i=t._getDisplayPriceGearBest();return{currency:"USD",priceMin:e,priceMax:r,currencyDisplay:i.currency,priceMinDisplay:i.priceMin,priceMaxDisplay:i.priceMax}}catch(n){return console.log("Error",n),{currency:null,priceMin:null,priceMax:null,currencyDisplay:null,priceMinDisplay:null,priceMaxDisplay:null}}},_getPriceBanggood:function(){var e,r;try{var n=parseFloat($(".item_box.price .now").attr("oriattrmin")),a=parseFloat($(".item_box.price .now").attr("oriattrmax")),o=parseFloat($(".item_box.price .now").attr("oriprice")),s=null,c=[],u=document.documentElement.innerHTML.match(/fb_jsonNewFB\s*=\s*(\{.+\}),/i);if(u&&2===u.length)try{var l=JSON.parse(u[1]);!o&&l.value&&(o=parseFloat(l.value),c.push(o)),l.currency&&(s=l.currency)}catch(g){}if((u=document.documentElement.innerHTML.match(/var\s+google_tag_params\s*=\s*{.+ecomm_totalvalue:(.+),\s*ecomm_pagetype:/i))&&2===u.length)try{var d=JSON.parse(u[1]);d&&"number"==typeof d?c.push(d):"object"==typeof d&&Array.isArray(d)&&(c=c.concat(d))}catch(g){}s&&(s=s.toUpperCase().trim()),(!n||o<n)&&(n=o),a||(a=n);try{for(var h=Object(i.f)(c),f=h.next();!f.done;f=h.next()){var p=f.value;a<p?a=p:p&&n>p&&(n=p)}}catch(_){e={error:_}}finally{try{f&&!f.done&&(r=h.return)&&r.call(h)}finally{if(e)throw e.error}}if($('.item_warehouse_list li[value!="US"] .item_warehouse_price').each((function(){parseFloat($(this).attr("oriprice"))<n&&(n=parseFloat($(this).attr("oriprice"))),parseFloat($(this).attr("oriprice"))>a&&(a=parseFloat($(this).attr("oriprice")))})),!s)throw new Error("getPriceObj currency bad string");if(n>a)throw new Error("getPriceObj priceMin > priceMax");if(!(n>0&&a>0))throw new Error("getPriceObj priceMin or priceMax less or equal 0");var m=t._getDisplayPriceBanggood();return{currency:s,priceMin:n,priceMax:a,currencyDisplay:m.currency,priceMinDisplay:m.priceMin,priceMaxDisplay:m.priceMax}}catch(g){return console.log("Error",g),{currency:null,priceMin:null,priceMax:null,currencyDisplay:null,priceMinDisplay:null,priceMaxDisplay:null}}},_getPriceUsEuBanggood:function(){try{var e,r=parseFloat($('.pro_price [itemprop="price"]').text()),i=parseFloat($('.pro_price [itemprop="price"]').text()),n={USD:"US$",EUR:"\u20ac",GBP:"\xa3",AUD:"AU$",CAD:"CA$",RUB:"\u0440\u0443\u0431.",BRL:"R$",CHF:"SFr",DKK:"Dkr",PHP:"\u20b1",SGD:"S$",CZK:"K\u010d",HUF:"Ft",MXN:"Mex$",NOK:"Kr",NZD:"NZD$",PLN:"z\u0142",THB:"\u0e3f",HKD:"HK$",ILS:"\u20aa",SEK:"Kr",ZAR:"R",KRW:"\u20a9",CLP:"$",TRY:"TRY",INR:"Rs",JPY:"JPY",AED:"AED",MYR:"RM",IDR:"Rp",UAH:"\u20b4",KWD:"K.D.",QAR:"QR.",BHD:"BD.",SAR:"S.R."},a=Object.keys(n),o=$(".item_box.price .hbactive b").text();for(var s in o||(o=$(".pro_price .currency .currency_Prefix").text()),a)if(n[a[s]]===o){e=a[s];break}if(!e)throw new Error("getPriceObj currency bad string");if(r>i)throw new Error("getPriceObj priceMin > priceMax");if(!(r>0&&i>0))throw new Error("getPriceObj priceMin or priceMax less or equal 0");var c=t._getDisplayPriceBanggood();return{currency:e,priceMin:r,priceMax:i,currencyDisplay:c.currency,priceMinDisplay:c.priceMin,priceMaxDisplay:c.priceMax}}catch(u){return console.log("Error",u),{currency:null,priceMin:null,priceMax:null,currencyDisplay:null,priceMinDisplay:null,priceMaxDisplay:null}}},_getPriceLightinthebox:function(){return function(){var e,t,r,n;try{var a=$('span[itemprop="priceCurrency"]').eq(0).attr("content").replace(/\s\s+/g," ").trim().toUpperCase(),o=JSON.parse($("#_prodInfoConfig_").attr("data-config")),s=Object.keys(o)[0],c=parseFloat(o[s].salePrice),u=c,l=o[s].attributes;try{for(var d=Object(i.f)(l),h=d.next();!h.done;h=d.next()){var f=h.value;try{for(var p=(r=void 0,Object(i.f)(f.items)),m=p.next();!m.done;m=p.next()){var g=m.value;if(g.price>0){var _=parseFloat((c+parseFloat(g.price)).toFixed(2));_>u&&(u=_)}}}catch(v){r={error:v}}finally{try{m&&!m.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}}}catch(E){e={error:E}}finally{try{h&&!h.done&&(t=d.return)&&t.call(d)}finally{if(e)throw e.error}}if(!a)throw new Error("getPriceObjLightinthebox currency bad string");if(c>u)throw new Error("getPriceObjLightinthebox priceMin > priceMax");if(!(c>0&&u>0))throw new Error("getPriceObjLightinthebox priceMin or priceMax less or equal 0");return{currency:a,priceMin:c,priceMax:u,currencyDisplay:a,priceMinDisplay:c,priceMaxDisplay:u}}catch(b){return console.log("Error",b),{currency:null,priceMin:null,priceMax:null,currencyDisplay:null,priceMinDisplay:null,priceMaxDisplay:null}}}()},_getPriceTomtop:function(e){try{var t,r,i;try{t=JSON.parse(e.matchAll(/var\s+product\s*=(.*)/gim)[0][1])}catch(v){t=null}try{r=JSON.parse(e.matchAll(/var\s+mainContent\s*=(.*)?;/gim)[0][1])}catch(v){r=null}try{i=JSON.parse(e.matchAll(/var\s+timeLimit\s*=(.*)?;/gim)[0][1])}catch(v){i=null}var n=t?parseFloat(t.saleprice?t.saleprice:t.price):null,a=t?t.currency:null,o=[];"object"==typeof r&&r&&r.length>0&&r.forEach((function(e){"object"==typeof e.whouse&&e.whouse&&Object.keys(e.whouse).forEach((function(t){o.push({listingId:e.listingId,depotId:e.whouse[t].depotId,symbol:e.whouse[t].symbol,nowprice:parseFloat(e.whouse[t].nowprice),origprice:parseFloat(e.whouse[t].origprice),us_nowprice:parseFloat(e.whouse[t].us_nowprice),us_origprice:parseFloat(e.whouse[t].us_origprice),saleStartDate:e.whouse[t].saleStartDate,saleEndDate:e.whouse[t].saleEndDate})}))}));var s=[];"object"==typeof i&&i&&Object.keys(i).forEach((function(e){"object"==typeof i[e]&&i[e]&&Object.keys(i[e]).forEach((function(t){s.push({listingId:i[e][t].listingId,depotId:i[e][t].depot,actPrice:parseFloat(i[e][t].actPrice),nowprice:parseFloat(i[e][t].nowprice)})}))}));var c=a,u={},l={},d={},h={},f=[];s.length>0&&s.forEach((function(e){f.push(e.depotId+"_"+e.listingId),u[e.listingId]||(u[e.listingId]=e.actPrice),l[e.listingId]||(l[e.listingId]=e.actPrice),e.actPrice<u[e.listingId]&&(u[e.listingId]=e.actPrice),e.actPrice>l[e.listingId]&&(l[e.listingId]=e.actPrice),d[e.listingId]||(d[e.listingId]=e.nowprice),h[e.listingId]||(h[e.listingId]=e.nowprice),e.nowprice<d[e.listingId]&&(d[e.listingId]=e.nowprice),e.nowprice>h[e.listingId]&&(h[e.listingId]=e.nowprice)})),o.length>0&&o.forEach((function(e){if(-1!==f.indexOf(e.depotId+"_"+e.listingId))return 0;u[e.listingId]||(u[e.listingId]=e.us_nowprice),l[e.listingId]||(l[e.listingId]=e.us_nowprice),e.us_nowprice<u[e.listingId]&&(u[e.listingId]=e.us_nowprice),e.us_nowprice>l[e.listingId]&&(l[e.listingId]=e.us_nowprice),d[e.listingId]||(d[e.listingId]=e.nowprice),h[e.listingId]||(h[e.listingId]=e.nowprice),e.nowprice<d[e.listingId]&&(d[e.listingId]=e.nowprice),e.nowprice>h[e.listingId]&&(h[e.listingId]=e.nowprice)}));var p=null,m=null,g=null,_=null;if(Object.keys(u).forEach((function(e){p||(p=u[e]),u[e]<p&&(p=u[e])})),Object.keys(l).forEach((function(e){m||(m=l[e]),l[e]>m&&(m=l[e])})),Object.keys(d).forEach((function(e){g||(g=d[e]),d[e]<g&&(g=d[e])})),Object.keys(h).forEach((function(e){_||(_=h[e]),h[e]>_&&(_=h[e])})),g||(g=n),_||(_=n),n<g&&(g=n),n>_&&(_=n),p>m)throw new Error("getPriceObj priceMin > priceMax");if(!(p>0&&m>0))throw new Error("getPriceObj priceMin or priceMax less or equal 0");if(!c)throw new Error("getPriceObj currencyDisplay bad string");if(g>_)throw new Error("getPriceObj priceMinDisplay > priceMaxDisplay");if(!(g>0&&_>0))throw new Error("getPriceObj priceMinDisplay or priceMaxDisplay less or equal 0");return{currency:"USD",priceMin:p,priceMax:m,currencyDisplay:c,priceMinDisplay:g,priceMaxDisplay:_}}catch(v){return console.error("Error",v),{currency:null,priceMin:null,priceMax:null,currencyDisplay:null,priceMinDisplay:null,priceMaxDisplay:null}}},_getDisplayPriceBanggood:function(){return function(){var e;try{var t,r,i={USD:{label:"US$",decimal:"."},EUR:{label:"\u20ac",decimal:","},GBP:{label:"\xa3",decimal:"."},AUD:{label:"AU$",decimal:"."},CAD:{label:"CA$",decimal:"."},RUB:{label:"\u0440\u0443\u0431.",decimal:","},BRL:{label:"R$",decimal:","},CHF:{label:"SFr",decimal:"."},DKK:{label:"Dkr",decimal:"."},PHP:{label:"\u20b1",decimal:"."},SGD:{label:"S$",decimal:"."},CZK:{label:"K\u010d",decimal:"."},HUF:{label:"Ft",decimal:"."},MXN:{label:"Mex$",decimal:"."},NOK:{label:"Kr",decimal:"."},NZD:{label:"NZD$",decimal:"."},PLN:{label:"z\u0142",decimal:","},THB:{label:"\u0e3f",decimal:"."},HKD:{label:"HK$",decimal:"."},ILS:{label:"\u20aa",decimal:"."},SEK:{label:"Kr",decimal:"."},ZAR:{label:"R",decimal:"."},KRW:{label:"\u20a9",decimal:"."},CLP:{label:"$",decimal:"."},TRY:{label:"TRY",decimal:"."},INR:{label:"\u20b9",decimal:"."},JPY:{label:"JPY",decimal:"."},AED:{label:"AED",decimal:"."},MYR:{label:"RM",decimal:"."},IDR:{label:"Rp",decimal:"."},UAH:{label:"\u20b4",decimal:"."},KWD:{label:"K.D.",decimal:"."},QAR:{label:"QR.",decimal:"."},BHD:{label:"BD.",decimal:"."},SAR:{label:"S.R.",decimal:"."},EGP:{label:"E\xa3",decimal:"."},OMR:{label:"RO.",decimal:"."},JOD:{label:"J.D.",decimal:"."},LBP:{label:"\uffe1L",decimal:"."},COP:{label:"COP$",decimal:"."},PEN:{label:"PEN",decimal:","}},n=/\d{1,3}(?:[.,\s]\d{1,3})*(?:[.,]\d{1,3})|\d{1,3}/gm,a=$(".product-price .main-price").text(),o=a.match(n),s=a.replace(n,"").replace("-","").trim(),c=Object.keys(i).find((function(e){return s===i[e].label}));if(!c)throw new Error("getPriceObj currency bad string");var u=function(e){var t=(e.match(n)||[]).find((function(e){return e.length>0}));return t&&c?+(t=t.replace(i[c].decimal,"~").replace(",","").replace(".","").replace("~",".")).replace(" ",""):null};if(!o||1!==o.length&&2!==o.length||!o[0])throw new Error("getPriceObj can not match");t=o[0],r=null!==(e=o[1])&&void 0!==e?e:o[0];var l=u(t),d=u(r);if(0===l)throw new Error("getPriceObj priceMin should be more than 0");if(d||(d=l),l>d)throw new Error("getPriceObj priceMin > priceMax");if(!(l>0&&d>0))throw new Error("getPriceObj priceMin or priceMax less or equal 0");return{currency:c,priceMin:l,priceMax:d}}catch(h){return console.log("Error",h),{currency:null,priceMin:null,priceMax:null}}}()},_getDisplayPriceGearBest:function(){return function(e){try{var t,r={AED:"\u062f.\u0625",AUD:"AU$",BGN:"\u043b\u0432",BRL:"R$",CAD:"C$",CHF:"SFr.",CLP:"CL$",CNY:"\xa5",COP:"Col$",CZK:"K\u010d",DKK:"DKr.",EUR:"\u20ac",GBP:"\xa3",HKD:"HK$",HRK:"Kn",HUF:"Ft",IDR:"Rp",ILS:"\u20aa",INR:"Rs",JPY:"\u5186",KRW:"\u20a9",MAD:"\u062f.\u0645.",MXN:"MXN$",MYR:"RM",NGN:"\u20a6",NOK:"NKr.",NZD:"NZ$",PEN:"S/.",PLN:"z\u0142",RON:"lei",RSD:"\u0420\u0421\u0414",RUB:"\u0440\u0443\u0431.",SAR:"\u0631.\u0633",SEK:"SKr",SGD:"S$",THB:"\u0e3f",TRY:"TL",TWD:"NT$",UAH:"\u20b4",USD:"$",ZAR:"R"},i=Object.keys(r);for(var n in i)if(-1!==e.toLowerCase().indexOf(r[i[n]].toLowerCase())){t=i[n];break}if(!t)throw new Error("getPriceObj currency bad string");if("string"!=typeof e)throw new Error("getPriceObj priceText not string");var a=parseFloat(e.replace(/\s+/g,"").replace(",",".").match(/\d+[.\d+]*/gim)[0]),o=a;if(a>o)throw new Error("getPriceObj priceMin > priceMax");if(!(a>0&&o>0))throw new Error("getPriceObj priceMin or priceMax less or equal 0");return{currency:t,priceMin:a,priceMax:o}}catch(s){return console.log("Error",s),{currency:null,priceMin:null,priceMax:null}}}($(".goodsIntro_price").eq(0).text())},_getPriceAliexpress:function(e){var r;try{var i,n=void 0,a=void 0;r=t._getPriceStrAliexpress();try{n=parseFloat(parseFloat(e.matchAll(o.a.REGEX_ACT_MIN_PRICE)[0][1]).toFixed(2))}catch(u){n=parseFloat(parseFloat(e.matchAll(o.a.REGEX_MIN_PRICE)[0][1]).toFixed(2))}try{a=parseFloat(parseFloat(e.matchAll(o.a.REGEX_ACT_MAX_PRICE)[0][1]).toFixed(2))}catch(u){a=parseFloat(parseFloat(e.matchAll(o.a.REGEX_MAX_PRICE)[0][1]).toFixed(2))}if(!(i=e.matchAll(o.a.REGEX_BASE_CURRENCY_CODE)[0][1]))throw new Error("getPriceObj currency bad string");if(n>a)throw new Error("getPriceObj priceMin > priceMax");if(!(n>0&&a>0))throw new Error("getPriceObj priceMin or priceMax less or equal 0");var s=t._getDisplayPriceAliexpress(r);return{currency:i,priceMin:n,priceMax:a,currencyDisplay:s.currency,priceMinDisplay:s.priceMin,priceMaxDisplay:s.priceMax}}catch(u){try{var c=t._getDisplayPriceAliexpress(r);return{currency:null,priceMin:null,priceMax:null,currencyDisplay:c.currency,priceMinDisplay:c.priceMin,priceMaxDisplay:c.priceMax}}catch(u){return console.log("Error",u),{currency:null,priceMin:null,priceMax:null,currencyDisplay:null,priceMinDisplay:null,priceMaxDisplay:null}}}},_getDisplayPriceAliexpress:function(e){try{if("string"!=typeof e)throw new Error("getPriceObj priceText not string");for(var t=[[/US.*\$/gim,"USD","."],[/\u0440\u0443\u0431\./gim,"RUB",","],[/\uffe1/gim,"GBP","."],[/R\$/gim,"BRL",","],[/C\$/gim,"CAD","."],[/AU.*\$/gim,"AUD","."],[/\u20ac/gim,"EUR",","],[/Rs\./gim,"INR","."],[/\u0433\u0440\u043d\./gim,"UAH",","],[/\uffe5/gim,"JPY","."],[/MXN\$/gim,"MXN","."],[/Rp/gim,"IDR","."],[/TL/gim,"TRY","."],[/SEK/gim,"SEK","."],[/CLP/gim,"CLP","."],[/\u20a9/gim,"KRW","."],[/SG\$/gim,"SGD","."],[/NZ\$/gim,"NZD","."],[/CHF/gim,"CHF","."],[/z\u0142/gim,"PLN",","],[/AED./gim,"AED","."],[/PHP./gim,"PHP","."],[/ZAR./gim,"ZAR","."],[/ARS./gim,"ARS",","]],r=null,i=null,n=0;n<t.length;n++){var a=t[n];if(a[0].test(e)){r=a[1],i=a[2],e=e.replace(a[0],"");break}}if(null===r||null===i)throw new Error("getPriceObj can not find currency (USD, RUB)");var o=e.toLowerCase().match(/[\d.,-]+/gim).join("").split("-");if(!o||1!==o.length&&2!==o.length||!o[0])throw new Error("getPriceObj can not match");(-1!==o[0].indexOf(",")&&-1!==o[0].indexOf(".")&&o[0].indexOf(",")<o[0].indexOf(".")||-1===o[0].indexOf(",")&&o[0].match(/\./gim)&&1===o[0].match(/\./gim).length)&&(i=".");var s=new RegExp("[^0-9-"+i+"]",["g"]),c=parseFloat(o[0].replace(s,"").replace(i,".")),u=c;if(o[1]&&(u=parseFloat(o[1].replace(s,"").replace(i,"."))),c>u)throw new Error("getPriceObj priceMin > priceMax");if(!(c>0&&u>0))throw new Error("getPriceObj priceMin or priceMax less or equal 0");return{currency:r,priceMin:c,priceMax:u}}catch(l){return console.log("Error",l),{currency:null,priceMin:null,priceMax:null}}},_getPriceStrAliexpress:function(){var e=$('.product-multi-price-main #j-multi-currency-price, .product-multi-price-main span[itemprop="priceCurrency"]').text();return e||(e=$(".p-price-content .p-symbol, .p-price-content .p-price").text()),e||(e=$("div.p-price span.p-price").text()),e||(e=$(".detail-price-container .price-span").text()),e||(e=$("div.product-price span.product-price-current").text()),e||(e=$("span[class^='Product_UniformBanner__uniformBannerBoxPrice__']").text()),e||(e=$("div.uniform-banner-box span.uniform-banner-box-price").text()),e},_getPriceAliexpressNewDesign:function(e){try{var r,i=null,n=null;r=t._getCurrencyPriceAliexpressNewDesign(e);var a=e.data.skuModule.skuPriceList;for(var o in a)if(a[o]&&a[o].skuVal){var s=parseFloat(a[o].skuVal.actSkuCalPrice||a[o].skuVal.skuCalPrice);(null===i||i>s)&&(i=s),(null===n||n<s)&&(n=s)}var c=t._getDisplayPriceAliexpressNewDesign(e);return{currency:r,priceMin:i,priceMax:n,currencyDisplay:c.currency,priceMinDisplay:c.priceMin,priceMaxDisplay:c.priceMax}}catch(l){try{var u=t._getDisplayPriceAliexpressNewDesign(e);return{currency:null,priceMin:null,priceMax:null,currencyDisplay:u.currency,priceMinDisplay:u.priceMin,priceMaxDisplay:u.priceMax}}catch(l){return console.log("Error",l),{currency:null,priceMin:null,priceMax:null,currencyDisplay:null,priceMinDisplay:null,priceMaxDisplay:null}}}},_getCurrencyPriceAliexpressNewDesign:function(e){try{var t=e.data.skuModule.skuPriceList[0].skuVal,r=parseFloat(t.actSkuCalPrice?t.actSkuCalPrice:t.skuCalPrice),i=t.skuActivityAmount?t.skuActivityAmount:t.skuAmount,n=parseFloat(i.value),a=i.currency;if(!(r>0&&n>0))throw new Error("Can not detect currency");if(r===n)return a;var o=e.data.commonModule;return o.tradeCurrencyCode!==o.currencyCode?o.tradeCurrencyCode:"USD"}catch(s){return null}},_getDisplayPriceAliexpressNewDesign:function(e){try{var t=e.data.priceModule;return{currency:t.minActivityAmount?t.minActivityAmount.currency:t.minAmount.currency,priceMin:t.minActivityAmount?t.minActivityAmount.value:t.minAmount.value,priceMax:t.maxActivityAmount?t.maxActivityAmount.value:t.maxAmount.value}}catch(r){return{currency:null,priceMin:null,priceMax:null}}},_getPriceStrAliexpressNewDesign:function(){var e=$('.product-multi-price-main #j-multi-currency-price, .product-multi-price-main span[itemprop="priceCurrency"]').text();return e||(e=$(".p-price-content .p-symbol, .p-price-content .p-price").text()),e||(e=$("div.p-price span.p-price").text()),e||(e=$(".detail-price-container .price-span").text()),e},getAliRunParams:function(e){try{return JSON.parse(e.matchAll(/window\.runParams\s*=\s*({[.\s\S]+?});/gim)[0][1].split(" ").join("").split("\r").join("").split("\n").join("").replace("data",'"data"').replace("csrfToken",'"csrfToken"').replace(":'",':"').replace("',",'"').replace("abVersion",',"abVersion"').replace(":'",':"').replace("'}",'"}').replace("',",'",').replace("abtestMap",'"abtestMap"'))}catch(t){return!1}},getPrice:function(e){var r={};if(e&&e.length>0)switch(e){case"aliexpress":var i=$("body").text(),n=t.getAliRunParams(i);if(n){r=t._getPriceAliexpressNewDesign(n);break}r=t._getPriceAliexpress(i);break;case"gearbest":case"ru.gearbest":r=t._getPriceGearbest();break;case"banggood":r=t._getPriceBanggood();break;case"us.banggood":case"eu.banggood":r=t._getPriceUsEuBanggood();break;case"lightinthebox":case"miniinthebox":r=t._getPriceLightinthebox();break;case"tomtop":r=t._getPriceTomtop($("body").text())}return r.timezone=t._getTimeZoneOffset(),r},getRegion:function(e){var t="";if("aliexpress"===e){var r=$("body").text(),i=r.matchAll(o.a.REGEX_REGION_COUNTRY_NAME),n=r.matchAll(o.a.REGEX_REGION_PROVINCE_NAME),a=r.matchAll(o.a.REGEX_REGION_CITY_NAME);t=(i?i[0][1]:"UNKNOWN")+"_"+(n?n[0][1]:"UNKNOWN")+"_"+(a?a[0][1]:"UNKNOWN")}return t},matchLocaleCookie:function(t){return Object(i.b)(e,void 0,void 0,(function(){var e,r;return Object(i.c)(this,(function(i){switch(i.label){case 0:return[4,s.a.syncGet("locale")];case 1:return!(e=i.sent())||_.isEmpty(t)?[2,!1]:(r=e.split("_")[1].toUpperCase(),[2,t.some((function(e){return e.toUpperCase()===r}))])}}))}))},isAliexpressProductPage:function(e){return o.a.REGEX_ALI_PRODUCT_ID.test(e)},checkConditionsBooking:function(e,t){return Object(i.b)(this,void 0,void 0,(function(){var r=this;return Object(i.c)(this,(function(a){return[2,new Promise((function(a){return Object(i.b)(r,void 0,void 0,(function(){var r=this;return Object(i.c)(this,(function(o){return _.delay((function(){return Object(i.b)(r,void 0,void 0,(function(){var r;return Object(i.c)(this,(function(i){switch(i.label){case 0:return[4,t.getParameter(n.a.GREEN_LIGHT_BOOKING_END_TIME)];case 1:return r=i.sent(),[2,a(""!==e.search&&!e.searchParams.get("aid")||r&&Date.now()<r)]}}))}))}),500),[2]}))}))}))]}))}))},getViewUrlItem:function(e,t){return a.a.getLink()+"view/"+e+o.a.PARAMETER_DEEP_LINK+encodeURIComponent(t)},getGoUrlItem:function(e,t){return a.a.getLink()+"shops/"+e+"/go"+o.a.PARAMETER_DEEP_LINK+encodeURIComponent(t)+"&productWithGo=true"},getMetaTagInfo:function(e,t){void 0===t&&(t="property");for(var r=document.getElementsByTagName("meta"),i=0;i<r.length;i++)if(r[i].getAttribute(t)===e)return r[i].getAttribute("content");return""},urlFromObject:function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&e[r].length>0&&t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")},saveUserSettings:function(t,r){return Object(i.b)(e,void 0,void 0,(function(){var e;return Object(i.c)(this,(function(i){switch(i.label){case 0:return[4,s.a.syncGet("userSettings")];case 1:return(e=i.sent()||{})[t]=r,s.a.set("userSettings",e),[2]}}))}))},getUserSettings:function(){return Object(i.b)(e,void 0,void 0,(function(){return Object(i.c)(this,(function(e){switch(e.label){case 0:return[4,s.a.syncGet("userSettings")];case 1:return[2,e.sent()]}}))}))},getUserSettingsByKey:function(t){return Object(i.b)(e,void 0,void 0,(function(){return Object(i.c)(this,(function(e){switch(e.label){case 0:return[4,s.a.syncGet("userSettings")];case 1:return[2,(e.sent()||{})[t]]}}))}))},checkUserSegments:function(e,t){return Array.isArray(e)&&e.length&&Array.isArray(t)&&t.length&&!!e.filter((function(e){return t.includes(e)})).length},checkUserExperiments:function(e,t){var r=t.experimentMachineName,i=t.groupsMachineName;return Array.isArray(e)&&e.length&&!!e.filter((function(e){var t=e.experiment_machine_name,n=e.groups_machine_name;return t===r&&n===i})).length},isAliexpress:function(e){return[o.a.aliexpressID,o.a.aliexpressWWID].includes(e)},isAliexpressGlobal:function(e){return e===o.a.aliexpressWWID},isAliexpressCis:function(e){return e===o.a.aliexpressID},objectKeysTransform:function(e,t){switch(void 0===t&&(t="camelcase"),t){case"camelcase":return u()(e,{deep:!0});case"snakecase":return d()(e,{deep:!0});default:return e}},sleep:function(e){return new Promise((function(t){return setTimeout(t,e)}))},getLSViewedShopsPageUrl:function(e,r){void 0===r&&(r="no-activate-cashback");var i="&utm_source=extension&utm_campaign="+r+"&utm_term="+t.getFullInfo().browser.toLowerCase(),n=e?"/shops-viewed?with_shop="+e.id:"/shops-viewed?";return a.a._root+n+i},isBrowser:function(e){return t.getFullInfo().browser.toLowerCase()===e.toLowerCase()},calculateRateCoefficient:function(e){return e?e/100+1:1},getTimerData:function(e){var t=new Date(e).getTime()-(new Date).getTime(),r=Math.floor(t%864e5/36e5),i=Math.floor(t%36e5/6e4),n=Math.floor(t%6e4/1e3),a=1===r.toFixed().length?"0"+r:""+r,o=1===i.toFixed().length?"0"+i:""+i,s=1===n.toFixed().length?"0"+n:""+n;return t<=0?"00:00:00":a+":"+o+":"+s},getEndedAutopromo:function(e){return e.autoPromotions.find((function(e){return e.autoPromotion.endAt&&new Date(e.autoPromotion.endAt).getTime()<=_.now()}))},checkEnableDisableDomain:function(e,r){var i=e.get("domains_enabled"),n=e.get("domains_disabled");function a(e,t){return e.includes("*.")&&t.includes(e.replace("*.",""))||t===e}if((null==i?void 0:i.length)&&(null==n?void 0:n.length)){return!!!!i.find((function(e){return a(e,r)}))&&!n.find((function(e){return a(e,r)}))}return r===t.getDomain(e.get("domain"))}};return t}();function f(){o.a.DEBUG&&console.info&&console.info.apply(null,arguments)}String.prototype.matchAll=function(e){var t=[];return this.replace(e,(function(){var e=[].slice.call(arguments,0),r=e.splice(-2);e.index=r[0],t.push(e)})),t.length?JSON.parse(JSON.stringify(t)):null},Number.prototype.pad=function(e){for(var t=String(this).substring(0,1),r=String(Math.abs(this));r.length<(e||2);)r="0"+r;return"-"===t?"+"+r+":00":"-"+r+":00"}},zn8P:function(e,t){function r(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}r.keys=function(){return[]},r.resolve=r,e.exports=r,r.id="zn8P"}},[[0,0,1]]]);